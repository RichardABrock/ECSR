<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Making graphs – ECSR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-868b9742d7bde9f1698ef1c41a43f714.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../css/mastemr.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="index.qmd" class="navbar-brand navbar-brand-logo">
    <img src="../images/KCL_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="index.qmd">
    <span class="navbar-title">ECSR</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/04-Intro_to_graphs.html">Making graphs</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-1-Loading_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-2-Intro_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loading packages and exploring data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to Stats</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-1-Descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Descriptive Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-2-ChisqPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis testing and Chi-square tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-3-T-testsPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T-tests</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Intro_to_graphs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Making graphs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Corpus analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A9-Corpus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Corpus Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Publications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-Rpublications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Publishing using R and quarto</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-PISA_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PISA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-DfE_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DfE England</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A3-TIMSS_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TIMSS, PIRLS and ICILS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A4-Other_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A5-Self_Study_Tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self Study Tasks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A6-selecting_statistical_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selecting statistical tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A7-QandA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Questions and Answers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A10-Leaflet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Leaflet</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-graphing" id="toc-sec-graphing" class="nav-link active" data-scroll-target="#sec-graphing"><span class="header-section-number">1</span> ggplot</a></li>
  <li><a href="#geoms" id="toc-geoms" class="nav-link" data-scroll-target="#geoms"><span class="header-section-number">2</span> geoms</a>
  <ul class="collapse">
  <li><a href="#sec-geom_bar" id="toc-sec-geom_bar" class="nav-link" data-scroll-target="#sec-geom_bar"><span class="header-section-number">2.1</span> geom_bar</a>
  <ul class="collapse">
  <li><a href="#raising-the-bars-yourself" id="toc-raising-the-bars-yourself" class="nav-link" data-scroll-target="#raising-the-bars-yourself"><span class="header-section-number">2.1.1</span> Raising the bars yourself</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions"><span class="header-section-number">2.1.2</span> Questions</a></li>
  </ul></li>
  <li><a href="#geom_text" id="toc-geom_text" class="nav-link" data-scroll-target="#geom_text"><span class="header-section-number">2.2</span> geom_text</a></li>
  <li><a href="#geom_point" id="toc-geom_point" class="nav-link" data-scroll-target="#geom_point"><span class="header-section-number">2.3</span> geom_point</a>
  <ul class="collapse">
  <li><a href="#questions-1" id="toc-questions-1" class="nav-link" data-scroll-target="#questions-1"><span class="header-section-number">2.3.1</span> Questions</a></li>
  </ul></li>
  <li><a href="#geom_density" id="toc-geom_density" class="nav-link" data-scroll-target="#geom_density"><span class="header-section-number">2.4</span> geom_density</a>
  <ul class="collapse">
  <li><a href="#questions-2" id="toc-questions-2" class="nav-link" data-scroll-target="#questions-2"><span class="header-section-number">2.4.1</span> Questions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#faceting" id="toc-faceting" class="nav-link" data-scroll-target="#faceting"><span class="header-section-number">3</span> faceting</a>
  <ul class="collapse">
  <li><a href="#exporting-plots" id="toc-exporting-plots" class="nav-link" data-scroll-target="#exporting-plots"><span class="header-section-number">3.1</span> Exporting plots</a></li>
  </ul></li>
  <li><a href="#additional-support-on-graphing" id="toc-additional-support-on-graphing" class="nav-link" data-scroll-target="#additional-support-on-graphing"><span class="header-section-number">4</span> Additional support on graphing</a>
  <ul class="collapse">
  <li><a href="#using-r-to-do-descriptive-statistics-and-plot-graphs" id="toc-using-r-to-do-descriptive-statistics-and-plot-graphs" class="nav-link" data-scroll-target="#using-r-to-do-descriptive-statistics-and-plot-graphs"><span class="header-section-number">4.1</span> Using R to do descriptive statistics and plot graphs</a></li>
  </ul></li>
  <li><a href="#seminar-activities" id="toc-seminar-activities" class="nav-link" data-scroll-target="#seminar-activities"><span class="header-section-number">5</span> Seminar activities</a>
  <ul class="collapse">
  <li><a href="#task-1---bar-graphs" id="toc-task-1---bar-graphs" class="nav-link" data-scroll-target="#task-1---bar-graphs"><span class="header-section-number">5.1</span> Task 1 - Bar graphs</a></li>
  <li><a href="#task-2---scatter-graphs" id="toc-task-2---scatter-graphs" class="nav-link" data-scroll-target="#task-2---scatter-graphs"><span class="header-section-number">5.2</span> Task 2 - Scatter graphs</a></li>
  <li><a href="#task-3---plot-distributions-of-wealth-scores" id="toc-task-3---plot-distributions-of-wealth-scores" class="nav-link" data-scroll-target="#task-3---plot-distributions-of-wealth-scores"><span class="header-section-number">5.3</span> Task 3 - Plot distributions of wealth scores</a></li>
  <li><a href="#task-4---plot-distributions-of-scores" id="toc-task-4---plot-distributions-of-scores" class="nav-link" data-scroll-target="#task-4---plot-distributions-of-scores"><span class="header-section-number">5.4</span> Task 4 - Plot distributions of scores</a></li>
  <li><a href="#task-5---plot-distributions-of-scores-by-gender" id="toc-task-5---plot-distributions-of-scores-by-gender" class="nav-link" data-scroll-target="#task-5---plot-distributions-of-scores-by-gender"><span class="header-section-number">5.5</span> Task 5 - Plot distributions of scores by gender</a></li>
  <li><a href="#task-6---facet-wrap-by-country" id="toc-task-6---facet-wrap-by-country" class="nav-link" data-scroll-target="#task-6---facet-wrap-by-country"><span class="header-section-number">5.6</span> Task 6 - Facet wrap by country</a></li>
  <li><a href="#task-7---plot-a-scatter-graph" id="toc-task-7---plot-a-scatter-graph" class="nav-link" data-scroll-target="#task-7---plot-a-scatter-graph"><span class="header-section-number">5.7</span> Task 7 - Plot a scatter graph</a></li>
  <li><a href="#task-8---plot-likert-responses-using-facet-wrapping" id="toc-task-8---plot-likert-responses-using-facet-wrapping" class="nav-link" data-scroll-target="#task-8---plot-likert-responses-using-facet-wrapping"><span class="header-section-number">5.8</span> Task 8 - Plot Likert responses using facet wrapping</a></li>
  <li><a href="#task-9---compare-the-association-between-mathematics-and-science-pv-values-across-three-diverse-countries" id="toc-task-9---compare-the-association-between-mathematics-and-science-pv-values-across-three-diverse-countries" class="nav-link" data-scroll-target="#task-9---compare-the-association-between-mathematics-and-science-pv-values-across-three-diverse-countries"><span class="header-section-number">5.9</span> Task 9 - Compare the association between mathematics and science PV values across three diverse countries</a></li>
  </ul></li>
  <li><a href="#extension-tasks" id="toc-extension-tasks" class="nav-link" data-scroll-target="#extension-tasks"><span class="header-section-number">6</span> Extension tasks</a>
  <ul class="collapse">
  <li><a href="#task-1---binning-data" id="toc-task-1---binning-data" class="nav-link" data-scroll-target="#task-1---binning-data"><span class="header-section-number">6.1</span> Task 1 - Binning data</a></li>
  <li><a href="#task-2---histograms" id="toc-task-2---histograms" class="nav-link" data-scroll-target="#task-2---histograms"><span class="header-section-number">6.2</span> Task 2 - Histograms</a></li>
  <li><a href="#task-3---plotting-data-on-maps" id="toc-task-3---plotting-data-on-maps" class="nav-link" data-scroll-target="#task-3---plotting-data-on-maps"><span class="header-section-number">6.3</span> Task 3 - Plotting data on maps</a></li>
  <li><a href="#task-4---violin-plots" id="toc-task-4---violin-plots" class="nav-link" data-scroll-target="#task-4---violin-plots"><span class="header-section-number">6.4</span> Task 4 - Violin plots</a></li>
  </ul></li>
  <li><a href="#useful-resources" id="toc-useful-resources" class="nav-link" data-scroll-target="#useful-resources"><span class="header-section-number">7</span> Useful resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Making graphs</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The tidyverse includes the incredibly powerful <code>ggplot2</code> package. This package is pretty much the industry standard for making graphs for publication. <code>ggplot2</code> is built on the <em>grammar of graphics</em> where you build graphs by specifying underlying attributes and layering geometric objects on top of each other. In the diagram below you can see how a graph is built from <em>geometric objects</em> (the things that are plotted such as points and bars) a <em>scale</em>, and <em>plot annotations</em> (e.g.&nbsp;a key, title etc). You can then apply <em>faceting</em> to the graph to automatically split one graph into multiple plots, allowing you to easily compare different groupings. Publications, such as the Financial Times, make daily use of <code>ggplot2</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://vita.had.co.nz/papers/layered-grammar.pdf"><img src="images/grammarofgraphics.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Adapted from A Layered Grammar of Graphics, Wickham, 2010"></a></p>
</figure>
</div>
<figcaption>Adapted from A Layered Grammar of Graphics, Wickham, 2010</figcaption>
</figure>
</div>
<section id="sec-graphing" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> ggplot</h1>
<p>The basic structure of <code>ggplot</code> code is to combine different graphing elements through the use of the <code>+</code> operator. To demonstrate this, let’s look at the relationship between a poverty indicator <code>ESCS</code> and the performance in Maths <code>PV1MATH</code>, by gender <code>ST004D01T</code> and country <code>CNT</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-1-1"><a href="#annotated-cell-1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2"></a><span class="co"># wrangle our data</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-3" class="code-annotation-target"><a href="#annotated-cell-1-3"></a>graph_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-1-4"><a href="#annotated-cell-1-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"France"</span>, <span class="st">"United Kingdom"</span>))</span>
<span id="annotated-cell-1-5"><a href="#annotated-cell-1-5"></a></span>
<span id="annotated-cell-1-6"><a href="#annotated-cell-1-6"></a><span class="co"># display a graph of the results</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-1-7" class="code-annotation-target"><a href="#annotated-cell-1-7"></a><span class="fu">ggplot</span>(<span class="at">data =</span> graph_data,</span>
<span id="annotated-cell-1-8"><a href="#annotated-cell-1-8"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ESCS, <span class="at">y =</span> PV1MATH, <span class="at">colour =</span> CNT)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-1-9" class="code-annotation-target"><a href="#annotated-cell-1-9"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-1-10" class="code-annotation-target"><a href="#annotated-cell-1-10"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'lm'</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-1-11" class="code-annotation-target"><a href="#annotated-cell-1-11"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> ST004D01T) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-1-12" class="code-annotation-target"><a href="#annotated-cell-1-12"></a>  <span class="fu">ggtitle</span>(<span class="st">"Comparison of poverty indicator and Maths result, by gender and country"</span>) <span class="sc">+</span></span>
<span id="annotated-cell-1-13"><a href="#annotated-cell-1-13"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="3,4" data-code-annotation="1">Hopefully you can work out what lines 1-3 do from the previous chapter, let’s focus on the <code>ggplot</code> commands</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="7,8" data-code-annotation="2">line 7-8 set up the <code>ggplot</code> giving it the table object <code>graph_data</code> as its data input and setting up the aesthetics for the rest of the graph elements using columns from <code>graph_data</code>. The <code>aes(&lt;attribute&gt;, &lt;attribute&gt;, ...)</code> command allows us to specify aesthetic elements of the graph that will change dependent on the dataset we use. In the PISA_2022 data set, the variable <code>ESCS</code> refers to an index of economic status, and <code>PV1Math</code>, is the plausible value of the mathematics score. We set the x and y variables <code>x=ESCS</code> and <code>y=PV1MATH</code> , defining <code>aes()</code> inside <code>ggplot()</code> means we will pass down these values to subsequent geometric objects so we don’t have to define these <code>x</code> and <code>y</code> axis items again and again.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="9" data-code-annotation="3">line 9 using the data and <code>aes</code> values defined on lines 7-8, <code>geom_point</code> uses these <code>x</code> and <code>y</code> values to draw a point for each student in our dataset. There are lots of different parameters we could give <code>geom_point</code> e.g.&nbsp;specifying size and shape, but here we are content with just setting the <code>size</code> to be 0.1 and using the defaults.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="10" data-code-annotation="4">line 10 we add another geometric object on top of the points, this time we add a line of best fit <code>geom_smooth</code>, again this geometric object uses the values specified on lines 7-8, and we define the <code>method</code> as <code>lm</code>, to calculate a <em>linear model</em> line of best fit.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="11" data-code-annotation="5">line 11 uses <code>facet_wrap(. ~ CNT)</code> to create a graph for each group of <code>CNT</code> in the dataset, i.e.&nbsp;a graph for each country defined on line 3.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="12,13" data-code-annotation="6">lines 12 and 13, finally we customise the title of the graph, <code>ggtitle</code>, ready for display and place the legend underneath the graph</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Switching between the pipes and ggplot can get rather confusing. A very common mistake in using ggplot is to try and link together the <code>geom_</code> elements with a pipe command <code>%&gt;%</code> rather than the <code>+</code>.</p>
</div>
</div>
</section>
<section id="geoms" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> geoms</h1>
<p>There are about 40 different geometric objects in ggplot, allowing you to create almost any sort of graph. We will be exploring a few of them in detail, but if you want to explore others, please follow some of the links below:</p>
<ul>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a> for creating bar charts and histograms</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a> for plotting single points</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a> for connecting points together and showing trends</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a> for adding text labels to data points</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a> for representing the range of data</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a> an even better way for representing the range of data</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a> for creating heat maps</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a> for creating histograms</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_map.html">geom_map</a> for adding geographic maps</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a> for adding lines of best fit</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_hline.html">geom_hline</a> for adding static horizontal lines to a graph</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_hline.html">geom_vline</a> for adding static vertical lines to a graph</li>
</ul>
<section id="sec-geom_bar" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sec-geom_bar"><span class="header-section-number">2.1</span> geom_bar</h2>
<p>The <code>geom_bar</code> function is versatile, allowing the creation of bar, multiple bar, stacked bar charts and histograms. This first example shows how we can use bar charts to represent the number of cars in a household <code>ST251Q01JA</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-2-1" class="code-annotation-target"><a href="#annotated-cell-2-1"></a>plot_cars <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ST251Q01JA))</span>
<span id="annotated-cell-2-2"><a href="#annotated-cell-2-2"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-2-3" class="code-annotation-target"><a href="#annotated-cell-2-3"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_cars,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-2-4" class="code-annotation-target"><a href="#annotated-cell-2-4"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST251Q01JA)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-2-5" class="code-annotation-target"><a href="#annotated-cell-2-5"></a>  <span class="fu">geom_bar</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="1" data-code-annotation="1">get the <code>PISA_2022</code> dataset and remove all rows where <code>ST251Q01JA</code> is <code>NA</code>, storing this new dataset as <code>plot_cars</code></span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="3" data-code-annotation="2">pass the <code>plot_cars</code> to <code>ggplot</code>, as the dataset we are going to plot</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="4" data-code-annotation="3">specify the <code>x</code> values to be the values stored in <code>ST251Q01JA</code>, i.e.&nbsp;we will have a bar for each response given in <code>ST251Q01JA</code>: <code>None</code>, <code>One</code>, <code>Two</code>, <code>Three or more</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="5" data-code-annotation="4"><code>geom_bar</code> tell ggplot to make bars, it uses the <code>aes</code>thetic from line 5, to plot the <code>x</code> axis, note we haven’t given it a <code>y</code> value, this is auto-calculated from the number of students in each <code>x</code> group.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can choose to let ggplot split the results into different groups for us by setting a <code>fill</code> option, in this case on the <code>OECD</code> status of the country, i.e.&nbsp;do students in OECD countries have more cars than those not in OECD countries, to do this, we add <code>fill=OECD</code> to the <code>aes</code> on line 2 below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_cars, </span>
<span id="cb1-2"><a href="#cb1-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST251Q01JA, <span class="at">fill=</span>OECD)) <span class="sc">+</span> </span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>The bars are now coloured with a key, but, annoyingly, the bars are on top of each other which makes it hard to make direct comparisons. To compare different groups we need the bars to not be <code>stacked</code>, we want them next to each other, or in <code>ggplot</code> language, we want the bars to <code>dodge</code> each other, to do this we add the <code>position=position_dodge()</code> command to line 3 below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_cars, </span>
<span id="cb2-2"><a href="#cb2-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST251Q01JA, <span class="at">fill=</span>OECD)) <span class="sc">+</span> </span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<section id="raising-the-bars-yourself" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="raising-the-bars-yourself"><span class="header-section-number">2.1.1</span> Raising the bars yourself</h3>
<p><code>ggplot</code> can do a lot of the hard work when putting together bar charts, e.g.&nbsp;counting the number of students in each group, but there might also be times when you want to use pipes to calculate summary values that you then want plot. That is, you want to specify the heights of the bars yourself. To do this we <em>will</em> specify the <code>y</code> axis in the <code>aes</code> and use <code>stat="indentity"</code> to tell ggplot that’s what we’re doing. Take the example where you want to find the overall percentage of students for a range of countries getting over <code>500</code> in <code>PV1SCIE</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-5-1" class="code-annotation-target"><a href="#annotated-cell-5-1"></a>plot_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-5-2"><a href="#annotated-cell-5-2"></a>  <span class="fu">group_by</span>(OECD, CNT) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3"></a>  <span class="fu">summarise</span>(<span class="at">all_students =</span> <span class="fu">n</span>(),</span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4"></a>            <span class="at">upper_sci_per =</span> <span class="fu">sum</span>(PV1SCIE <span class="sc">&gt;</span> <span class="dv">500</span>) <span class="sc">/</span> <span class="fu">n</span>())</span>
<span id="annotated-cell-5-5"><a href="#annotated-cell-5-5"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-5-6" class="code-annotation-target"><a href="#annotated-cell-5-6"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data,</span>
<span id="annotated-cell-5-7"><a href="#annotated-cell-5-7"></a>       <span class="fu">aes</span>(<span class="at">x=</span>CNT, <span class="at">y=</span>upper_sci_per)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-5-8" class="code-annotation-target"><a href="#annotated-cell-5-8"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>OECD),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-5-9" class="code-annotation-target"><a href="#annotated-cell-5-9"></a>           <span class="at">position=</span><span class="fu">position_dodge</span>(),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-5-10" class="code-annotation-target"><a href="#annotated-cell-5-10"></a>           <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-5-11" class="code-annotation-target"><a href="#annotated-cell-5-11"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="1,2,3,4" data-code-annotation="1">creates a dataframe <code>plot_data</code> that calculates the percentage of students in each country <code>CNT</code>, that have a science grade <code>PV1SCIE</code> over <code>500</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="6,7" data-code-annotation="2">as we are setting the heights of the bars ourselves, we need to give the ggplot <code>aes</code> command a <code>y</code> value, in this case <code>y=upper_sci_per</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="8" data-code-annotation="3">the <code>geom_bar</code> is given a <code>fill</code> value of <code>OECD</code>, this will allow us to see how countries in and out of the OECD compare</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="9" data-code-annotation="4">we use <code>position=position_dodge()</code> as we want the percentage grades of each country to be next to each other so we can look for differences in heights</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="10" data-code-annotation="5"><code>stat="identity"</code> tells <code>geom_bar</code> that you have defined your own bar heights in the <code>y</code> attribute and not to count the number of rows.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="11" data-code-annotation="6">the <code>theme</code> command helps rotate the x-axis labels 90 degrees, so they don’t overlap.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Alternatively, you can use the <code>geom_col()</code> function that can handle you setting the <code>y</code> values and not specifying <code>stat="identity"</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, </span>
<span id="cb3-2"><a href="#cb3-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>CNT, <span class="at">y=</span>upper_sci_per)) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill=</span>OECD), </span>
<span id="cb3-4"><a href="#cb3-4"></a>           <span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="questions" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="questions"><span class="header-section-number">2.1.2</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Can you spot the 4 errors in this code.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>schools <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Phase <span class="sc">==</span> <span class="st">"Secondary"</span>), </span>
<span id="cb4-2"><a href="#cb4-2"></a>       <span class="at">x=</span>Region <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">as</span>(<span class="at">fill=</span>Gender) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>answer</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>schools <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Phase <span class="sc">==</span> <span class="st">"Secondary"</span>), </span>
<span id="cb5-2"><a href="#cb5-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>Region)) <span class="sc">+</span> <span class="co"># 1 no aes() around the x value # 2 missing close brackets</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>Gender)) <span class="co"># 3 aes not as # 4 missing closing bracket</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Create a bar chart showing the total number of students for each grouping of “How satisfied are you with each of the following: The way that you look” <code>WB155Q02HA</code>. Adjust this graph to see if there is a difference for this among females and males:</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>answer</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>PISA_2022,</span>
<span id="cb6-2"><a href="#cb6-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>WB155Q02HA)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>answer with gender added</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(WB155Q02HA)),</span>
<span id="cb7-2"><a href="#cb7-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>WB155Q02HA, <span class="at">fill=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Plot bars for the number of Females and Males <code>ST004D01T</code> who answer each grouping for: “Confident can do in future: : Finding learning resources online on my own” <code>ST355Q03JA</code>. Make sure that the bars <code>position_dodge()</code> each other so we can compare the heights.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>answer</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>graph_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ST355Q03JA))</span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>graph_data,</span>
<span id="cb8-4"><a href="#cb8-4"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST355Q03JA, <span class="at">fill=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>For France and the United Kingdom, plot the total number of students who gave each answer for <code>ST324Q11JA</code> “Agree/disagree: School has been a waste of time.”. Filter out all the <code>NA</code> values first <code>!is.na(...)</code></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>answer dataframe</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>plot_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">filter</span>(CNT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"France"</span>, <span class="st">"United Kingdom"</span>),</span>
<span id="cb9-3"><a href="#cb9-3"></a>         <span class="sc">!</span><span class="fu">is.na</span>(ST324Q11JA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>answer</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">ggplot</span>(plot_data,</span>
<span id="cb10-2"><a href="#cb10-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST324Q11JA, <span class="at">fill=</span>CNT)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="5" type="1">
<li>Using the <code>PISA_2022_school</code> dataset (available <a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EaEQPEKYzR9MmiqLBYXOhmYBNXYg15UoDKGip-78kS1DvA?e=q74fyK">here</a> create a table that stores for each country <code>CNT</code></li>
</ol>
<ul>
<li>the total number of full-time teacher, <code>SC018Q01TA01</code></li>
<li>the total number of full-time teachers with a bachelors qualification <code>SC018Q08JA01</code></li>
<li>the total number of full-time teachers with a master’s qualification <code>SC018Q01TA01</code></li>
<li>the total number of full-time teachers with a doctoral qualification <code>SC018Q10JA01</code></li>
</ul>
<p>Add an additional column working out the % of teachers with master’s in each country, call this <code>per_MA</code></p>
<div class="cell">
<details class="code-fold">
<summary>creating the dataframe</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>plot_workforce <span class="ot">&lt;-</span> PISA_2022_school <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">summarise</span>(<span class="at">schools =</span> <span class="fu">n</span>(),</span>
<span id="cb11-4"><a href="#cb11-4"></a>            <span class="at">total =</span> <span class="fu">sum</span>(SC018Q01TA01, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb11-5"><a href="#cb11-5"></a>            <span class="at">BA =</span>    <span class="fu">sum</span>(SC018Q08JA01, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb11-6"><a href="#cb11-6"></a>            <span class="at">PHD =</span>   SC018Q10JA01 <span class="sc">%&gt;%</span> <span class="fu">sum</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb11-7"><a href="#cb11-7"></a>            <span class="at">MA =</span>    SC018Q09JA01 <span class="sc">%&gt;%</span> <span class="fu">sum</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb11-8"><a href="#cb11-8"></a>            <span class="at">per_MA =</span> MA <span class="sc">*</span><span class="dv">100</span> <span class="sc">/</span> total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Using this dataframe plot a bar graph for each country of the <code>per_MA</code>, use the number of schools as a <code>fill</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>creating the graph</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_workforce,</span>
<span id="cb12-2"><a href="#cb12-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>CNT, <span class="at">y=</span>per_MA, <span class="at">fill=</span>schools)) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="6" type="1">
<li>[Extension] Explore other patterns in the school and student Pisa datasets.</li>
</ol>
</div>
</section>
</section>
<section id="geom_text" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="geom_text"><span class="header-section-number">2.2</span> geom_text</h2>
<p>Our bar charts look great, but finding the actual value of each bar can be a little clumsy if we have to get a ruler out and read off the y-axis. Better would be for us to have numbers listed at the top of each bar by adding a <code>geom_text</code> element:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1"></a>plot_cars <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ST251Q01JA))</span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2"></a></span>
<span id="annotated-cell-7-3"><a href="#annotated-cell-7-3"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_cars, </span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST251Q01JA, <span class="at">fill=</span>OECD)) <span class="sc">+</span> </span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-7-6" class="code-annotation-target"><a href="#annotated-cell-7-6"></a>  <span class="fu">geom_text</span>(<span class="at">stat=</span><span class="st">'count'</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-7-7" class="code-annotation-target"><a href="#annotated-cell-7-7"></a>            <span class="fu">aes</span>(<span class="at">label=</span><span class="fu">after_stat</span>(count)),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-7-8" class="code-annotation-target"><a href="#annotated-cell-7-8"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-7-9" class="code-annotation-target"><a href="#annotated-cell-7-9"></a>            <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.5</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="6" data-code-annotation="1">line 6 starts the <code>geom_text</code> command, telling the geom to use the <code>count</code> <code>stat</code>istic from ggplot, this means it will be able to fetch the number of rows in each grouping.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="7" data-code-annotation="2">as we want the label to change for each bar element, we put <code>label=after_stat(count)</code> inside <code>aes</code>. The <code>x</code> location of the labels is inherited from line 4 and the <code>y</code> location will be calculated from the height of each bar</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="8" data-code-annotation="3">we want the labels to align to the bars, so we tell the <code>geom_text</code> to also <code>position_dodge</code>, passing a <code>width=0.9</code> to the dodge function, so the labels line up above the columns,</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="9" data-code-annotation="4">finally, on line 9, we vertically adjust the labels <code>vjust</code>, so they sit on top of the columns.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Rather than adding the count, you might want to add the percentage that each bar represents, we can do this by changing the value given to label on line 5, below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_cars, </span>
<span id="cb13-2"><a href="#cb13-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST251Q01JA, <span class="at">fill=</span>OECD)) <span class="sc">+</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">geom_text</span>(<span class="at">stat=</span><span class="st">'count'</span>, </span>
<span id="cb13-5"><a href="#cb13-5"></a>            <span class="fu">aes</span>(<span class="at">label=</span><span class="dv">100</span><span class="sc">*</span>(<span class="fu">after_stat</span>(count)<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">after_stat</span>(count))) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>), </span>
<span id="cb13-6"><a href="#cb13-6"></a>            <span class="at">group =</span> OECD), </span>
<span id="cb13-7"><a href="#cb13-7"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>),</span>
<span id="cb13-8"><a href="#cb13-8"></a>            <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_point" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="geom_point"><span class="header-section-number">2.3</span> geom_point</h2>
<p>To plot a scatter plot, we use <code>geom_point</code>. For example, to plot reading scores against mathematics scores in the UK we: a) create a data set of reading and science scores after filtering for UK; b) pass the data to <code>ggplot</code>; c) use <code>aes</code> to specify the x and y variables and d) plot with <code>geom_point()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Create a data.frame of the UK's science and reading scores</span></span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a>UKplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">select</span>(CNT, PV1READ, PV1SCIE) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co"># Plot the data on a scatter graph using geom_point</span></span>
<span id="cb14-8"><a href="#cb14-8"></a></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="fu">ggplot</span>(UKplot, <span class="fu">aes</span>(<span class="at">x =</span> PV1READ, <span class="at">y =</span> PV1SCIE)) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>That graph is quite dense, so we can use the <code>alpha</code> function to make the points slightly transparent, <code>size</code> to make them smaller, and set their colour. I will also tidy up the axis names and add a line (note that in: <code>geom_smooth(method = "lm", colour = "black")</code> <code>method = "lm"</code> sets the line to a straight (i.e., linear model, lm) line).</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-10-1"><a href="#annotated-cell-10-1"></a><span class="co"># Create a data.frame of the UK's science and reading scores</span></span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2"></a></span>
<span id="annotated-cell-10-3"><a href="#annotated-cell-10-3"></a>UKplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-10-4"><a href="#annotated-cell-10-4"></a>  <span class="fu">select</span>(CNT, PV1READ, PV1SCIE) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-10-5"><a href="#annotated-cell-10-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="annotated-cell-10-6"><a href="#annotated-cell-10-6"></a></span>
<span id="annotated-cell-10-7"><a href="#annotated-cell-10-7"></a><span class="co"># Plot the data on a scatter graph using geom_point</span></span>
<span id="annotated-cell-10-8"><a href="#annotated-cell-10-8"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-10-9" class="code-annotation-target"><a href="#annotated-cell-10-9"></a><span class="fu">ggplot</span>(UKplot, <span class="fu">aes</span>(<span class="at">x =</span> PV1READ, <span class="at">y =</span> PV1SCIE)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-10-10" class="code-annotation-target"><a href="#annotated-cell-10-10"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-10-11" class="code-annotation-target"><a href="#annotated-cell-10-11"></a>  <span class="fu">xlab</span>(<span class="st">"Reading score"</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-10-12" class="code-annotation-target"><a href="#annotated-cell-10-12"></a>  <span class="fu">ylab</span>(<span class="st">"Science score"</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="8" onclick="event.preventDefault();">8</a><span id="annotated-cell-10-13" class="code-annotation-target"><a href="#annotated-cell-10-13"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">colour =</span> <span class="st">"black"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="9" data-code-annotation="4">line 4 - set the data to plot and set which variable goes on the x and y axis</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="10" data-code-annotation="5">line 5 - set the point size (<code>size=0.1</code>), colour (<code>colour = "red"</code>) and opacity (<code>alpha = 0.6</code>)</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="11" data-code-annotation="6">line 6 - set the x-axis title</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="12" data-code-annotation="7">line 7 - set the y-axis title</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="13" data-code-annotation="8">line 8 - plot a straight line (<code>method = "lm"</code>) and set its colour to black</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can set the colour of points using another variable inside the aesthetics. For example to change the colour of points by gender you can use <code>aes(colour = ST004D01T)</code> which gives the points for male and female students different colours.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Create a data.frame of the UK's science and reading scores</span></span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>UKplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">select</span>(CNT, PV1READ, PV1SCIE, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="fu">ggplot</span>(UKplot, <span class="fu">aes</span>(<span class="at">x =</span> PV1READ, <span class="at">y =</span> PV1SCIE, <span class="at">colour =</span> ST004D01T)) <span class="sc">+</span>             </span>
<span id="cb15-8"><a href="#cb15-8"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span>     </span>
<span id="cb15-9"><a href="#cb15-9"></a>  <span class="fu">xlab</span>(<span class="st">"Reading score"</span>) <span class="sc">+</span>                                   </span>
<span id="cb15-10"><a href="#cb15-10"></a>  <span class="fu">ylab</span>(<span class="st">"Science score"</span>) <span class="sc">+</span>                                   </span>
<span id="cb15-11"><a href="#cb15-11"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">colour =</span> <span class="st">"black"</span>)     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>When you specify colours by a variable, ggplot with use the default colour palette (a red and a teal colour for two variables). To set your own choice of colours you can use <code>scale_colour_manual(values = c())</code> linking the values of the varibale to colours. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Create a data.frame of the UK's science and reading scores</span></span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>UKplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">select</span>(CNT, PV1READ, PV1SCIE, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="fu">ggplot</span>(UKplot, <span class="fu">aes</span>(<span class="at">x =</span> PV1READ, <span class="at">y =</span> PV1SCIE, <span class="at">colour =</span> ST004D01T)) <span class="sc">+</span>             </span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Male"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Female"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span> <span class="co"># Manually change male points to red and female to blue</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>  <span class="fu">xlab</span>(<span class="st">"Reading score"</span>) <span class="sc">+</span>                                   </span>
<span id="cb16-11"><a href="#cb16-11"></a>  <span class="fu">ylab</span>(<span class="st">"Science score"</span>) <span class="sc">+</span>                                   </span>
<span id="cb16-12"><a href="#cb16-12"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">colour =</span> <span class="st">"black"</span>)     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Note that you need to match the aesthetic you want to change, if you are plotting a bar plot, where the aesthetic impacting the colour is <code>fill</code> (rather than the <code>colour</code> for <code>geom_point</code> above), you need to use <code>scale_fill_manual(values = c("Male" = "red", "Female" = "blue"))</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Create a data.frame of the UK's science scores by gender</span></span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a>UKplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">select</span>(CNT, PV1SCIE, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="fu">group_by</span>(ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="fu">summarise</span>(<span class="at">mean_sci =</span> <span class="fu">mean</span>(PV1SCIE, <span class="at">na.rm =</span> T))</span>
<span id="cb17-8"><a href="#cb17-8"></a>                            </span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co"># Create a bar plot                            </span></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="fu">ggplot</span>(UKplot, <span class="fu">aes</span>(<span class="at">x =</span> ST004D01T, <span class="at">y =</span> mean_sci, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span>             </span>
<span id="cb17-11"><a href="#cb17-11"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="fu">position_dodge2</span>()) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Male"</span> <span class="ot">=</span> <span class="st">"lightgreen"</span>, <span class="st">"Female"</span> <span class="ot">=</span> <span class="st">"orange"</span>))  <span class="co"># Manually change bar fill</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Additionally, when we make graphs we often want to label the data set, for example if we were to plot all the countries and their <code>PV1MATH</code> and <code>PV1READ</code> scores, we would get:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>plot_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">group_by</span>(OECD, CNT) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">summarise</span>(<span class="at">m_read  =</span> <span class="fu">mean</span>(PV1READ, <span class="at">na.rm=</span><span class="st">"TRUE"</span>),</span>
<span id="cb18-4"><a href="#cb18-4"></a>            <span class="at">m_maths =</span> <span class="fu">mean</span>(PV1MATH, <span class="at">na.rm=</span><span class="st">"TRUE"</span>))</span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, </span>
<span id="cb18-7"><a href="#cb18-7"></a>       <span class="fu">aes</span>(<span class="at">x=</span>m_read, <span class="at">y=</span>m_maths, <span class="at">colour=</span>OECD)) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="fu">geom_point</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>This looks great, but we don’t actually know which countries are which. To get this data we need to add text to the graph, using <code>geom_text</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, </span>
<span id="cb19-2"><a href="#cb19-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>m_read, <span class="at">y=</span>m_maths, <span class="at">colour=</span>OECD)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>CNT), </span>
<span id="cb19-5"><a href="#cb19-5"></a>            <span class="at">colour=</span><span class="st">"black"</span>, </span>
<span id="cb19-6"><a href="#cb19-6"></a>            <span class="at">check_overlap =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Here we have used <code>colour="black"</code> outside the <code>aes</code> to define the colour for all the labels, and <code>check_overlap = TRUE</code> which removes any labels that are on top of each other. It’s still a little bit hard to understand, and maybe we want to focus on just a few of the labels for countries we are interested in. For example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># make a vector of countries you want to have labels for</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>focus_cnt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"United Kingdom"</span>, <span class="st">"France"</span>, <span class="st">"Argentina"</span>)</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co"># add a new column to the plot_data where these countries are</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">focus =</span> CNT <span class="sc">%in%</span> focus_cnt)</span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a>plot_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 5
# Groups:   OECD [2]
   OECD  CNT                  m_read m_maths focus
   &lt;fct&gt; &lt;fct&gt;                 &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt;
 1 No    Albania                359.    368. FALSE
 2 No    United Arab Emirates   420.    434. FALSE
 3 No    Argentina              413.    389. TRUE 
 4 No    Bulgaria               405.    418. FALSE
 5 No    Brazil                 415.    380. FALSE
 6 No    Brunei Darussalam      428.    440. FALSE
 7 No    Dominican Republic     354.    340. FALSE
 8 No    Georgia                374.    390. FALSE
 9 No    Guatemala              377.    346. FALSE
10 No    Hong Kong (China)      504.    545. FALSE
# ℹ 70 more rows</code></pre>
</div>
</div>
<p>Now we can adjust out <code>geom_text</code> to only show those countries that we want to focus on:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-14-1"><a href="#annotated-cell-14-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, </span>
<span id="annotated-cell-14-2"><a href="#annotated-cell-14-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>m_read, <span class="at">y=</span>m_maths, <span class="at">colour=</span>OECD)) <span class="sc">+</span></span>
<span id="annotated-cell-14-3"><a href="#annotated-cell-14-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-14-4" class="code-annotation-target"><a href="#annotated-cell-14-4"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>plot_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(focus <span class="sc">==</span> <span class="cn">TRUE</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-14-5" class="code-annotation-target"><a href="#annotated-cell-14-5"></a>            <span class="fu">aes</span>(<span class="at">label=</span>CNT),</span>
<span id="annotated-cell-14-6"><a href="#annotated-cell-14-6"></a>            <span class="at">colour=</span><span class="st">"black"</span>, </span>
<span id="annotated-cell-14-7"><a href="#annotated-cell-14-7"></a>            <span class="at">check_overlap =</span> <span class="cn">TRUE</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="4" data-code-annotation="1">changes the data that is being passed to the <code>geom_text</code>, it no longer uses the data defined in the <code>ggplot</code> command, but has a new dataset, that is filtered on <code>focus == TRUE</code>, i.e.&nbsp;only containing the countries that we want.</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="5" data-code-annotation="2">Note that the <code>x</code> and <code>y</code> mappings from line 2 are inherited by line 6, it’s only the data that we have redefined</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>geom_text</code> is great, but you might find that <code>ggrepel</code> package useful as it’ll add lines connecting the text the data points. Using the <code>plot_data</code> from above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, </span>
<span id="cb22-4"><a href="#cb22-4"></a>       <span class="fu">aes</span>(<span class="at">x=</span>m_read, <span class="at">y=</span>m_maths, <span class="at">colour=</span>OECD)) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>plot_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(focus <span class="sc">==</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-7"><a href="#cb22-7"></a>            <span class="fu">aes</span>(<span class="at">label=</span>CNT),</span>
<span id="cb22-8"><a href="#cb22-8"></a>            <span class="at">box.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb22-9"><a href="#cb22-9"></a>            <span class="at">max.overlaps =</span> <span class="cn">Inf</span>,</span>
<span id="cb22-10"><a href="#cb22-10"></a>            <span class="at">colour=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<section id="questions-1" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="questions-1"><span class="header-section-number">2.3.1</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Plot a scatter graph of reading scores on the y-axis (<code>PV1READ</code>) against wealth (<code>HOMEPOS</code>) on the x-axis for students in the UK. Colour the points by gender, add a linear trend line and rename the axes and title</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>answer graph</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>UKdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">select</span>(PV1READ, CNT, HOMEPOS, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="fu">ggplot</span>(UKdata, <span class="fu">aes</span>(<span class="at">x =</span> HOMEPOS, <span class="at">y =</span> PV1READ, <span class="at">colour =</span> ST004D01T)) <span class="sc">+</span> </span>
<span id="cb23-6"><a href="#cb23-6"></a> <span class="fu">geom_point</span>(<span class="at">size =</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7"></a> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8"></a> <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">"Wealth"</span>, <span class="at">y =</span> <span class="st">"Reading score"</span>, <span class="at">title =</span> <span class="st">"UK reading vs wealth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Using the <code>PISA_2022</code> dataset, plot a graph for students from <code>Norway</code> to look at the relationship between <em>Home Possessions (WLE)</em> <code>HOMEPOS</code> and <em>reading grade</em> <code>PV1READ</code>. Colour each point with the gender <code>ST004D01T</code> of the student. Give the graph sensible <code>x</code> and <code>y</code> labels by using <code>xlab("label")</code> and <code>ylab("label")</code></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>answer dataframe</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>graph_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Norway"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>answer graph</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">ggplot</span>(graph_data,</span>
<span id="cb25-2"><a href="#cb25-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>HOMEPOS,</span>
<span id="cb25-3"><a href="#cb25-3"></a>           <span class="at">y=</span>PV1READ)) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="fu">xlab</span>(<span class="st">"Home possessions"</span>) <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="fu">ylab</span>(<span class="st">"Reading grade"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Using the <code>PISA_2022</code> dataset for each country <code>CNT</code>, create a graph to explore how the <code>median</code> of the sense of school belonging <code>BELONG</code> relates to the <code>median</code> of the disciplinary climate in mathematics <code>DISCLIM</code>, adjust the colour of each point to reflect the <code>mean</code> of students in each country <code>ESCS</code>.</li>
</ol>
<p><strong>HINT:</strong> You’ll need create a new data frame with <code>summarise</code>d variables for <code>median_belong</code>, <code>median_discipline</code> and <code>mean_wealth</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>answer dataframe</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>graph_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">group_by</span>(OECD, CNT) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">summarise</span>(<span class="at">median_belong =</span> <span class="fu">median</span>(BELONG, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb26-4"><a href="#cb26-4"></a>            <span class="at">median_discipline =</span> <span class="fu">median</span>(DISCLIM, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb26-5"><a href="#cb26-5"></a>            <span class="at">mean_wealth =</span> <span class="fu">mean</span>(ESCS, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>HINT:</strong> To make your colours stand out more, add <code>+ scale_color_gradientn(colours = rainbow(3))</code> to the end of your plot.</p>
<div class="cell">
<details class="code-fold">
<summary>answer graph</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># display a graph of the results</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> graph_data, </span>
<span id="cb27-3"><a href="#cb27-3"></a>       <span class="fu">aes</span>(<span class="at">x =</span> median_belong, </span>
<span id="cb27-4"><a href="#cb27-4"></a>           <span class="at">y =</span> median_discipline)) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> mean_wealth)) <span class="sc">+</span> </span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">rainbow</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
</section>
<section id="geom_density" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="geom_density"><span class="header-section-number">2.4</span> geom_density</h2>
<p>An alternative type of plot is the density plot, which is a kind of continuous histogram. The density plot can be useful for visualising the achievement scores of students. For example, the mathematics scores of girls and boys (recall the gender variable is <code>ST004D01T</code>) in the US. We use <code>na.omit</code> to omit <code>NA</code>s. Notice, for the plot, I use <code>aes</code> to set my x variable, and then specify that the plot should fill by gender (<code>fill=ST004D01T</code>). Finally, in <code>geom_density(alpha=0.6)</code> I set the alpha to 0.6 to make the fill areas partially transparent.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The y-axis on a density plot is chosen so that the total area under the graph adds up to 1</p>
</div>
</div>
<div class="cell" data-eva="true">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Create a data.frame of US Math data including gender</span></span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a>USMathplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="fu">select</span>(CNT, PV1MATH, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United States"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb28-7"><a href="#cb28-7"></a></span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="co"># Plot a density chart, seeting the fill by gender, and setting the opacity to</span></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="co"># 0.6 to show both gender plots</span></span>
<span id="cb28-10"><a href="#cb28-10"></a></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="fu">ggplot</span>(USMathplot, <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For a summary of all the elements of a graph you can change in <code>ggplot</code> - see this <a href="https://posit.co/wp-content/uploads/2022/10/data-visualization-1.pdf">help sheet</a>.</p>
</div>
</div>
<section id="questions-2" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="questions-2"><span class="header-section-number">2.4.1</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Plot a density graph of maths scores for students in the UK, filling by gender.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>answer graph</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>UKdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">select</span>(PV1MATH, CNT, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb29-4"><a href="#cb29-4"></a></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="fu">ggplot</span>(UKdata, <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">fill =</span> ST004D01T, <span class="at">alpha =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb29-6"><a href="#cb29-6"></a> <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7"></a> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Maths score"</span>, <span class="at">title =</span> <span class="st">"UK maths score"</span>, <span class="at">fill =</span><span class="st">"gender"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Create a dataframe of <code>ESCS</code> (social class data) for the countries: the UK, Brazil, Qatar and Jamaica. Plot the results as a density graph with a curve for each country.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>answer graph</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>country_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">select</span>(CNT, ESCS) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Brazil"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Qatar"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Jamaica"</span>)</span>
<span id="cb30-4"><a href="#cb30-4"></a></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="fu">ggplot</span>(country_data, <span class="fu">aes</span>(<span class="at">x =</span> ESCS, <span class="at">fill =</span> CNT, <span class="at">alpha =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb30-6"><a href="#cb30-6"></a> <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7"></a> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"ESCS (class)"</span>, <span class="at">title =</span> <span class="st">"Distribution of class in 4 countries"</span>, <span class="at">fill =</span><span class="st">"country"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
</section>
</section>
<section id="faceting" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> faceting</h1>
<p>Faceting allows you to easily create multiple graphs from one dataset and one ggplot definition by splitting the data on different factors, by defining:</p>
<p><code>facet_grid(&lt;column_to_split&gt; ~ .)</code></p>
<p>or</p>
<p><code>facet_grid(. ~ &lt;column_to_split&gt;)</code></p>
<p>Looking at the <code>PISA_2022</code> dataset, we can plot the <code>HOMEPOS</code> and reading test outcome <code>PV1READ</code> variables against each other:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># create a subset of the data for plotting</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>plot_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="fu">select</span>(OECD, CNT, HOMEPOS, PV1READ) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Germany"</span>, </span>
<span id="cb31-5"><a href="#cb31-5"></a>                    <span class="st">"United Kingdom"</span>))</span>
<span id="cb31-6"><a href="#cb31-6"></a></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, <span class="fu">aes</span>(<span class="at">x=</span>HOMEPOS, <span class="at">y=</span>PV1READ)) <span class="sc">+</span> </span>
<span id="cb31-8"><a href="#cb31-8"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb31-9"><a href="#cb31-9"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>But it isn’t clear how this graph varies between countries. We could try plotting separate graphs for each country, but there is a faster way, using:</p>
<p><code>+ facet_grid(CNT ~ .)</code></p>
<p>ggplot will automatically create graphs for subsets of <code>plot_data</code>, split on each different country in <code>CNT</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, <span class="fu">aes</span>(<span class="at">x=</span>HOMEPOS, <span class="at">y=</span>PV1READ)) <span class="sc">+</span> </span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5"></a>  <span class="fu">facet_grid</span>(CNT <span class="sc">~</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>If the column you want to split on it on the left hand side of <code>facet_grid(CNT ~ .)</code>, then the graphs will be piled on top of each other, if it’s on the right hand side <code>facet_grid(. ~ CNT)</code>, then they’ll be side by side.</p>
<div class="question">
<p>Take a subset of the overall dataset, by filtering on a few countries, take another one of your plots and use <code>facet_grid(CNT ~ .)</code> to explore the graphs for different countries.</p>
</div>
<section id="exporting-plots" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="exporting-plots"><span class="header-section-number">3.1</span> Exporting plots</h2>
<p>ggplot can export data in a variety of formats suitable for printing, publication and the web. Once you have created a graph and stored it in an object <code>my_graph &lt;- ggplot(...</code>, the command to save the graph to your hard drive is:</p>
<p><code>ggsave(&lt;file_location_name_and_extension&gt;, &lt;object_name&gt;, width = 5, height = 4, device=&lt;file_ext&gt;)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">ggsave</span>(<span class="st">"my_graph.pdf"</span>, my_graph, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">device=</span><span class="st">"pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to change the output format, just change the extension of the file you are saving:</p>
<ul>
<li>“poverty_size.pdf” perfect for publication and printing, potentially large file size</li>
<li>“poverty_size.svg” the same as pdf, also suitable for putting on webpages</li>
<li>“poverty_size.png” smaller file size, suitable for websites and presentations</li>
<li>“poverty_size.jpg” similar output to png</li>
</ul>
</section>
</section>
<section id="additional-support-on-graphing" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Additional support on graphing</h1>
<section id="using-r-to-do-descriptive-statistics-and-plot-graphs" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="using-r-to-do-descriptive-statistics-and-plot-graphs"><span class="header-section-number">4.1</span> Using R to do descriptive statistics and plot graphs</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/J6yN0y1sm5g?start=2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
</iframe>
<p>You can find the code used in the video below:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># Introduction to plotting graphs</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="co">#</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="co"># Download data from /Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/subset/Students_2022_RBDP_none_levels.rds</span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co"># You want the file: Students_2022_RBDP_none_levels.rds</span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="co"># and place in your own file system</span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="co"># change loc to load the data directly. Loading into R might take a few minutes</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb34-8"><a href="#cb34-8"></a>loc <span class="ot">&lt;-</span> <span class="st">"/Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/subset/Students_2022_RBDP_none_levels.rds"</span></span>
<span id="cb34-9"><a href="#cb34-9"></a>PISA_2022 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(loc)</span>
<span id="cb34-10"><a href="#cb34-10"></a></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="co"># Calculating means of groups</span></span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="co"># The PISA_2022 dataframe is piped to a new dataframe MeanPISA</span></span>
<span id="cb34-13"><a href="#cb34-13"></a><span class="co"># The data are grouped by the country variable (CNT)</span></span>
<span id="cb34-14"><a href="#cb34-14"></a><span class="co"># The countries of interest are chosen (UK, France, Germany and the US)</span></span>
<span id="cb34-15"><a href="#cb34-15"></a><span class="co"># The summarise function is used to output the mean and standard deviation score for each country</span></span>
<span id="cb34-16"><a href="#cb34-16"></a><span class="co"># on the Science Plausible Value (PV1SCIE) and NAs are ignored na.rm=TRUE</span></span>
<span id="cb34-17"><a href="#cb34-17"></a></span>
<span id="cb34-18"><a href="#cb34-18"></a>MeanPISA <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb34-19"><a href="#cb34-19"></a>  <span class="fu">group_by</span>(CNT)  <span class="sc">%&gt;%</span></span>
<span id="cb34-20"><a href="#cb34-20"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span> <span class="sc">|</span> CNT<span class="sc">==</span> <span class="st">"France"</span> <span class="sc">|</span> CNT<span class="sc">==</span> <span class="st">"Germany"</span> <span class="sc">|</span> CNT<span class="sc">==</span><span class="st">"United States"</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb34-21"><a href="#cb34-21"></a>  <span class="fu">summarise</span>(<span class="at">mean_sci =</span> <span class="fu">mean</span>(PV1SCIE, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">sd_sci=</span> <span class="fu">sd</span>(PV1SCIE, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) </span>
<span id="cb34-22"><a href="#cb34-22"></a><span class="fu">print</span>(MeanPISA)</span>
<span id="cb34-23"><a href="#cb34-23"></a></span>
<span id="cb34-24"><a href="#cb34-24"></a></span>
<span id="cb34-25"><a href="#cb34-25"></a><span class="co"># To plot data we can use the ggplot function. </span></span>
<span id="cb34-26"><a href="#cb34-26"></a><span class="co"># We will start by plotting a column graph use geom_col</span></span>
<span id="cb34-27"><a href="#cb34-27"></a><span class="co"># We specify the data set for ggplot to use (MeanPisa) and then </span></span>
<span id="cb34-28"><a href="#cb34-28"></a><span class="co"># define the x and y variables:</span></span>
<span id="cb34-29"><a href="#cb34-29"></a><span class="co"># ggplot(MeanPISA,</span></span>
<span id="cb34-30"><a href="#cb34-30"></a><span class="co">#       aes(x=CNT, y=mean_sci))</span></span>
<span id="cb34-31"><a href="#cb34-31"></a><span class="co"># geom_col() (Note the plus is on the line before) plots the graph and the fill colour is set to red</span></span>
<span id="cb34-32"><a href="#cb34-32"></a><span class="co"># The next three lines set the formatting of the axis text and add x and y axis labels</span></span>
<span id="cb34-33"><a href="#cb34-33"></a></span>
<span id="cb34-34"><a href="#cb34-34"></a><span class="fu">ggplot</span>(MeanPISA,</span>
<span id="cb34-35"><a href="#cb34-35"></a>       <span class="fu">aes</span>(<span class="at">x=</span>CNT, <span class="at">y=</span>mean_sci))<span class="sc">+</span></span>
<span id="cb34-36"><a href="#cb34-36"></a><span class="fu">geom_col</span>(<span class="at">fill=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb34-37"><a href="#cb34-37"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust=</span><span class="fl">0.95</span>, <span class="at">vjust=</span><span class="fl">0.2</span>, <span class="at">size=</span><span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb34-38"><a href="#cb34-38"></a>  <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span></span>
<span id="cb34-39"><a href="#cb34-39"></a>  <span class="fu">ylab</span>(<span class="st">"Science Score"</span>)</span>
<span id="cb34-40"><a href="#cb34-40"></a></span>
<span id="cb34-41"><a href="#cb34-41"></a><span class="co"># For plotting a scatter plot or PISA reading scores against science scores</span></span>
<span id="cb34-42"><a href="#cb34-42"></a><span class="co">#, first we make a managable data set</span></span>
<span id="cb34-43"><a href="#cb34-43"></a><span class="co"># I will filter the data set to include only the UK data</span></span>
<span id="cb34-44"><a href="#cb34-44"></a><span class="co"># and remove any NAs</span></span>
<span id="cb34-45"><a href="#cb34-45"></a></span>
<span id="cb34-46"><a href="#cb34-46"></a>UKData <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb34-47"><a href="#cb34-47"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-48"><a href="#cb34-48"></a>  <span class="fu">drop_na</span>(PV1SCIE)</span>
<span id="cb34-49"><a href="#cb34-49"></a></span>
<span id="cb34-50"><a href="#cb34-50"></a><span class="co"># This time I will use ggplot to plot a scatter graph</span></span>
<span id="cb34-51"><a href="#cb34-51"></a><span class="co"># I feed UKDATA to ggplot, specify the x (PISA Reading score)</span></span>
<span id="cb34-52"><a href="#cb34-52"></a><span class="co"># And y (PISA science score). This time, I have linked the colour</span></span>
<span id="cb34-53"><a href="#cb34-53"></a><span class="co"># to a variable (ST004D01T) which is the gender value, giving</span></span>
<span id="cb34-54"><a href="#cb34-54"></a><span class="co"># plot points of different colours for boys and girls</span></span>
<span id="cb34-55"><a href="#cb34-55"></a><span class="co"># To produce a scatter plot, I use geom_point to plot points,</span></span>
<span id="cb34-56"><a href="#cb34-56"></a><span class="co"># Giving the size of point and the transparency (alpha=0.5) -</span></span>
<span id="cb34-57"><a href="#cb34-57"></a><span class="co"># some transparency of points is helpful when plots become dense</span></span>
<span id="cb34-58"><a href="#cb34-58"></a><span class="co"># The x and y lables are added</span></span>
<span id="cb34-59"><a href="#cb34-59"></a><span class="co"># Finally, a line is plotted - geom_smooth(method='lm')</span></span>
<span id="cb34-60"><a href="#cb34-60"></a><span class="co"># sets the line to a linear ('lm') line</span></span>
<span id="cb34-61"><a href="#cb34-61"></a></span>
<span id="cb34-62"><a href="#cb34-62"></a>  <span class="fu">ggplot</span>(UKData,</span>
<span id="cb34-63"><a href="#cb34-63"></a>       <span class="fu">aes</span>(<span class="at">x=</span>PV1READ, <span class="at">y=</span>PV1SCIE, <span class="at">colour=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb34-64"><a href="#cb34-64"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-65"><a href="#cb34-65"></a>  <span class="fu">ylab</span>(<span class="st">"Science Score"</span>) <span class="sc">+</span></span>
<span id="cb34-66"><a href="#cb34-66"></a>  <span class="fu">xlab</span>(<span class="st">"Reading Score"</span>) <span class="sc">+</span></span>
<span id="cb34-67"><a href="#cb34-67"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>)</span>
<span id="cb34-68"><a href="#cb34-68"></a>  </span>
<span id="cb34-69"><a href="#cb34-69"></a><span class="co"># Where R becomes very powerful is being able to produce multiple charts rapidly</span></span>
<span id="cb34-70"><a href="#cb34-70"></a><span class="co"># In the code below, I plot reading against science scores as above, but this time</span></span>
<span id="cb34-71"><a href="#cb34-71"></a><span class="co"># Use the entire data set - for the whole world!</span></span>
<span id="cb34-72"><a href="#cb34-72"></a><span class="co"># All the steps are the same, except, I use the facet_wrap, a way to create multiple</span></span>
<span id="cb34-73"><a href="#cb34-73"></a><span class="co"># graph panels - the instruction creates a set of graphs for each country  </span></span>
<span id="cb34-74"><a href="#cb34-74"></a>  </span>
<span id="cb34-75"><a href="#cb34-75"></a>  WorldData <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb34-76"><a href="#cb34-76"></a>    <span class="fu">drop_na</span>(PV1SCIE)</span>
<span id="cb34-77"><a href="#cb34-77"></a>  </span>
<span id="cb34-78"><a href="#cb34-78"></a>  <span class="fu">ggplot</span>(WorldData,</span>
<span id="cb34-79"><a href="#cb34-79"></a>         <span class="fu">aes</span>(<span class="at">x=</span>PV1READ, <span class="at">y=</span>PV1SCIE, <span class="at">colour=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb34-80"><a href="#cb34-80"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-81"><a href="#cb34-81"></a>    <span class="fu">ylab</span>(<span class="st">"Science Score"</span>) <span class="sc">+</span></span>
<span id="cb34-82"><a href="#cb34-82"></a>    <span class="fu">xlab</span>(<span class="st">"Reading Score"</span>) <span class="sc">+</span></span>
<span id="cb34-83"><a href="#cb34-83"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb34-84"><a href="#cb34-84"></a>    <span class="fu">facet_wrap</span>(CNT<span class="sc">~</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="seminar-activities" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Seminar activities</h1>
<section id="task-1---bar-graphs" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="task-1---bar-graphs"><span class="header-section-number">5.1</span> Task 1 - Bar graphs</h2>
<div class="question">
<ul>
<li><p><code>ST038Q08NA</code> asks students in the past 12 months, how often do other students spread nasty rumours about them. Plot a graph of how often students spread rumours in the UK and France.</p></li>
<li><p>Extensions: You can use <code>xlab("&lt;x axis label&gt;")</code> and <code>ylab("&lt;x axis label&gt;")</code> to label the axes. A title can be added using: <code>ggtitle("&lt;title")</code>. ’You can rotate the text on the x axis through 90 degrees using: <code>theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))</code></p></li>
</ul>
</div>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Select country and question data and Filter for the UK and France</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>Rumplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="fu">select</span>(CNT, ST038Q08NA) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"France"</span>)</span>
<span id="cb35-5"><a href="#cb35-5"></a></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="co"># use rumour data to create a graph</span></span>
<span id="cb35-7"><a href="#cb35-7"></a><span class="co"># Set x as the item on culture and fill by the country</span></span>
<span id="cb35-8"><a href="#cb35-8"></a><span class="co"># Remember to use position dodge to plot the bars side by side</span></span>
<span id="cb35-9"><a href="#cb35-9"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Rumplot,</span>
<span id="cb35-10"><a href="#cb35-10"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ST038Q08NA, <span class="at">fill =</span> CNT)) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge2"</span>) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12"></a>  <span class="fu">xlab</span>(<span class="st">"Do students spread rumours about you?"</span>) <span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13"></a>  <span class="fu">ylab</span>(<span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb35-14"><a href="#cb35-14"></a>  <span class="fu">ggtitle</span>(<span class="st">"Spreading rumours: France vs. the UK"</span>) <span class="sc">+</span></span>
<span id="cb35-15"><a href="#cb35-15"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb35-16"><a href="#cb35-16"></a>  <span class="co"># Rotate axis text</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="question">
<ul>
<li><code>PA195Q01JA</code> asks students how many books are in their home. Plot a bar graph for students in Germany. Then plot a graph splitting the data by gender (<code>ST004D01T</code>).</li>
<li>Hint: to split by bars by a variable use the <code>aes(fill= &lt;variable&gt;)</code>.</li>
</ul>
</div>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Create a data set related to books in Germany and include gender</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>Bookplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">select</span>(CNT, PA195Q01JA, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Germany"</span>)</span>
<span id="cb36-5"><a href="#cb36-5"></a></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="co"># use book data to create a graph</span></span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Bookplot,</span>
<span id="cb36-8"><a href="#cb36-8"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PA195Q01JA, <span class="at">fill=</span>PA195Q01JA)) <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge2"</span>) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span> </span>
<span id="cb36-11"><a href="#cb36-11"></a>  <span class="co"># To rotate the x-axis text</span></span>
<span id="cb36-12"><a href="#cb36-12"></a>  <span class="fu">xlab</span>(<span class="st">"Number of books in the home"</span>)<span class="sc">+</span></span>
<span id="cb36-13"><a href="#cb36-13"></a>  <span class="fu">ylab</span>(<span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb36-14"><a href="#cb36-14"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of books in the home for German students by gender"</span>)</span>
<span id="cb36-15"><a href="#cb36-15"></a></span>
<span id="cb36-16"><a href="#cb36-16"></a><span class="co"># use fill by gender to split the data</span></span>
<span id="cb36-17"><a href="#cb36-17"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Bookplot,</span>
<span id="cb36-18"><a href="#cb36-18"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PA195Q01JA, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb36-19"><a href="#cb36-19"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge2"</span>) <span class="sc">+</span></span>
<span id="cb36-20"><a href="#cb36-20"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span> </span>
<span id="cb36-21"><a href="#cb36-21"></a>  <span class="co"># To rotate the x-axis text</span></span>
<span id="cb36-22"><a href="#cb36-22"></a>  <span class="fu">xlab</span>(<span class="st">"Number of books in the home"</span>)<span class="sc">+</span></span>
<span id="cb36-23"><a href="#cb36-23"></a>  <span class="fu">ylab</span>(<span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb36-24"><a href="#cb36-24"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of books in the home for German students by gender"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="question">
<ul>
<li>Plot a bar graph of the mean science scores of all the countries in the PISA data frame</li>
<li>Hint one: you will need to create a summary dataframe using <code>group_by</code> and <code>summarise</code> and then <code>geom_bar(stat="identity")</code>. Remember to use <code>stat=identity</code> when you want <code>geom_bar</code> to plot the values in the <code>data.frame</code> (because you have already summarised) rather than counting the values.</li>
<li>Hint two: you can reorder the x-axis with the <code>reorder</code> function. Rather than a simple <code>x=CNT</code> you can put <code>x=reorder(CNT, -SciMean)</code> which will reorder the x axis in descending order (because of the <code>-</code> sign) of <code>SciMean</code>.</li>
</ul>
</div>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># Create a data set of science scores, and use group_by and summarise to create mean scores by country</span></span>
<span id="cb37-2"><a href="#cb37-2"></a></span>
<span id="cb37-3"><a href="#cb37-3"></a>Sciplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>  <span class="fu">select</span>(CNT, PV1SCIE) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5"></a>  <span class="fu">group_by</span>(CNT)<span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>  <span class="fu">summarise</span>(<span class="at">MeanSci =</span> <span class="fu">mean</span>(PV1SCIE))</span>
<span id="cb37-7"><a href="#cb37-7"></a></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="co"># Use geom_bar to plot the data</span></span>
<span id="cb37-9"><a href="#cb37-9"></a></span>
<span id="cb37-10"><a href="#cb37-10"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Sciplot,</span>
<span id="cb37-11"><a href="#cb37-11"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(CNT, <span class="sc">-</span>MeanSci), <span class="at">y =</span> MeanSci, <span class="at">fill =</span> MeanSci)) <span class="sc">+</span></span>
<span id="cb37-12"><a href="#cb37-12"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb37-13"><a href="#cb37-13"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="task-2---scatter-graphs" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="task-2---scatter-graphs"><span class="header-section-number">5.2</span> Task 2 - Scatter graphs</h2>
<div class="question">
<ul>
<li>For students in the UK and Brazil, plot science scores (<code>PV1SCIE</code>) by the index of economic, social and cultural status (<code>ESCS</code>). (You may have come across this variable in your studies as socio-economic status, similar to the idea of ‘social class’.) Then try varying the colour of points by country, and add a line for each.</li>
</ul>
</div>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>plotdata<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="fu">select</span>(CNT, PV1SCIE, ESCS)<span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Brazil"</span>)</span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="co"># Plot the data as a scatter graph with geom_point()</span></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plotdata,</span>
<span id="cb38-6"><a href="#cb38-6"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ESCS,<span class="at">y =</span> PV1SCIE, <span class="at">colour =</span> CNT)) <span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Index of economic, social and cultural status"</span>,</span>
<span id="cb38-9"><a href="#cb38-9"></a>       <span class="at">y =</span> <span class="st">"Science Score"</span>)<span class="sc">+</span></span>
<span id="cb38-10"><a href="#cb38-10"></a>  (<span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'lm'</span>))<span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)<span class="sc">+</span></span>
<span id="cb38-12"><a href="#cb38-12"></a>  <span class="fu">labs</span>(<span class="at">CNT =</span> <span class="st">"Country"</span>) <span class="co"># Changes ST004D01T to gender for the plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="question">
<ul>
<li>For students in the UK, plot a graph of science scores (<code>PV1SCIE</code>) against reading scores (<code>PV1READ</code>). Add a straight line and vary the colour of points by students’ gender.</li>
</ul>
</div>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>plotdata<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>  <span class="fu">select</span>(CNT, PV1SCIE, PV1READ, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="co"># Plot the data as a scatter graph with geom_point()</span></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plotdata,</span>
<span id="cb39-6"><a href="#cb39-6"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1READ, <span class="at">y =</span> PV1SCIE, <span class="at">colour =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb39-7"><a href="#cb39-7"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Reading Score"</span>, <span class="at">y =</span> <span class="st">"Science Score"</span>) <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)<span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Gender"</span>) <span class="co"># Changes ST004D01T to gender for the plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="question">
<ul>
<li>Challenging task (!): Plot a graph of mean mathematics score (<code>PV1MATH</code>) by economic, social and cultural status (<code>ESCS</code>) and highlight countries with mathematics scores above 800. An outline of how to achieve this:</li>
</ul>
<ol type="a">
<li>Create a data frame of mean <code>PV1MATH</code> and <code>ESCS</code> by country using <code>group_by</code> and <code>summarise</code>. (Don’t forget to use na.RM=TRUE)</li>
<li>Use <code>mutate</code> and <code>ifelse</code> to add a new variable, called <code>text</code> which contains the names of countires with mathematics scores over 550.</li>
<li>Use <code>geom_label</code> to add these data points to the x and y coordinates of the countries e.g.&nbsp;<code>geom_text_repel(PV1MATHmean, ESCSmean, label)</code>.</li>
</ol>
</div>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># Create a data frame of ESCS scores and mathematics scores</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>plotdata<span class="ot">&lt;-</span>PISA_2022<span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="fu">select</span>(CNT, ESCS, PV1MATH)<span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4"></a>  <span class="fu">group_by</span>(CNT)<span class="sc">%&gt;%</span> <span class="co"># group_by country</span></span>
<span id="cb40-5"><a href="#cb40-5"></a>  <span class="fu">summarise</span>(<span class="at">PV1MATHmean =</span> <span class="fu">mean</span>(PV1MATH), <span class="co">#calculate means</span></span>
<span id="cb40-6"><a href="#cb40-6"></a>            <span class="at">ESCSmean =</span> <span class="fu">mean</span>(ESCS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href="#cb40-7"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">ifelse</span>(PV1MATHmean <span class="sc">&gt;</span> <span class="dv">550</span>, <span class="fu">as.character</span>(CNT), <span class="st">""</span>)) </span>
<span id="cb40-8"><a href="#cb40-8"></a></span>
<span id="cb40-9"><a href="#cb40-9"></a><span class="co"># Use mutate to create a newc columns called text</span></span>
<span id="cb40-10"><a href="#cb40-10"></a><span class="co"># If PV1MATHmean is over 800 set text to equal CNT, otherwise set it to blank ("")</span></span>
<span id="cb40-11"><a href="#cb40-11"></a></span>
<span id="cb40-12"><a href="#cb40-12"></a><span class="co"># Plot the data, putting mean math score on y and ESCS mean on the x</span></span>
<span id="cb40-13"><a href="#cb40-13"></a><span class="co"># Set the colour of points by the mean math score</span></span>
<span id="cb40-14"><a href="#cb40-14"></a></span>
<span id="cb40-15"><a href="#cb40-15"></a><span class="fu">ggplot</span>(plotdata, <span class="fu">aes</span>(<span class="at">y=</span>PV1MATHmean, <span class="at">x =</span> ESCSmean, <span class="at">colour =</span> PV1MATHmean))<span class="sc">+</span></span>
<span id="cb40-16"><a href="#cb40-16"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb40-17"><a href="#cb40-17"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">y =</span> PV1MATHmean, <span class="at">x=</span>ESCSmean, <span class="at">label =</span> text))<span class="sc">+</span></span>
<span id="cb40-18"><a href="#cb40-18"></a>  <span class="fu">xlab</span>(<span class="st">"Mean ESCS score"</span>)<span class="sc">+</span></span>
<span id="cb40-19"><a href="#cb40-19"></a>  <span class="fu">ylab</span>(<span class="st">"Mean mathematics score"</span>)<span class="sc">+</span></span>
<span id="cb40-20"><a href="#cb40-20"></a>  <span class="fu">ggtitle</span>(<span class="st">"Comparison of mean mathematics and mean ESCS score"</span>)<span class="sc">+</span> </span>
<span id="cb40-21"><a href="#cb40-21"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="co"># Hide the legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="task-3---plot-distributions-of-wealth-scores" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="task-3---plot-distributions-of-wealth-scores"><span class="header-section-number">5.3</span> Task 3 - Plot distributions of wealth scores</h2>
<div class="question">
<p>Use a scatter plot to show the correlation between <code>HOMEPOS</code> and <code>ESCS</code>. Use a <code>facet_wrap</code> to show the charts for the UK, Japan, Colombia and Sweden. Discuss the different relationships between the two variables across the countries.</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the PISA variable, Economic, Social and Cultural Status <code>ESCS</code> is based on highest parental occupation (‘HISEI’), highest parental education (‘PARED’), and home possessions (‘HOMEPOS’), including books in the home. Do consider the implications of this definition.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Create a data frame with the ESCS, gender (ST004D01T) and HOMEPOS variables for the 4 countries </span></span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a>WealthcompPISA<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, ST004D01T)<span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Japan"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Colombia"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Sweden"</span>)</span>
<span id="cb41-6"><a href="#cb41-6"></a></span>
<span id="cb41-7"><a href="#cb41-7"></a><span class="co"># Use ggplot to create a scatter graph</span></span>
<span id="cb41-8"><a href="#cb41-8"></a><span class="co"># Set the x variable to ESCS and the y to HOMEPOS, set the colour to gender</span></span>
<span id="cb41-9"><a href="#cb41-9"></a><span class="co"># Set point size and transparency</span></span>
<span id="cb41-10"><a href="#cb41-10"></a><span class="co"># Facet wrap to produce graphs for each country</span></span>
<span id="cb41-11"><a href="#cb41-11"></a></span>
<span id="cb41-12"><a href="#cb41-12"></a><span class="fu">ggplot</span>(WealthcompPISA, <span class="fu">aes</span>(<span class="at">x =</span> ESCS, <span class="at">y =</span> HOMEPOS, <span class="at">colour=</span>ST004D01T))<span class="sc">+</span></span>
<span id="cb41-13"><a href="#cb41-13"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb41-14"><a href="#cb41-14"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-4---plot-distributions-of-scores" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="task-4---plot-distributions-of-scores"><span class="header-section-number">5.4</span> Task 4 - Plot distributions of scores</h2>
<div class="question">
<ul>
<li>Use geom_density to plot distributions to plot the distribution of Japanese and UK mathematics scores - what patterns do you notice?</li>
</ul>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To plot a distribution, you can use <code>geom_density</code> to plot a distribution curve. In <code>ggplot</code> you specify the data, and then in <code>aes</code> set the x-value (the variable of interest, and set the fill to change by different groups). Within the <code>geom_density</code> call you can specify the <code>alpha</code>, the opacity of the plot.</p>
<p>For example, to plot science scores in the UK by gender, you would use the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># Create a data frame of UK science scores including gender</span></span>
<span id="cb42-2"><a href="#cb42-2"></a></span>
<span id="cb42-3"><a href="#cb42-3"></a>UKSci<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4"></a>  <span class="fu">select</span>(CNT, PV1SCIE, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb42-6"><a href="#cb42-6"></a></span>
<span id="cb42-7"><a href="#cb42-7"></a><span class="co"># Plot the density chart, changing colour by gender, and setting the alpha (opacity) to 0.5</span></span>
<span id="cb42-8"><a href="#cb42-8"></a><span class="fu">ggplot</span>(<span class="at">data =</span> UKSci,</span>
<span id="cb42-9"><a href="#cb42-9"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1SCIE, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># Create a data frame of UK and Japanese mathematics scores</span></span>
<span id="cb43-2"><a href="#cb43-2"></a></span>
<span id="cb43-3"><a href="#cb43-3"></a>JPUKMath<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4"></a>  <span class="fu">select</span>(CNT, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Japan"</span>)</span>
<span id="cb43-6"><a href="#cb43-6"></a></span>
<span id="cb43-7"><a href="#cb43-7"></a><span class="co"># Plot the density chart, changing colour by country, and setting the alpha (opacity) to 0.5</span></span>
<span id="cb43-8"><a href="#cb43-8"></a><span class="fu">ggplot</span>(<span class="at">data =</span> JPUKMath,</span>
<span id="cb43-9"><a href="#cb43-9"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">fill =</span> CNT)) <span class="sc">+</span></span>
<span id="cb43-10"><a href="#cb43-10"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-5---plot-distributions-of-scores-by-gender" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="task-5---plot-distributions-of-scores-by-gender"><span class="header-section-number">5.5</span> Task 5 - Plot distributions of scores by gender</h2>
<div class="question">
<ul>
<li>Examine gender differences: Plot the distributions of mathematics achievement in the UK by gender. What patterns can you see?</li>
</ul>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>UKMathGender <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>  <span class="fu">select</span>(CNT, PV1MATH, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb44-4"><a href="#cb44-4"></a></span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="fu">ggplot</span>(<span class="at">data =</span> UKMathGender,</span>
<span id="cb44-6"><a href="#cb44-6"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb44-7"><a href="#cb44-7"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-6---facet-wrap-by-country" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="task-6---facet-wrap-by-country"><span class="header-section-number">5.6</span> Task 6 - Facet wrap by country</h2>
<div class="question">
<p>Plot density graphs of gender differences in mathematics scores in the UK, Spain, Japan, Korea and Finland. Hint use <code>facet_wrap(.~CNT)</code></p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Create a data frame of mathematics scores, gender and country</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="co"># Filter by the five countries of interest</span></span>
<span id="cb45-3"><a href="#cb45-3"></a></span>
<span id="cb45-4"><a href="#cb45-4"></a>MathGender <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="#cb45-5"></a>  <span class="fu">select</span>(CNT, PV1MATH, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Spain"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Japan"</span></span>
<span id="cb45-7"><a href="#cb45-7"></a>         <span class="sc">|</span> CNT<span class="sc">==</span><span class="st">"Korea"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Finland"</span>)</span>
<span id="cb45-8"><a href="#cb45-8"></a></span>
<span id="cb45-9"><a href="#cb45-9"></a><span class="co"># Plot a density graph of mathematics scores, splitting into groups, with coloured fills by gender. Set transparency to 0.5 to show overlap </span></span>
<span id="cb45-10"><a href="#cb45-10"></a></span>
<span id="cb45-11"><a href="#cb45-11"></a><span class="fu">ggplot</span>(<span class="at">data =</span> MathGender,</span>
<span id="cb45-12"><a href="#cb45-12"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb45-14"><a href="#cb45-14"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-7---plot-a-scatter-graph" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="task-7---plot-a-scatter-graph"><span class="header-section-number">5.7</span> Task 7 - Plot a scatter graph</h2>
<div class="question">
<p>Plot a scatter graph of mean mathematics achievement (y-axis) by mean wealth (x-axis) with each country as a single point. Hint: You will first need to use <code>group_by</code> and then <code>summarise</code> to create a data frame of mean scores.</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the competency tests for Vietnam in PISA are all <code>NA</code> at the student level. This is because many students finish compulsory schooling before 15. Hence, we add an <code>na.omit</code> to remove the data from Vietnam</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># Create a summary data frame</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="co"># Group by country, and then summarise the mean meath and wealth scores</span></span>
<span id="cb46-3"><a href="#cb46-3"></a></span>
<span id="cb46-4"><a href="#cb46-4"></a>Wealthdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5"></a>  <span class="fu">select</span>(CNT, HOMEPOS, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>  <span class="fu">filter</span>(CNT<span class="sc">!=</span><span class="st">"Vietnam"</span>)<span class="sc">%&gt;%</span>  <span class="co"># To cut Vietnam due to lack of data</span></span>
<span id="cb46-7"><a href="#cb46-7"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb46-8"><a href="#cb46-8"></a>  <span class="fu">summarise</span>(<span class="at">MeanWealth=</span><span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-9"><a href="#cb46-9"></a>            <span class="at">MeanMath=</span><span class="fu">mean</span>(PV1MATH, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb46-10"><a href="#cb46-10"></a></span>
<span id="cb46-11"><a href="#cb46-11"></a><span class="co"># Use ggplot to create a scatter graph</span></span>
<span id="cb46-12"><a href="#cb46-12"></a></span>
<span id="cb46-13"><a href="#cb46-13"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Wealthdata,</span>
<span id="cb46-14"><a href="#cb46-14"></a>       <span class="fu">aes</span>(<span class="at">x =</span> MeanWealth, <span class="at">y =</span> MeanMath)) <span class="sc">+</span></span>
<span id="cb46-15"><a href="#cb46-15"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">colour=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb46-16"><a href="#cb46-16"></a>  <span class="fu">xlab</span>(<span class="st">"Home Possessions (Wealth proxy)"</span>) <span class="sc">+</span></span>
<span id="cb46-17"><a href="#cb46-17"></a>  <span class="fu">ylab</span>(<span class="st">"Mathematics score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="question">
<p>In the previous scatter of mathematics vs wealth scores, highlight outlier countries (any score of over 500) in a different colour. Hint, mutate the data frame to include a label column (by the condition of the maths score being over 550). Then set the colour in ggplot by theis label column.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># Create a summary data frame</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="co"># Group by country, and then summarise the mean math and wealth scores</span></span>
<span id="cb47-3"><a href="#cb47-3"></a></span>
<span id="cb47-4"><a href="#cb47-4"></a>Wealthdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5"></a>  <span class="fu">select</span>(CNT, HOMEPOS, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb47-7"><a href="#cb47-7"></a>  <span class="fu">filter</span>(CNT<span class="sc">!=</span><span class="st">"Vietnam"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="#cb47-8"></a>  <span class="fu">summarise</span>(<span class="at">MeanWealth =</span> <span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-9"><a href="#cb47-9"></a>            <span class="at">MeanMath =</span> <span class="fu">mean</span>(PV1MATH, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-10"><a href="#cb47-10"></a>  <span class="fu">mutate</span>(<span class="at">label=</span><span class="fu">ifelse</span>(MeanMath <span class="sc">&gt;</span> <span class="dv">500</span>, <span class="st">"Red"</span>, <span class="st">"Blue"</span>)) <span class="co"># mutate to add a label</span></span>
<span id="cb47-11"><a href="#cb47-11"></a><span class="co"># the column label is "Red" if MeanMath &gt; 500 and "Blue" otherwise</span></span>
<span id="cb47-12"><a href="#cb47-12"></a></span>
<span id="cb47-13"><a href="#cb47-13"></a><span class="co"># Use ggplot to create a scatter graph</span></span>
<span id="cb47-14"><a href="#cb47-14"></a></span>
<span id="cb47-15"><a href="#cb47-15"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Wealthdata,</span>
<span id="cb47-16"><a href="#cb47-16"></a>       <span class="fu">aes</span>(<span class="at">x =</span> MeanWealth, <span class="at">y =</span> MeanMath, <span class="at">colour =</span> label)) <span class="sc">+</span></span>
<span id="cb47-17"><a href="#cb47-17"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb47-18"><a href="#cb47-18"></a>  <span class="fu">xlab</span>(<span class="st">"Wealth"</span>) <span class="sc">+</span></span>
<span id="cb47-19"><a href="#cb47-19"></a>  <span class="fu">ylab</span>(<span class="st">"Mathematics score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="question">
<p>Add the country names as a label to the outliers. Hint: add an additional column <code>labelname</code> to which the country name <code>as.charachter(CNT)</code> is added if the <code>MeanMath</code> score is over 500. Hint: you can use <code>geom_label_repel</code> to add the labels. You can set: <code>(aes(label = labelname), colour = "black", check_overlap = TRUE)</code> to give the source of the lables (<code>labelname</code>) the colour and to force the lables not to overlap.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># Mutate to give a new column labelname, set to the country name (CNT) if Meanmath is over 500, or NA if not.</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>Wealthdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>  <span class="fu">select</span>(CNT, HOMEPOS, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5"></a>  <span class="fu">filter</span>(CNT<span class="sc">!=</span><span class="st">"Vietnam"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb48-6"><a href="#cb48-6"></a>  <span class="fu">summarise</span>(<span class="at">MeanWealth =</span> <span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-7"><a href="#cb48-7"></a>            <span class="at">MeanMath =</span> <span class="fu">mean</span>(PV1MATH, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="#cb48-8"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(MeanMath<span class="sc">&gt;</span><span class="dv">500</span>, <span class="st">"Red"</span>, <span class="st">"Blue"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-9"><a href="#cb48-9"></a>  <span class="fu">mutate</span>(<span class="at">labelname =</span> <span class="fu">ifelse</span>(MeanMath<span class="sc">&gt;</span><span class="dv">500</span>, <span class="fu">as.character</span>(CNT), <span class="cn">NA</span>))</span>
<span id="cb48-10"><a href="#cb48-10"></a>  </span>
<span id="cb48-11"><a href="#cb48-11"></a><span class="co"># Use geom_label_repel to add the labelname column to the graph</span></span>
<span id="cb48-12"><a href="#cb48-12"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Wealthdata,</span>
<span id="cb48-13"><a href="#cb48-13"></a>       <span class="fu">aes</span>(<span class="at">x =</span> MeanWealth, <span class="at">y =</span> MeanMath, <span class="at">colour =</span> label)) <span class="sc">+</span></span>
<span id="cb48-14"><a href="#cb48-14"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb48-15"><a href="#cb48-15"></a>  <span class="fu">geom_label_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> labelname), </span>
<span id="cb48-16"><a href="#cb48-16"></a>            <span class="at">colour =</span> <span class="st">"black"</span>, </span>
<span id="cb48-17"><a href="#cb48-17"></a>            <span class="at">check_overlap =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb48-18"><a href="#cb48-18"></a>  <span class="fu">xlab</span>(<span class="st">"Wealth"</span>) <span class="sc">+</span></span>
<span id="cb48-19"><a href="#cb48-19"></a>  <span class="fu">ylab</span>(<span class="st">"Mathematics score"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-8---plot-likert-responses-using-facet-wrapping" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="task-8---plot-likert-responses-using-facet-wrapping"><span class="header-section-number">5.8</span> Task 8 - Plot Likert responses using facet wrapping</h2>
<div class="question">
<p>Examine Likert responses by country using facet plot.</p>
<p>For <code>ST125Q01NA</code> - How old were you when you started early childhood education? Plot responses, first, for the whole data set, then facet plot for the UK, Germany, Belgium, Austria, France, Poland, Estonia, Finland and Italy.</p>
<p>• What international differences can you note?</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># Create a data frame of childhood education data for the whole data frame </span></span>
<span id="cb49-2"><a href="#cb49-2"></a>ChildhoodEd<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3"></a>  <span class="fu">select</span>(CNT, ST125Q01NA) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4"></a>  <span class="fu">group_by</span>(CNT)</span>
<span id="cb49-5"><a href="#cb49-5"></a></span>
<span id="cb49-6"><a href="#cb49-6"></a><span class="co"># Plot a bar graph of responses  </span></span>
<span id="cb49-7"><a href="#cb49-7"></a></span>
<span id="cb49-8"><a href="#cb49-8"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ChildhoodEd,</span>
<span id="cb49-9"><a href="#cb49-9"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ST125Q01NA, <span class="at">fill =</span> ST125Q01NA)) <span class="sc">+</span></span>
<span id="cb49-10"><a href="#cb49-10"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb49-11"><a href="#cb49-11"></a>  <span class="fu">xlab</span>(<span class="st">"How old were you when you started early childhood education?"</span>) <span class="sc">+</span></span>
<span id="cb49-12"><a href="#cb49-12"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Then use faceting to split the plots by country</p>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># Repeat filtering for UK, Germany, Belgium, Austria, France, Poland, Estonia, Finland and Italy</span></span>
<span id="cb50-2"><a href="#cb50-2"></a></span>
<span id="cb50-3"><a href="#cb50-3"></a>ChildhoodEd <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4"></a>  <span class="fu">select</span>(CNT, ST125Q01NA) <span class="sc">%&gt;%</span></span>
<span id="cb50-5"><a href="#cb50-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Germany"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Belgium"</span></span>
<span id="cb50-6"><a href="#cb50-6"></a>         <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Austria"</span><span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"France"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Poland"</span></span>
<span id="cb50-7"><a href="#cb50-7"></a>         <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Estonia"</span> <span class="sc">|</span> CNT<span class="sc">==</span><span class="st">"Finland"</span><span class="sc">|</span> CNT<span class="sc">==</span><span class="st">"Italy"</span>)</span>
<span id="cb50-8"><a href="#cb50-8"></a></span>
<span id="cb50-9"><a href="#cb50-9"></a><span class="co"># Plot the data and facet wrap by country</span></span>
<span id="cb50-10"><a href="#cb50-10"></a></span>
<span id="cb50-11"><a href="#cb50-11"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ChildhoodEd,</span>
<span id="cb50-12"><a href="#cb50-12"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ST125Q01NA, <span class="at">fill =</span> CNT))<span class="sc">+</span></span>
<span id="cb50-13"><a href="#cb50-13"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb50-14"><a href="#cb50-14"></a>  <span class="fu">xlab</span>(<span class="st">"How old were you when you started early childhood education?"</span>) <span class="sc">+</span></span>
<span id="cb50-15"><a href="#cb50-15"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb50-16"><a href="#cb50-16"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-9---compare-the-association-between-mathematics-and-science-pv-values-across-three-diverse-countries" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="task-9---compare-the-association-between-mathematics-and-science-pv-values-across-three-diverse-countries"><span class="header-section-number">5.9</span> Task 9 - Compare the association between mathematics and science PV values across three diverse countries</h2>
<div class="question">
<p>Plot scatter plots of science versus mathematics achievement in United Kingdom, Qatar and Brazil • What differences can you see between the countries?</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># Create a data frame of science and mathematics scores, across the countries Including gender)</span></span>
<span id="cb51-2"><a href="#cb51-2"></a></span>
<span id="cb51-3"><a href="#cb51-3"></a>SciMaths <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4"></a>  <span class="fu">select</span>(CNT, PV1MATH, PV1SCIE, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Colombia"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"New Zealand"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Qatar"</span><span class="sc">|</span></span>
<span id="cb51-6"><a href="#cb51-6"></a>           CNT <span class="sc">==</span> <span class="st">"Israel"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="#cb51-7"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb51-8"><a href="#cb51-8"></a></span>
<span id="cb51-9"><a href="#cb51-9"></a><span class="co"># Scatter plot the data, faceting by country</span></span>
<span id="cb51-10"><a href="#cb51-10"></a></span>
<span id="cb51-11"><a href="#cb51-11"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SciMaths, </span>
<span id="cb51-12"><a href="#cb51-12"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">y =</span> PV1SCIE, <span class="at">colour =</span> ST004D01T))<span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/loading_data-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># Low achieving (filter for scores less than 400)</span></span>
<span id="cb52-2"><a href="#cb52-2"></a></span>
<span id="cb52-3"><a href="#cb52-3"></a>SciMaths <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb52-4"><a href="#cb52-4"></a>  <span class="fu">select</span>(CNT, PV1MATH, PV1SCIE, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="#cb52-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Colombia"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"New Zealand"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Qatar"</span><span class="sc">|</span></span>
<span id="cb52-6"><a href="#cb52-6"></a>           CNT <span class="sc">==</span> <span class="st">"Israel"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-7"><a href="#cb52-7"></a>  <span class="fu">filter</span>(PV1MATH <span class="sc">&lt;</span> <span class="dv">400</span>)<span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="#cb52-8"></a>  <span class="fu">filter</span>(PV1SCIE <span class="sc">&lt;</span> <span class="dv">400</span>)<span class="sc">%&gt;%</span></span>
<span id="cb52-9"><a href="#cb52-9"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb52-10"><a href="#cb52-10"></a></span>
<span id="cb52-11"><a href="#cb52-11"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SciMaths, </span>
<span id="cb52-12"><a href="#cb52-12"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">y =</span> PV1SCIE, <span class="at">colour =</span> ST004D01T))<span class="sc">+</span></span>
<span id="cb52-13"><a href="#cb52-13"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb52-14"><a href="#cb52-14"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/loading_data-2.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="extension-tasks" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Extension tasks</h1>
<section id="task-1---binning-data" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="task-1---binning-data"><span class="header-section-number">6.1</span> Task 1 - Binning data</h2>
<p>Frequency plots are often used to show data following a normal distribution, To produce a frequency plot, we need to divide data into counts, each covering a range of data. This is called ‘binning’. There is a choice to be made here, in how large or small to make the divisions (‘bins’) - this can affect how the data looks when graphed.</p>
<p>For example, to produce a frequency plot of science scores in the UK, we can first run a <code>summary</code> command on <code>PV1SCIE</code> to find the minimum and maximum score:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># Find the range of science score</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="fu">summary</span>(PISA_2022<span class="sc">$</span>PV1SCIE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   371.7   444.5   450.5   524.7   895.4 </code></pre>
</div>
</div>
<p>If we wanted to plot a frequency chart of heights, we might divide the range of scores (from 0-895.4) into bins of 20 points. To do this we can use the <code>cut(&lt;field&gt;,&lt;breaks&gt;)</code> function within the <code>mutate</code> command on a ‘data.frame’. The <code>&lt;field&gt;</code> specifies the range (i.e.&nbsp;from around 0-900) and <code>&lt;breaks&gt;</code> the size of bins.</p>
<p>In the example below, we use <code>cut(PV1SCIE, breaks=seq(0,900,20))</code> to create a new vector (column in the table) with the science scores divided up into bins. The specification <code>breaks=seq(0,900,20))</code> sets how the data are divided up - into bins (i.e.&nbsp;groups of respondents) of scores starting at 0 and rising to 900 in steps of 20.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Creates distribution of science scores</span></span>
<span id="cb55-2"><a href="#cb55-2"></a></span>
<span id="cb55-3"><a href="#cb55-3"></a>binnedsize <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="co"># Creates a new data frame with binned data</span></span>
<span id="cb55-4"><a href="#cb55-4"></a>  <span class="fu">select</span>(PV1SCIE, CNT)<span class="sc">%&gt;%</span> <span class="co"># Select the columns needed</span></span>
<span id="cb55-5"><a href="#cb55-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb55-6"><a href="#cb55-6"></a>  <span class="fu">mutate</span>(<span class="at">BinnedPV1SCIE =</span> <span class="fu">cut</span>(PV1SCIE, <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">900</span>, <span class="dv">20</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb55-7"><a href="#cb55-7"></a>  <span class="fu">na.omit</span>() <span class="co"># Drop any NAs</span></span>
<span id="cb55-8"><a href="#cb55-8"></a></span>
<span id="cb55-9"><a href="#cb55-9"></a><span class="co"># Plot the data as a bar graph</span></span>
<span id="cb55-10"><a href="#cb55-10"></a><span class="fu">ggplot</span>(binnedsize,</span>
<span id="cb55-11"><a href="#cb55-11"></a>       <span class="fu">aes</span>(<span class="at">x =</span> BinnedPV1SCIE)) <span class="sc">+</span></span>
<span id="cb55-12"><a href="#cb55-12"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"dark green"</span>) <span class="sc">+</span></span>
<span id="cb55-13"><a href="#cb55-13"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb55-14"><a href="#cb55-14"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Number of responses"</span>, <span class="at">x =</span> <span class="st">"Scores range"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="question">
<p>Create a graph of the binned counts of mathematics scores in Malta. Don’t forget to run a summary command first to get a sense of the range in values.</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To find out the range of a vector, you can use the <code>range</code> function in the console - for example, to get a sense of the range of science scores for the whole data frame, we can type: <code>range(PISA_2022$PV1SCIE, na.rm=TRUE)</code>. Notice that, because there are <code>NA</code>s in the data, we need to tell the function to ignore them, using <code>na.rm=TRUE</code>.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># Creates distribution of schools by size</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>binnedsize <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="co"># Creates a new data frame with binned data</span></span>
<span id="cb56-3"><a href="#cb56-3"></a>  <span class="fu">select</span>(PV1MATH, CNT)<span class="sc">%&gt;%</span> <span class="co"># Select the column I need</span></span>
<span id="cb56-4"><a href="#cb56-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Malta"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="#cb56-5"></a>  <span class="fu">mutate</span>(<span class="at">BinnedPV1MATH =</span> <span class="fu">cut</span>(PV1MATH, <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">20</span>,<span class="dv">900</span>,<span class="dv">20</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="#cb56-6"></a>  <span class="fu">na.omit</span>() <span class="co"># Drop any NAs</span></span>
<span id="cb56-7"><a href="#cb56-7"></a><span class="co"># Plot the data as a bar graph</span></span>
<span id="cb56-8"><a href="#cb56-8"></a><span class="fu">ggplot</span>(binnedsize,</span>
<span id="cb56-9"><a href="#cb56-9"></a>       <span class="fu">aes</span>(<span class="at">x =</span> BinnedPV1MATH)) <span class="sc">+</span></span>
<span id="cb56-10"><a href="#cb56-10"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb56-11"><a href="#cb56-11"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb56-12"><a href="#cb56-12"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Number of schools"</span>, <span class="at">x =</span> <span class="st">"Pupil range"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To find out a range of a vector, you can use the <code>range</code> function in the console - for example, to get a sense of the range of numbers of students on SEN support. I can type: <code>range(DfE_SEN_data$SEN.support)</code></p>
</div>
</div>
<div class="question">
<p>Plot a binned <code>geom_bar</code> graph of the <code>HOMEPOS</code> scores in the UK and Belarus on the same axes.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># Creates distribution of schools by size</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>binnedwealth <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="co"># Creates a new data frame with binned data</span></span>
<span id="cb57-3"><a href="#cb57-3"></a>  <span class="fu">select</span>(HOMEPOS, CNT)<span class="sc">%&gt;%</span> <span class="co"># Select the column I need</span></span>
<span id="cb57-4"><a href="#cb57-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Belarus"</span><span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5"></a>  <span class="fu">mutate</span>(<span class="at">BinnedHOMEPOS =</span> <span class="fu">cut</span>(HOMEPOS, <span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">5</span>, <span class="fl">0.25</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6"></a>  <span class="fu">na.omit</span>() <span class="co"># Drop any NAs</span></span>
<span id="cb57-7"><a href="#cb57-7"></a><span class="co"># Plot the data as a bar graph</span></span>
<span id="cb57-8"><a href="#cb57-8"></a><span class="fu">ggplot</span>(binnedwealth,</span>
<span id="cb57-9"><a href="#cb57-9"></a>       <span class="fu">aes</span>(<span class="at">x =</span> BinnedHOMEPOS, <span class="at">fill =</span> CNT)) <span class="sc">+</span></span>
<span id="cb57-10"><a href="#cb57-10"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb57-11"><a href="#cb57-11"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb57-12"><a href="#cb57-12"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Frequency"</span>, <span class="at">x =</span> <span class="st">"Wealth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="task-2---histograms" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="task-2---histograms"><span class="header-section-number">6.2</span> Task 2 - Histograms</h2>
<p>An alternative to binning the data yourself is to use the <code>geom_histogram</code> <code>geom</code> in <code>ggplot</code>. That allows you to plot a histogram and control the size of the bins, without having to bin the data yourself. For example, to create a histogram of wealth scores in the UK, you set the <code>x</code> value in <code>aes</code>to wealth (<code>HOMEPOS</code>) and specify the <code>binwidth</code> within <code>geom_histogram</code>. You can also set a <code>fill</code> colour within the <code>geom_histogram</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># Creates data frame of wealth scores in the UK</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>UK_wealth <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="#cb58-3"></a>  <span class="fu">select</span>(HOMEPOS, CNT) <span class="sc">%&gt;%</span> <span class="co"># Select the columns needed</span></span>
<span id="cb58-4"><a href="#cb58-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>) <span class="co"># filter for the UK</span></span>
<span id="cb58-5"><a href="#cb58-5"></a></span>
<span id="cb58-6"><a href="#cb58-6"></a><span class="co"># Plot the data as a histogram </span></span>
<span id="cb58-7"><a href="#cb58-7"></a><span class="fu">ggplot</span>(UK_wealth,</span>
<span id="cb58-8"><a href="#cb58-8"></a>       <span class="fu">aes</span>(<span class="at">x =</span> HOMEPOS)) <span class="sc">+</span></span>
<span id="cb58-9"><a href="#cb58-9"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">"dark green"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="question">
<p>Plot a histogram of the <code>PV1SCIE</code> science scores for boys and girls in the UK and in Japan. Hint: You will need to use <code>position = position_dodge2()</code> inside the <code>geom_histrogram</code> to make sure the plots ovelap rather than stack.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># Creates data frame of science scores in the UK and Japan</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>Sci_scores <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3"></a>  <span class="fu">select</span>(PV1SCIE, CNT, ST004D01T) <span class="sc">%&gt;%</span> <span class="co"># Select the columns needed</span></span>
<span id="cb59-4"><a href="#cb59-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Japan"</span>)  <span class="co"># filter for the UK and Japan</span></span>
<span id="cb59-5"><a href="#cb59-5"></a></span>
<span id="cb59-6"><a href="#cb59-6"></a><span class="co"># Plot the data as a histogram </span></span>
<span id="cb59-7"><a href="#cb59-7"></a><span class="fu">ggplot</span>(Sci_scores,</span>
<span id="cb59-8"><a href="#cb59-8"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1SCIE, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="fu">position_dodge2</span>()) <span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="task-3---plotting-data-on-maps" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="task-3---plotting-data-on-maps"><span class="header-section-number">6.3</span> Task 3 - Plotting data on maps</h2>
<p>As well as graphs, R can also plot data onto maps. The <code>geom_map</code> function will plot a map of a region and you can either plot points (using <code>geom_point</code>) or fill regions by drawing a polygon of the shape of that region (using <code>geom_polygon</code>).</p>
<p>For example, imagine we created a data frame of the mean science scores of countries in the PISA data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># Pipe the total data frame and calculate the mean science scores</span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="co"># To match with another data frame we will use, we will rename CNT to region</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>WorldSci <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4"></a>  <span class="fu">select</span>(CNT, PV1SCIE) <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="#cb60-5"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb60-6"><a href="#cb60-6"></a>  <span class="fu">summarise</span>(<span class="at">meanSci =</span> <span class="fu">mean</span>(PV1SCIE)) <span class="sc">%&gt;%</span></span>
<span id="cb60-7"><a href="#cb60-7"></a>  <span class="fu">rename</span>(<span class="at">region =</span> CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to plot the data onto a map, colouring the countries by science scores, we need data which gives the coordinates of the edges of the countries. This data is available from the <code>map_data</code> function in <code>ggplot</code>. First we load the latitude and longitude data into a new data frame <code>world_data</code>. In the next steps we will then use <code>left_join</code> to combine it with the science data, but we need to tidy the data to match the PISA data, before we can join the two data sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># Create a data frame of country latitude and longitude data</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>world_data <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="at">map =</span> <span class="st">"world"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One quirk of the two data frames (<code>world_data</code> and the PISA data) is that some countries have different names. For example, PISA uses ‘United Kingdom’, but the <code>rworldmap</code> package uses ‘UK’. We can change the names of countries in the PISA <code>data.frame</code> to match those in <code>rworldmap</code>, using the <code>case_when</code> function with <code>mutate</code>. For example, if we want to change all <code>United Kingdom</code> entries to <code>UK</code> we use: <code>mutate(region = case_when(region == "United Kingdom" ~ "UK"</code>. The final part of the <code>case_when</code> sets the default - <code>.default = region</code> - that means if none of the matches are found, then <code>region</code> is set to <code>region</code> - i.e.&nbsp;it is left unchanged.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># The names of two countries in the PISA data frame and world_data data frame don't match (UK/United Kingdom and US/United States). Change the level names in the PISA data to match the world_data</span></span>
<span id="cb62-2"><a href="#cb62-2"></a></span>
<span id="cb62-3"><a href="#cb62-3"></a> WorldSci <span class="ot">&lt;-</span> WorldSci <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4"></a>   <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb62-5"><a href="#cb62-5"></a>                       region <span class="sc">==</span> <span class="st">"United Kingdom"</span> <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb62-6"><a href="#cb62-6"></a>                       region <span class="sc">==</span> <span class="st">"United States"</span>  <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb62-7"><a href="#cb62-7"></a>                       <span class="at">.default =</span> region))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that the country names in the two data frames match, we can use <code>left_join</code> to combine them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># Add the country latitude and longitude data to the PISA scores</span></span>
<span id="cb63-2"><a href="#cb63-2"></a></span>
<span id="cb63-3"><a href="#cb63-3"></a>WorldSci <span class="ot">&lt;-</span> <span class="fu">left_join</span>(WorldSci, world_data, <span class="at">by =</span> <span class="st">"region"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To add labels, you can create a <code>data.frame</code>, with only the country names, and their longitudes and latitudes (the mean of the country longitude and latitude), to use as the labels. You can then add <code>geom_text_repel</code>to add the labels. The <code>repel</code> means the labels won’t overlap. Given the number of countries, using <code>geom_text_repel</code> creates a warning that some labels won’t fit.</p>
<p>To plot the data, we use <code>ggplot</code>, with the data frame to <code>WorldSci</code>, and the x and y variables set to <code>long</code> and <code>lat</code>, the longitudes and latitudes. We specify that we want to keep the grouping of the data frame (i.e.&nbsp;by country).</p>
<p>First we use <code>geom_map</code> to plot a blank map using the data - this will be the base for the highlighted countries. In the <code>aes</code> we give the longitudes and latitudes, and, as we want a blank map, set the <code>fill</code> to white and the line <code>colour</code> to black.</p>
<p>Finally, we use <code>geom_polygon</code> to draw coloured shapes, with the <code>fill</code> changing by the value of <code>meanSci</code>. To make the map look nice, I have used a pre-defined colour scale.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># Use geom_map to plot the basic world map (fill is white, line colour is black)</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="co"># Use geom_polygon to plot the PISA data</span></span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="co"># Add a colour scale</span></span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="fu">ggplot</span>(<span class="at">data =</span> WorldSci, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group=</span>group)) <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5"></a>  <span class="fu">geom_map</span>(<span class="at">data =</span> world_data, </span>
<span id="cb64-6"><a href="#cb64-6"></a>           <span class="at">map =</span> world_data, </span>
<span id="cb64-7"><a href="#cb64-7"></a>           <span class="fu">aes</span>(<span class="at">map_id =</span> region), </span>
<span id="cb64-8"><a href="#cb64-8"></a>           <span class="at">fill =</span> <span class="st">"white"</span>, </span>
<span id="cb64-9"><a href="#cb64-9"></a>           <span class="at">colour =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">fill =</span> meanSci)) <span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"viridis"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>In ggplot, by default, the aesthetics are passed from one layer to the next. In our first <code>aes</code> call we set a grouping (<code>group=group</code>). However, when we come to the labeling function <code>geom_text_repel</code>, the data frame <code>Labels</code> is not grouped. We therefore need to use new aesthetics and want to ignore the original aesthetics (<code>aes(x=long, y=lat, group=group,label=region))</code>) we previously set.We do this with the command <code>inherit.aes = FALSE</code> (i.e.&nbsp;do not inherit the previous aesthetics).</p>
<p>To neaten up the labels we use the <code>ggrepel</code> package to get the <code>geom_text_repel</code> function. You’ll need to make sure that you have installed the <code>ggrepel</code> package, for a reminder on how to install packages see <strong>?@sec-installation</strong>. This ensures that text labels don’t overlap. Then in <code>geom_text_repel(data=Labels, inherit.aes = FALSE, aes(x=long, y=lat,label=region))</code> we specify the label <code>data.frame</code>, and in <code>aes</code> pass the positions of the labels (<code>x=long, y=lat</code>) and specify that the labels are in the <code>region</code> vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb65-2"><a href="#cb65-2"></a></span>
<span id="cb65-3"><a href="#cb65-3"></a><span class="fu">ggplot</span>(<span class="at">data =</span> WorldSci, </span>
<span id="cb65-4"><a href="#cb65-4"></a>       <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group,<span class="at">label =</span> region)) <span class="sc">+</span></span>
<span id="cb65-5"><a href="#cb65-5"></a>  <span class="fu">geom_map</span>(<span class="at">data =</span> world_data,</span>
<span id="cb65-6"><a href="#cb65-6"></a>           <span class="at">map =</span> world_data, </span>
<span id="cb65-7"><a href="#cb65-7"></a>           <span class="fu">aes</span>(<span class="at">map_id =</span> region), </span>
<span id="cb65-8"><a href="#cb65-8"></a>           <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb65-9"><a href="#cb65-9"></a>           <span class="at">colour =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb65-10"><a href="#cb65-10"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">fill =</span> meanSci)) <span class="sc">+</span></span>
<span id="cb65-11"><a href="#cb65-11"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"viridis"</span>) <span class="sc">+</span></span>
<span id="cb65-12"><a href="#cb65-12"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> Labels,</span>
<span id="cb65-13"><a href="#cb65-13"></a>                 <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb65-14"><a href="#cb65-14"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> region))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="question">
<p>Plot mean PISA mathematics scores on a world map, labelling the countries.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># Create a data.frame of mathematics scores</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>WorldMath <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3"></a>  <span class="fu">select</span>(CNT, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="#cb66-5"></a>  <span class="fu">summarise</span>(<span class="at">meanmath =</span> <span class="fu">mean</span>(PV1MATH)) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="#cb66-6"></a>  <span class="fu">rename</span>(<span class="at">region =</span> CNT)</span>
<span id="cb66-7"><a href="#cb66-7"></a><span class="co"># The names of two countries in the PISA data frame and world_data data frame don't match (UK/United Kingdom and US/United States). Change the level names in the PISA data to match the world_data</span></span>
<span id="cb66-8"><a href="#cb66-8"></a></span>
<span id="cb66-9"><a href="#cb66-9"></a>WorldMath <span class="ot">&lt;-</span> WorldMath <span class="sc">%&gt;%</span></span>
<span id="cb66-10"><a href="#cb66-10"></a>   <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb66-11"><a href="#cb66-11"></a>                       region <span class="sc">==</span> <span class="st">"United Kingdom"</span> <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb66-12"><a href="#cb66-12"></a>                       region <span class="sc">==</span> <span class="st">"United States"</span>  <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb66-13"><a href="#cb66-13"></a>                       region <span class="sc">==</span> <span class="st">"Russian Federation"</span> <span class="sc">~</span> <span class="st">"Russia"</span>,</span>
<span id="cb66-14"><a href="#cb66-14"></a>                       <span class="at">.default =</span> region))</span>
<span id="cb66-15"><a href="#cb66-15"></a></span>
<span id="cb66-16"><a href="#cb66-16"></a><span class="co"># Create a data frame of country latitude and longitude data</span></span>
<span id="cb66-17"><a href="#cb66-17"></a>world_data <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="at">map =</span> <span class="st">"world"</span>)</span>
<span id="cb66-18"><a href="#cb66-18"></a></span>
<span id="cb66-19"><a href="#cb66-19"></a>WorldMath <span class="ot">&lt;-</span> <span class="fu">left_join</span>(WorldMath, world_data, <span class="at">by =</span> <span class="st">"region"</span>)</span>
<span id="cb66-20"><a href="#cb66-20"></a></span>
<span id="cb66-21"><a href="#cb66-21"></a><span class="co"># Use geom_map to plot the basic world map (fill is white, line colour is black)</span></span>
<span id="cb66-22"><a href="#cb66-22"></a><span class="co"># Use geom_polygon to plot the PISA data</span></span>
<span id="cb66-23"><a href="#cb66-23"></a><span class="co"># Add a colour scale</span></span>
<span id="cb66-24"><a href="#cb66-24"></a></span>
<span id="cb66-25"><a href="#cb66-25"></a>Labels<span class="ot">&lt;-</span>WorldMath<span class="sc">%&gt;%</span></span>
<span id="cb66-26"><a href="#cb66-26"></a>  <span class="fu">group_by</span>(region)<span class="sc">%&gt;%</span></span>
<span id="cb66-27"><a href="#cb66-27"></a>  <span class="fu">summarise</span>(<span class="at">meanmath =</span> <span class="fu">mean</span>(meanmath), <span class="at">lat =</span> <span class="fu">mean</span>(lat), <span class="at">long =</span> <span class="fu">mean</span>(long))<span class="sc">%&gt;%</span></span>
<span id="cb66-28"><a href="#cb66-28"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb66-29"><a href="#cb66-29"></a></span>
<span id="cb66-30"><a href="#cb66-30"></a><span class="co"># Use geom_map to plot the basic world map (fill is white, line colour is black)</span></span>
<span id="cb66-31"><a href="#cb66-31"></a><span class="co"># Use geom_polygon to plot the PISA data</span></span>
<span id="cb66-32"><a href="#cb66-32"></a><span class="co"># Add a colour scale</span></span>
<span id="cb66-33"><a href="#cb66-33"></a><span class="fu">ggplot</span>(<span class="at">data =</span> WorldMath, </span>
<span id="cb66-34"><a href="#cb66-34"></a>       <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group,<span class="at">label =</span> region)) <span class="sc">+</span></span>
<span id="cb66-35"><a href="#cb66-35"></a>  <span class="fu">geom_map</span>(<span class="at">data =</span> world_data,</span>
<span id="cb66-36"><a href="#cb66-36"></a>           <span class="at">map =</span> world_data, </span>
<span id="cb66-37"><a href="#cb66-37"></a>           <span class="fu">aes</span>(<span class="at">map_id =</span> region), </span>
<span id="cb66-38"><a href="#cb66-38"></a>           <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb66-39"><a href="#cb66-39"></a>           <span class="at">colour =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb66-40"><a href="#cb66-40"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">fill =</span> meanmath)) <span class="sc">+</span></span>
<span id="cb66-41"><a href="#cb66-41"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"viridis"</span>) <span class="sc">+</span></span>
<span id="cb66-42"><a href="#cb66-42"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> Labels,</span>
<span id="cb66-43"><a href="#cb66-43"></a>                 <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb66-44"><a href="#cb66-44"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> region))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="task-4---violin-plots" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="task-4---violin-plots"><span class="header-section-number">6.4</span> Task 4 - Violin plots</h2>
<p>Violin plots are a useful way of showing the distribution of scores across different items. They can make distributions easy to compare, at a glance, and to give a sense of the relative frequency of different scores. In <code>ggplot</code> you can use <code>geom_violin</code> to produce plots. For example, you can compare the distribution of science scores in Spain and Portugal by gender (note the relatively long tail at the bottom of #####):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># Create a data frame of Spain and Portugal science scores including gender</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>PISAsubset <span class="ot">&lt;-</span> PISA_2022<span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3"></a>  <span class="fu">select</span>(CNT, PV1SCIE, ST004D01T)<span class="sc">%&gt;%</span></span>
<span id="cb67-4"><a href="#cb67-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Spain"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Portugal"</span>)</span>
<span id="cb67-5"><a href="#cb67-5"></a></span>
<span id="cb67-6"><a href="#cb67-6"></a><span class="co"># Set up the country on the x axis, and score on the y, setting colour by gender</span></span>
<span id="cb67-7"><a href="#cb67-7"></a><span class="fu">ggplot</span>(PISAsubset, <span class="fu">aes</span>(<span class="at">x=</span>CNT, <span class="at">y=</span>PV1SCIE, <span class="at">fill=</span>ST004D01T))<span class="sc">+</span></span>
<span id="cb67-8"><a href="#cb67-8"></a>  <span class="fu">geom_violin</span>()<span class="sc">+</span></span>
<span id="cb67-9"><a href="#cb67-9"></a>  <span class="fu">xlab</span>(<span class="st">"Country"</span>)<span class="sc">+</span></span>
<span id="cb67-10"><a href="#cb67-10"></a>  <span class="fu">ylab</span>(<span class="st">"Science Score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>You can rotate the plot using <code>+coord_flip()</code> and add black dots for the mean using: <code>stat_summary(fun = "mean", geom = "point", color = "black")</code>. You can also try <code>geom= "crossbar"</code>. Because we have two groups (male and female), we need to add <code>position = position_dodge(width=0.9)</code> to make the dots appear in the right place</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># Create a data frame of country science scores including gender</span></span>
<span id="cb68-2"><a href="#cb68-2"></a></span>
<span id="cb68-3"><a href="#cb68-3"></a>PISAsubset<span class="ot">&lt;-</span>PISA_2022<span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4"></a>  <span class="fu">select</span>(CNT, PV1SCIE, ST004D01T)<span class="sc">%&gt;%</span></span>
<span id="cb68-5"><a href="#cb68-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Ireland"</span> <span class="sc">|</span></span>
<span id="cb68-6"><a href="#cb68-6"></a>         CNT <span class="sc">==</span> <span class="st">"Qatar"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Brazil"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Kazakhstan"</span> <span class="sc">|</span></span>
<span id="cb68-7"><a href="#cb68-7"></a>           CNT <span class="sc">==</span> <span class="st">"Korea"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Panama"</span>)</span>
<span id="cb68-8"><a href="#cb68-8"></a></span>
<span id="cb68-9"><a href="#cb68-9"></a><span class="co"># Set up the country on the x axis, and score on the y, setting colour by gender, flip the axes and add points for the mean</span></span>
<span id="cb68-10"><a href="#cb68-10"></a></span>
<span id="cb68-11"><a href="#cb68-11"></a><span class="fu">ggplot</span>(PISAsubset, <span class="fu">aes</span>(<span class="at">x =</span> CNT, <span class="at">y =</span> PV1SCIE, <span class="at">fill =</span> ST004D01T))<span class="sc">+</span></span>
<span id="cb68-12"><a href="#cb68-12"></a>  <span class="fu">geom_violin</span>()<span class="sc">+</span></span>
<span id="cb68-13"><a href="#cb68-13"></a>  <span class="fu">xlab</span>(<span class="st">"Country"</span>)<span class="sc">+</span></span>
<span id="cb68-14"><a href="#cb68-14"></a>  <span class="fu">ylab</span>(<span class="st">"Science Score"</span>)<span class="sc">+</span></span>
<span id="cb68-15"><a href="#cb68-15"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb68-16"><a href="#cb68-16"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb68-17"><a href="#cb68-17"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Intro_to_graphs_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="question">
<p>Plot violin plots of PISA <code>HOMEPOS</code> scores, by gender, for the UK, US, Sweden and Finland.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># Create a data frame of WEALTH scores for the 4 countries including gender</span></span>
<span id="cb69-2"><a href="#cb69-2"></a>PISAsubset<span class="ot">&lt;-</span>PISA_2022<span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3"></a>  <span class="fu">select</span>(CNT, HOMEPOS, ST004D01T)<span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Sweden"</span> <span class="sc">|</span> </span>
<span id="cb69-5"><a href="#cb69-5"></a>           CNT <span class="sc">==</span> <span class="st">"Finland"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"United States"</span>)</span>
<span id="cb69-6"><a href="#cb69-6"></a></span>
<span id="cb69-7"><a href="#cb69-7"></a><span class="co"># Set up the country on the x axis, and score on the y, setting colour by gender</span></span>
<span id="cb69-8"><a href="#cb69-8"></a><span class="fu">ggplot</span>(PISAsubset, <span class="fu">aes</span>(<span class="at">x=</span>CNT, <span class="at">y=</span>HOMEPOS, <span class="at">fill=</span>ST004D01T))<span class="sc">+</span></span>
<span id="cb69-9"><a href="#cb69-9"></a>  <span class="fu">geom_violin</span>()<span class="sc">+</span></span>
<span id="cb69-10"><a href="#cb69-10"></a>  <span class="fu">xlab</span>(<span class="st">"Country"</span>)<span class="sc">+</span></span>
<span id="cb69-11"><a href="#cb69-11"></a>  <span class="fu">ylab</span>(<span class="st">"PISA Wealth measure"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="useful-resources" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Useful resources</h1>
<ul>
<li>The ‘<a href="https://www.data-to-viz.com">From Data to Viz’</a> blog has a helpful flowchart for choosing an appropriate type of graph for different forms of data. The’<a href="https://ft-interactive.github.io/visual-vocabulary/">Visual Vocabulary</a>’ site, produced by the Financial times is an alternative option for selecting an appropriate chart.</li>
<li>You can find a gallery of around 400 types of visualisation you can produce in R <a href="https://r-graph-gallery.com/all-graphs.html">at the R chart gallery</a>.</li>
<li>The Royal Statistical Society has produced a guide to making visual representations, <a href="https://royal-statistical-society.github.io/datavisguide/">Best Practice for Data Representations</a>, that shows you how to make readable, accessible data visualisations.</li>
<li>The classic text on representing data visually is Edward R. Tufte’s <em>The Visual Display of Quantitative Information</em> <span class="citation" data-cites="tufte2001visual">(<a href="#ref-tufte2001visual" role="doc-biblioref">Tufte 2001</a>)</span>. <em>The Visual Display</em> is a beautiful book with illustrations of best practice in graphing and other forms of data representation. Tufte sets out the following principles - a representation should:
<ul>
<li>show the data</li>
<li>induce the viewer to think about the substance rather than about methodology, graphic design, the technology of graphic production, or something else</li>
<li>avoid distorting what the data have to say</li>
<li>present many numbers in a small space</li>
<li>make large data sets coherent</li>
<li>encourage the eye to compare different pieces of data</li>
<li>reveal the data at several levels of detail, from a broad overview to the fine structure • serve a reasonably clear purpose: description, exploration, tabulation, or decoration</li>
<li>be closely integrated with the statistical and verbal descriptions of a data set. <span class="citation" data-cites="tufte2001visual">(<a href="#ref-tufte2001visual" role="doc-biblioref">Tufte 2001, 2:13</a>)</span></li>
</ul></li>
</ul>
<p>Lukasz Piwek has <a href="http://motioninsocial.com/tufte/">created guidance</a> on creating Tufte-style representations using R packages.</p>
<ul>
<li><p>Further useful guidance on graphing can be found at the <a href="https://github.com/cxli233/FriendsDontLetFriends#1-friends-dont-let-friends-make-bar-plots-for-means-separation">Friends Don’t Let Friends Make Bad Graphs</a> pages. For example, note the advice that: ‘Friends Don’t Let Friends Make Pie Chart’ - the eye is not very good at interpreting the angles on sections of pie charts - differences between sectors of similar sizes can be hard to judge, so <a href="https://www.data-to-viz.com/caveat/pie.html">their use has been criticized</a>. A stacked bar chart is a better option.</p></li>
<li><p>See also <a href="https://nightingaledvs.com/ive-stopped-using-box-plots-should-you/">I’ve Stopped Using Box Plots. Should You?</a></p></li>
<li><p>Researchers have recently suggested journals avoid bar graphs - bar charts mask the distribution of points and can misrepresent the data <span class="citation" data-cites="weissgerber2015beyond">(<a href="#ref-weissgerber2015beyond" role="doc-biblioref">Weissgerber et al. 2015</a>)</span>. Box plots or, if samples are large enough, violin plots are recommended.</p></li>
</ul>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-tufte2001visual" class="csl-entry" role="listitem">
Tufte, Edward R. 2001. <em>The Visual Display of Quantitative Information</em>. Vol. 2. Graphics Press.
</div>
<div id="ref-weissgerber2015beyond" class="csl-entry" role="listitem">
Weissgerber, Tracey L, Natasa M Milic, Stacey J Winham, and Vesna D Garovic. 2015. <span>“Beyond Bar and Line Graphs: Time for a New Data Presentation Paradigm.”</span> <em>PLoS Biology</em> 13 (4): e1002128.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>