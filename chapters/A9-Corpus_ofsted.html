<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Corpus Analysis – ECSR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-868b9742d7bde9f1698ef1c41a43f714.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../css/mastemr.css">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="index.qmd" class="navbar-brand navbar-brand-logo">
    <img src="../images/KCL_logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="index.qmd">
    <span class="navbar-title">ECSR</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/A9-Corpus_ofsted.html">Corpus analysis</a></li><li class="breadcrumb-item"><a href="../chapters/A9-Corpus_ofsted.html">Corpus Analysis</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-1-Loading_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-2-Intro_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loading packages and exploring data</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to Stats</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-1-Descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Descriptive Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-2-ChisqPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis testing and Chi-square tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-3-T-testsPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T-tests</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Intro_to_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making graphs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Corpus analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A9-Corpus_ofsted.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Corpus Analysis</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Publications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-Rpublications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Publishing using R and quarto</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-PISA_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PISA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-DfE_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DfE England</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A3-TIMSS_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TIMSS, PIRLS and ICILS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A4-Other_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A5-Self_Study_Tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self Study Tasks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A6-selecting_statistical_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selecting statistical tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A7-QandA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Questions and Answers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A10-Leaflet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Leaflet</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#corpus-analysis" id="toc-corpus-analysis" class="nav-link active" data-scroll-target="#corpus-analysis"><span class="header-section-number">1</span> Corpus Analysis</a>
  <ul class="collapse">
<li><a href="#corpus-analysis-in-r---quanteda" id="toc-corpus-analysis-in-r---quanteda" class="nav-link" data-scroll-target="#corpus-analysis-in-r---quanteda"><span class="header-section-number">1.1</span> Corpus Analysis in R - quanteda</a></li>
  <li><a href="#creating-a-corpus" id="toc-creating-a-corpus" class="nav-link" data-scroll-target="#creating-a-corpus"><span class="header-section-number">1.2</span> Creating a corpus</a></li>
  <li><a href="#the-ofsted-data-set" id="toc-the-ofsted-data-set" class="nav-link" data-scroll-target="#the-ofsted-data-set"><span class="header-section-number">1.3</span> The Ofsted data set</a></li>
  <li><a href="#loading-the-pre-made-ofsted-corpus" id="toc-loading-the-pre-made-ofsted-corpus" class="nav-link" data-scroll-target="#loading-the-pre-made-ofsted-corpus"><span class="header-section-number">1.4</span> Loading the pre-made Ofsted corpus</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions"><span class="header-section-number">1.5</span> Questions</a></li>
  <li>
<a href="#regular-expressions-and-stringr-commands" id="toc-regular-expressions-and-stringr-commands" class="nav-link" data-scroll-target="#regular-expressions-and-stringr-commands"><span class="header-section-number">1.6</span> Regular expressions and <code>stringr</code> commands</a>
  <ul class="collapse">
<li><a href="#questions-1" id="toc-questions-1" class="nav-link" data-scroll-target="#questions-1"><span class="header-section-number">1.6.1</span> Questions</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#using-quanteda-to-do-some-analysis" id="toc-using-quanteda-to-do-some-analysis" class="nav-link" data-scroll-target="#using-quanteda-to-do-some-analysis"><span class="header-section-number">2</span> Using quanteda to do some analysis</a>
  <ul class="collapse">
<li><a href="#basic-analysis-in-quanteda" id="toc-basic-analysis-in-quanteda" class="nav-link" data-scroll-target="#basic-analysis-in-quanteda"><span class="header-section-number">2.1</span> Basic analysis in quanteda</a></li>
  <li>
<a href="#tokenising-the-corpus" id="toc-tokenising-the-corpus" class="nav-link" data-scroll-target="#tokenising-the-corpus"><span class="header-section-number">2.2</span> Tokenising the corpus</a>
  <ul class="collapse">
<li><a href="#questions-2" id="toc-questions-2" class="nav-link" data-scroll-target="#questions-2"><span class="header-section-number">2.2.1</span> Questions</a></li>
  </ul>
</li>
  <li><a href="#word-frequencies" id="toc-word-frequencies" class="nav-link" data-scroll-target="#word-frequencies"><span class="header-section-number">2.3</span> Word frequencies</a></li>
  <li>
<a href="#cleaning-transcripts" id="toc-cleaning-transcripts" class="nav-link" data-scroll-target="#cleaning-transcripts"><span class="header-section-number">2.4</span> Cleaning transcripts</a>
  <ul class="collapse">
<li><a href="#creating-a-custom-dictionary" id="toc-creating-a-custom-dictionary" class="nav-link" data-scroll-target="#creating-a-custom-dictionary"><span class="header-section-number">2.4.1</span> Creating a custom dictionary</a></li>
  <li><a href="#questions-3" id="toc-questions-3" class="nav-link" data-scroll-target="#questions-3"><span class="header-section-number">2.4.2</span> Questions</a></li>
  </ul>
</li>
  <li><a href="#words-that-co-occur" id="toc-words-that-co-occur" class="nav-link" data-scroll-target="#words-that-co-occur"><span class="header-section-number">2.5</span> Words that co-occur</a></li>
  <li>
<a href="#word-clouds" id="toc-word-clouds" class="nav-link" data-scroll-target="#word-clouds"><span class="header-section-number">2.6</span> Word clouds</a>
  <ul class="collapse">
<li><a href="#questions-4" id="toc-questions-4" class="nav-link" data-scroll-target="#questions-4"><span class="header-section-number">2.6.1</span> Questions</a></li>
  </ul>
</li>
  <li><a href="#sentiment-analysis" id="toc-sentiment-analysis" class="nav-link" data-scroll-target="#sentiment-analysis"><span class="header-section-number">2.7</span> Sentiment analysis</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/A9-Corpus_ofsted.html">Corpus analysis</a></li><li class="breadcrumb-item"><a href="../chapters/A9-Corpus_ofsted.html">Corpus Analysis</a></li></ol></nav><div class="quarto-title">
<h1 class="title">Corpus Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="corpus-analysis" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Corpus Analysis</h1>
<p>Corpus analysis is the empirical study of linguistic patterns associated with language use in different contexts, often now carried out using computer-based approaches.</p>
<section id="corpus-analysis-in-r---quanteda" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="corpus-analysis-in-r---quanteda">
<span class="header-section-number">1.1</span> Corpus Analysis in R - quanteda</h2>
<p>One of the most widely used packages for corpus analysis in R is the <code>quanteda</code> package. <code>quanteda</code> is a comprehensive package that allows researchers to manage corpora and carry out a wide range of analyses on them. To install <code>quanteda</code>, use the following code, if this is the first time you are using the package you will need to include the <code>install.packages("quanteda")</code> function. We will also load the <code>tidyverse</code> package, which is a collection of packages that are commonly used in data analysis in R.</p>
</section><section id="creating-a-corpus" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="creating-a-corpus">
<span class="header-section-number">1.2</span> Creating a corpus</h2>
<p>Typically, the first step in a corpus analysis project is to create a corpus object. A corpus object is a collection of texts that can be analysed together. In <code>quanteda</code>, a corpus object can be created from a variety of sources, including text files, data frames, and character vectors. There are a number of different approaches to reading in textual data.</p>
</section><section id="the-ofsted-data-set" class="level2" data-number="1.3"><h2 data-number="1.3" class="anchored" data-anchor-id="the-ofsted-data-set">
<span class="header-section-number">1.3</span> The Ofsted data set</h2>
<p>The data in this teaching page are drawn from the corpus of Ofsted reports that are freely available on the Ofsted website:</p>
<p>https://reports.ofsted.gov.uk/</p>
<p>The Ofsted website hosts reports from inspections going back to 1997, however, report banks from 1997-99 appear to be incomplete. There are reports on a range of different types of school inspections for state school primary, secondary and sixth form provision, as well as independent providers offering special school and boarding provision.</p>
<p>Attempts have been made to conduct corpus analysis using these reports, notably:</p>
<ul>
<li><span class="citation" data-cites="bokhove2023useful">Bokhove, Jerrim, and Sims (<a href="#ref-bokhove2023useful" role="doc-biblioref">2023</a>)</span></li>
<li><span class="citation" data-cites="bokhove2024schools">Bokhove, Jerrim, and Sims (<a href="#ref-bokhove2024schools" role="doc-biblioref">2024</a>)</span></li>
</ul>
<p>To extract the Ofsted corpus, we have used the <code>rvest</code> package to scrape the Ofsted website for all providers and all reports linked to each provider. Once we had collected this data, we used it to download each of the 163,706 reports in pdf format. Each of these pdfs was then read into R using the <code>pdftools</code> package, which extracts the text from the pdf files. The corpus file linked below holds all accessible reports from 1997 to April 2025 in a text format.</p>
<div class="cell" data-fig-caption="The number of Ofsted reports on the Ofsted website by year and primary and secondary phase of education">
<details class="code-fold"><summary>Number of Ofsted reports by year and phase of education</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>ofsted_data <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="fu">select</span>(phase_of_education_name, year) <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="fu">group_by</span>(phase_of_education_name, year) <span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="fu">filter</span>(phase_of_education_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Primary"</span>, <span class="st">"Secondary"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y=</span>n)) <span class="sc">+</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>phase_of_education_name) <span class="sc">+</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="fu">ylab</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_ofsted_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Attempts have been made to extract grades, dates, head teacher’s names and genders, inspectors’ names and gender, and map provider information to DfE <a href="https://get-information-schools.service.gov.uk/">GIAS</a> records to provide context on school type (e.g.&nbsp;selective, boys only etc).</p>
<p>All reports from the Ofsted website are available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/">Open Government Licence</a>. The data set linked below is also under the same licence.</p>
<p>Data linked below is free to use and aims to provide a data set where you can conduct your own analysis, similar to that offered by firms such as <a href="https://www.angelsolutions.co.uk/products/watchsted">watchsted</a>. We haven’t bench marked our data set against commercial data sets, but if you do find any issues with it, please do let us know.</p>
<!--
The data in this teaching page are drawn from [talkbank.org](https://talkbank.org/), a repository of spoken language data.
The data are from the UK component of the [CHILDES database](https://childes.talkbank.org/), which is a collection of transcripts of child language development.

An acknowledgement of the data set is shown below:

CHILDES: MacWhinney, B.
(2000).
The CHILDES Project: Tools for analyzing talk.
Third Edition.
Mahwah, NJ: Lawrence Erlbaum Associates.
Note: Please also acknowledge this grant support for CHILDES -- NICHD HD082736.-->
</section><section id="loading-the-pre-made-ofsted-corpus" class="level2" data-number="1.4"><h2 data-number="1.4" class="anchored" data-anchor-id="loading-the-pre-made-ofsted-corpus">
<span class="header-section-number">1.4</span> Loading the pre-made Ofsted corpus</h2>
<p>We have produced several data sets around the Ofsted corpus that can be used for corpus analysis. The two main data sets are:</p>
<ul>
<li>
<code>ofsted_reports_txt_full.parquet</code> [<a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EZtdmlFzmOJEo2TnLiOjJrQBMBBqUpuVG1ZZmycum0dgpQ?e=tbYYT5">download</a>] (~2.2 GB) raw text including punctuation, e.g.&nbsp;new lines</li>
<li>
<code>ofsted_reports_txt_full_lower.parquet</code> [<a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/ERg9kZrAWedMhZeZBrIzdNMBNuapElpymnCD6CtxXOY5ew?e=JWxBR9">download</a>] (~2.0 GB) all text lower case with punctuation removed</li>
<li>
<code>ofsted_reports_txt_london.parquet</code> [<a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EQRUsQaFFGNImkb881H7VEQBYYyh0GXwN6IMlwnjNO7OVw?e=9thIv9">download</a>] (~250 MB)</li>
</ul>
<p>These data sets have the following fields:</p>
<div class="cell">
<div class="cell-output-display">
<div id="imitwmnmoc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#imitwmnmoc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#imitwmnmoc thead, #imitwmnmoc tbody, #imitwmnmoc tfoot, #imitwmnmoc tr, #imitwmnmoc td, #imitwmnmoc th {
  border-style: none;
}

#imitwmnmoc p {
  margin: 0;
  padding: 0;
}

#imitwmnmoc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#imitwmnmoc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#imitwmnmoc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#imitwmnmoc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#imitwmnmoc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#imitwmnmoc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#imitwmnmoc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#imitwmnmoc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#imitwmnmoc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#imitwmnmoc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#imitwmnmoc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#imitwmnmoc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#imitwmnmoc .gt_spanner_row {
  border-bottom-style: hidden;
}

#imitwmnmoc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#imitwmnmoc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#imitwmnmoc .gt_from_md > :first-child {
  margin-top: 0;
}

#imitwmnmoc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#imitwmnmoc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#imitwmnmoc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#imitwmnmoc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#imitwmnmoc .gt_row_group_first td {
  border-top-width: 2px;
}

#imitwmnmoc .gt_row_group_first th {
  border-top-width: 2px;
}

#imitwmnmoc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#imitwmnmoc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#imitwmnmoc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#imitwmnmoc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#imitwmnmoc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#imitwmnmoc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#imitwmnmoc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#imitwmnmoc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#imitwmnmoc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#imitwmnmoc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#imitwmnmoc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#imitwmnmoc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#imitwmnmoc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#imitwmnmoc .gt_left {
  text-align: left;
}

#imitwmnmoc .gt_center {
  text-align: center;
}

#imitwmnmoc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#imitwmnmoc .gt_font_normal {
  font-weight: normal;
}

#imitwmnmoc .gt_font_bold {
  font-weight: bold;
}

#imitwmnmoc .gt_font_italic {
  font-style: italic;
}

#imitwmnmoc .gt_super {
  font-size: 65%;
}

#imitwmnmoc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#imitwmnmoc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#imitwmnmoc .gt_indent_1 {
  text-indent: 5px;
}

#imitwmnmoc .gt_indent_2 {
  text-indent: 10px;
}

#imitwmnmoc .gt_indent_3 {
  text-indent: 15px;
}

#imitwmnmoc .gt_indent_4 {
  text-indent: 20px;
}

#imitwmnmoc .gt_indent_5 {
  text-indent: 25px;
}

#imitwmnmoc .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#imitwmnmoc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings header">
<th id="name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">name</th>
<th id="description" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">description</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="name">urn</td>
<td class="gt_row gt_left" headers="description">unique reference number of a school</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">file</td>
<td class="gt_row gt_left" headers="description">file name of the report</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">text</td>
<td class="gt_row gt_left" headers="description">raw text of the report</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">year</td>
<td class="gt_row gt_left" headers="description">year of the report</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">month</td>
<td class="gt_row gt_left" headers="description">month of the report</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">day</td>
<td class="gt_row gt_left" headers="description">date of the report</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">name</td>
<td class="gt_row gt_left" headers="description">name of the school</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">reports</td>
<td class="gt_row gt_left" headers="description">full description of the report</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">urls</td>
<td class="gt_row gt_left" headers="description">original web location of report</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">closed_link</td>
<td class="gt_row gt_left" headers="description">URN of closed link school</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">closed_name</td>
<td class="gt_row gt_left" headers="description">name of closed link school</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">type</td>
<td class="gt_row gt_left" headers="description">type of inspection - full, curriculum, short, etc.</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">grade</td>
<td class="gt_row gt_left" headers="description">ofsted grade, where applicable</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">gender</td>
<td class="gt_row gt_left" headers="description">all boys, all girls, mixed</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">phase_of_education_name</td>
<td class="gt_row gt_left" headers="description">primary, secondary etc</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">sch_type</td>
<td class="gt_row gt_left" headers="description">school type - secondary modern, grammer, independent, special etc</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">la_name</td>
<td class="gt_row gt_left" headers="description">name of local authority</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">gor_name</td>
<td class="gt_row gt_left" headers="description">name of region</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">easting</td>
<td class="gt_row gt_left" headers="description">map coordinates</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">northing</td>
<td class="gt_row gt_left" headers="description">map coordinates</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">urban_rural_name</td>
<td class="gt_row gt_left" headers="description">whether school is urban or rural</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">number_of_pupils</td>
<td class="gt_row gt_left" headers="description">size of school (2025)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">percentage_fsm</td>
<td class="gt_row gt_left" headers="description">% of students on FSM (2025)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name">inspector</td>
<td class="gt_row gt_left" headers="description">lists of inpectors along with gender</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Additionally, we have data sets that include the gender of the head teachers and the inspectors:</p>
<ul>
<li>
<code>ofsted_heads.parquet</code> [<a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EeouINant6ZKsUsxD_ApANcBkqFAgcQ5GfYY-SaEYeOLUw?e=IUK70n">download</a>] (~2 MB) head teacher names, titles and guessed gender</li>
<li>
<code>inspector_stats_from_text.parquet</code> [<a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/ERxfepQP1nxFriP-0roCb7ABAM1ux5FQojxlUFR2YLmDRw?e=k35dvA">download</a>] (~1.5 MB) stats on inspectors for each inspection, including: number of inspectors, number of HMIs, gender split, gender of lead inspector</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To find the path to a file:</p>
<p>On a PC: hold Shift and right-click the file or folder, then select “Copy as Path” from the context menu.</p>
<p>On a Mac: hold down the Option key and right-click the file or folder, then select “Copy as Pathname” from the context menu.</p>
</div>
</div>
<p>To load the data, first download the files linked above into a folder. Loading the files can take a lot of compute power, so only attempt the below if you have 16GB of RAM and not much else running on your machine:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">library</span>(arrow)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="fu">library</span>(gt)</span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a>corpus_folder <span class="ot">&lt;-</span> <span class="st">"name/of/folder"</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>  </span>
<span id="cb2-8"><a href="#cb2-8"></a>ofsted_data <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(<span class="fu">glue</span>(<span class="st">"{corpus_folder}ofsted_reports_txt_full.parquet"</span>))</span>
<span id="cb2-9"><a href="#cb2-9"></a>inspectors <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(<span class="fu">glue</span>(<span class="st">"{corpus_folder}inspector_stats_from_text.parquet"</span>))</span>
<span id="cb2-10"><a href="#cb2-10"></a>heads <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(<span class="fu">glue</span>(<span class="st">"{corpus_folder}ofsted_heads.parquet"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--
If you are struggling with RAM, you can always use a feature of parquet files that allow you to only load parts of them. In this situation, you can choose to just load the reports from 2019-2025 by doing the following:




::: {.cell}

:::



-->
</section><section id="questions" class="level2" data-number="1.5"><h2 data-number="1.5" class="anchored" data-anchor-id="questions">
<span class="header-section-number">1.5</span> Questions</h2>
<p>Now we have the data loaded, you can start to run some analysis on it, try the following questions</p>
<div class="question">
<ol type="1">
<li>Which year had the largest number of “outstanding” <code>grade</code> reports? Can you work this out as a percentage of all reports with <code>grade</code> is not equal to “other”?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>largest outstanding year n</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>ofsted_data <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">filter</span>(grade <span class="sc">==</span> <span class="st">"outstanding"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>largest outstanding year %</summary><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>ofsted_data <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">filter</span>(grade <span class="sc">!=</span> <span class="st">"other"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="fu">group_by</span>(year, grade, total) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb4-7"><a href="#cb4-7"></a>            <span class="at">pct =</span> n <span class="sc">/</span> <span class="fu">unique</span>(total)) <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>  <span class="fu">filter</span>(grade <span class="sc">==</span> <span class="st">"outstanding"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pct))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>How many “full” inspections were there in 2020, compared to 2019 and 2021? How many of these were for “Primary” and “Secondary” schools?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>full inspections 2019,2020,2021</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>ofsted_data <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"full"</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>         year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>full inspections 2019,2020,2021, by phase</summary><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># by phase of education</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>ofsted_data <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">filter</span>(phase_of_education_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Primary"</span>, <span class="st">"Secondary"</span>),</span>
<span id="cb6-4"><a href="#cb6-4"></a>         type <span class="sc">==</span> <span class="st">"full"</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>         year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="fu">group_by</span>(year, phase_of_education_name) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>How do the number of primary full inspections correlate with the number of secondary full inspections across years? Work out a correlation co-efficient (BONUS: can you plot this?)</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>all_inspect <span class="ot">&lt;-</span> ofsted_data <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">filter</span>(phase_of_education_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Primary"</span>, <span class="st">"Secondary"</span>),</span>
<span id="cb7-3"><a href="#cb7-3"></a>         type <span class="sc">==</span> <span class="st">"full"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">group_by</span>(year, phase_of_education_name) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a>primary <span class="ot">&lt;-</span> all_inspect <span class="sc">%&gt;%</span> <span class="fu">filter</span>(phase_of_education_name <span class="sc">==</span> <span class="st">"Primary"</span>)</span>
<span id="cb7-8"><a href="#cb7-8"></a>secondary <span class="ot">&lt;-</span> all_inspect <span class="sc">%&gt;%</span> <span class="fu">filter</span>(phase_of_education_name <span class="sc">==</span> <span class="st">"Secondary"</span>)</span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="fu">cor.test</span>(primary<span class="sc">$</span>n, </span>
<span id="cb7-11"><a href="#cb7-11"></a>         secondary<span class="sc">$</span>n, </span>
<span id="cb7-12"><a href="#cb7-12"></a>         <span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt; 0.9517405</span></span>
<span id="cb7-14"><a href="#cb7-14"></a></span>
<span id="cb7-15"><a href="#cb7-15"></a></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">cbind</span>(primary, secondary), <span class="fu">aes</span>(<span class="st">`</span><span class="at">n...3</span><span class="st">`</span>, <span class="st">`</span><span class="at">n...6</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="st">`</span><span class="at">year...1</span><span class="st">`</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>  <span class="fu">xlab</span>(<span class="st">"Primary"</span>)<span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>  <span class="fu">ylab</span>(<span class="st">"Secondary"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section><section id="regular-expressions-and-stringr-commands" class="level2" data-number="1.6"><h2 data-number="1.6" class="anchored" data-anchor-id="regular-expressions-and-stringr-commands">
<span class="header-section-number">1.6</span> Regular expressions and <code>stringr</code> commands</h2>
<p>The tidyverse includes the <code>stringr</code> package, which provides a set of functions for working with strings in R. For example, you might want to track the number of reports that mention the word “shakespeare”. To do this we can use the <code>str_detect</code> function, which checks if a string contains a certain pattern and returns <code>TRUE</code> if it finds it, or <code>FALSE</code> if it doesn’t.</p>
<p>Warning, this can take a long time to run, so you might want to try it on a subset of the data first, e.g.&nbsp;<code>ofsted_data %&gt;% filter(year == 2020)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a>shakespeare_finder <span class="ot">&lt;-</span> ofsted_data <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">mutate</span>(<span class="at">shakeshere =</span> <span class="fu">str_detect</span>(text, <span class="st">"shakespeare"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">select</span>(year, phase_of_education_name, shakeshere)</span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co"># Total shakespeare mentions</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>shakespeare_finder <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(shakeshere))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1    16</code></pre>
</div>
</div>
<p>This seems rather low, with only 16 mentions, but maybe it’s because we’re looking for “shakespeare” with a lower case “s”, we need to search for mentions of shakespeare with lower <em>and</em> upper case ‘s’. We can do this using the OR command, which is <code>|</code>, surrounded by square brackets to indicate that we are looking for either a lower or upper case “s”.</p>
<p>But our search is not just subject to the poor proof checking of some Ofsted report writers, there is ongoing debate over how the <em>Eternal Bard</em> spelt his own name, even his gravestone (Shakspeare) differs from his wife’s (Shakespeare). So how can we tell how how mentions of Shakespeare are in the Ofsted corpus? Through regular expressions, or <em>regex</em>, that’s how. We might consider the following spellings of Shakespeare:</p>
<ul>
<li>shakespeare</li>
<li>shakspeare</li>
<li>shakspere</li>
<li>shakespare</li>
</ul>
<p>And we can put together a longer string with the <code>|</code> separating each option, which means “or” in regex:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>ofsted_data <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">mutate</span>(<span class="at">shakeshere =</span> <span class="fu">str_detect</span>(text,</span>
<span id="cb10-5"><a href="#cb10-5"></a>                          <span class="st">"[s|S]hakespeare|[s|S]hakspeare|[s|S]hakespere|[s|S]hakespeare"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="fu">select</span>(year, phase_of_education_name, shakeshere) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(shakeshere))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1  4093</code></pre>
</div>
</div>
<p>This has picked up another two mentions of Shakespeare! But this is already starting to get a bit cumbersome, and what if we want to find “shakespearean” and other uses fo the word? We can see a few patterns about the different names:</p>
<ul>
<li>the words of interest start with “shakesp” or “shaksp”, no other words will do</li>
<li>it might be capital “S” or lower case “s”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>ofsted_data <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">mutate</span>(<span class="at">shakeshere =</span> <span class="fu">str_detect</span>(text,</span>
<span id="cb12-3"><a href="#cb12-3"></a>                          <span class="st">"[s|S]hakesp|[s|S]haksp"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">select</span>(year, phase_of_education_name, shakeshere) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(shakeshere))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1  4159</code></pre>
</div>
</div>
<p>This returns an extra 60 reports. We’ll cover regular expressions in more detail below.</p>
<section id="questions-1" class="level3" data-number="1.6.1"><h3 data-number="1.6.1" class="anchored" data-anchor-id="questions-1">
<span class="header-section-number">1.6.1</span> Questions</h3>
<div class="question">
<ol type="1">
<li>How many references are there to Tolkien in the Ofsted corpus? How many reports mispell Tolkien’s name?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>Tolkien mentions</summary><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># ofsted inspectors are almost as likely to mispell Tolkien's name than to spell it correctly</span></span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a>ofsted_data <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">mutate</span>(<span class="at">tolkien =</span> <span class="fu">str_detect</span>(text, <span class="st">"[t|T]olkien"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">select</span>(year, phase_of_education_name, tolkien) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(tolkien))</span>
<span id="cb14-8"><a href="#cb14-8"></a></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co"># 165</span></span>
<span id="cb14-10"><a href="#cb14-10"></a></span>
<span id="cb14-11"><a href="#cb14-11"></a>ofsted_data <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="fu">mutate</span>(<span class="at">tolkien =</span> <span class="fu">str_detect</span>(text, <span class="st">"[t|T]olkein"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>  <span class="fu">select</span>(year, phase_of_education_name, tolkien) <span class="sc">%&gt;%</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-15"><a href="#cb14-15"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(tolkien))</span>
<span id="cb14-16"><a href="#cb14-16"></a></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="co"># 106</span></span>
<span id="cb14-18"><a href="#cb14-18"></a></span>
<span id="cb14-19"><a href="#cb14-19"></a>ofsted_data <span class="sc">%&gt;%</span> </span>
<span id="cb14-20"><a href="#cb14-20"></a>  <span class="fu">mutate</span>(<span class="at">tolkien =</span> <span class="fu">str_detect</span>(text, <span class="st">"[t|T]olkin|[t|T]olken|[t|T]okien|[t|T]okein"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-21"><a href="#cb14-21"></a>  <span class="fu">select</span>(year, phase_of_education_name, tolkien) <span class="sc">%&gt;%</span></span>
<span id="cb14-22"><a href="#cb14-22"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-23"><a href="#cb14-23"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(tolkien))</span>
<span id="cb14-24"><a href="#cb14-24"></a></span>
<span id="cb14-25"><a href="#cb14-25"></a><span class="co"># 6 some bad spelling, but not that bad</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>How do mentions of the word “equity” compare to mentions of the word “equality” in the Ofsted corpus? How many reports mention both words?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>equality and equity mentions</summary><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>ofsted_data <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">mutate</span>(<span class="at">equality =</span> <span class="fu">str_detect</span>(text, <span class="st">"equality"</span>),</span>
<span id="cb15-3"><a href="#cb15-3"></a>         <span class="at">equity =</span> <span class="fu">str_detect</span>(text, <span class="st">"equity"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">select</span>(year, phase_of_education_name, equality, equity) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="fu">summarise</span>(<span class="at">n_equality =</span> <span class="fu">sum</span>(equality),</span>
<span id="cb15-7"><a href="#cb15-7"></a>            <span class="at">n_equity =</span> <span class="fu">sum</span>(equity),</span>
<span id="cb15-8"><a href="#cb15-8"></a>            <span class="at">n_both =</span> <span class="fu">sum</span>(equality <span class="sc">&amp;</span> equity))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Compare counts of mentions of the term behaviour in primary and secondary school reports. You will want to use the <code>phase_of_education_name</code> variable to compare primary and secondary schools. How many reports spell behaviour wrong?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>behaviour primary vs secondary</summary><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>ofsted_data <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">filter</span>(phase_of_education_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Primary"</span>, <span class="st">"Secondary"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">mutate</span>(<span class="at">behaviour =</span> <span class="fu">str_detect</span>(text, <span class="st">"[B|b]ehaviour"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">group_by</span>(phase_of_education_name) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">select</span>(year, phase_of_education_name, behaviour) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="fu">summarise</span>(<span class="at">n_behaviour =</span> <span class="fu">sum</span>(behaviour),</span>
<span id="cb16-7"><a href="#cb16-7"></a>            <span class="at">n_reports =</span> <span class="fu">n</span>(),</span>
<span id="cb16-8"><a href="#cb16-8"></a>            <span class="at">perc =</span> <span class="fu">round</span>(n_behaviour <span class="sc">/</span> n_reports <span class="sc">*</span> <span class="dv">100</span>, <span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb16-9"><a href="#cb16-9"></a></span>
<span id="cb16-10"><a href="#cb16-10"></a></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co"># behaviour misspellings</span></span>
<span id="cb16-12"><a href="#cb16-12"></a></span>
<span id="cb16-13"><a href="#cb16-13"></a>ofsted_data <span class="sc">%&gt;%</span> </span>
<span id="cb16-14"><a href="#cb16-14"></a>  <span class="fu">filter</span>(phase_of_education_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Primary"</span>, <span class="st">"Secondary"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-15"><a href="#cb16-15"></a>  <span class="fu">mutate</span>(<span class="at">behaviour =</span> <span class="fu">str_detect</span>(text, <span class="st">"[B|b]ehavour|[B|b]ehavior"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-16"><a href="#cb16-16"></a>  <span class="fu">group_by</span>(phase_of_education_name) <span class="sc">%&gt;%</span></span>
<span id="cb16-17"><a href="#cb16-17"></a>  <span class="fu">select</span>(year, phase_of_education_name, behaviour) <span class="sc">%&gt;%</span></span>
<span id="cb16-18"><a href="#cb16-18"></a>  <span class="fu">summarise</span>(<span class="at">n_behaviour =</span> <span class="fu">sum</span>(behaviour),</span>
<span id="cb16-19"><a href="#cb16-19"></a>            <span class="at">n_reports =</span> <span class="fu">n</span>(),</span>
<span id="cb16-20"><a href="#cb16-20"></a>            <span class="at">perc =</span> <span class="fu">round</span>(n_behaviour <span class="sc">/</span> n_reports <span class="sc">*</span> <span class="dv">100</span>, <span class="at">digits =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Search for another item of interest, how does this change over the years? Share this with the person next to you</li>
</ol>
</div>
<p>We might also want to extract the text that contains the word “shakesphare”, is it just a spelling mistake or something that merges maths and English. We can do this using the <code>str_extract</code> function, which extracts the first occurrence of a pattern from a string, and the <code>.{10}</code> which matches 10 characters each side of the matched string. WARNING: this can be incredibly slow when working on the whole data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># the actual url is: https://files.ofsted.gov.uk/v1/file/763955</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>ofsted_data <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">mutate</span>(<span class="at">matches =</span> <span class="fu">str_extract</span>(text, <span class="st">".{10}Shakesphere.{10}"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(matches)) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="fu">pull</span>(matches)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ossary of Shakesphereian words "</code></pre>
</div>
</div>
<p>For more information about <code>regex</code> see this great blog post <a href="https://blog.djnavarro.net/posts/2024-12-16_regex-backreferences/#backslashes-part-i">Baby got backreferences</a> which gives a great introduction to regex (using song lyrics as examples!)</p>
</section></section></section><section id="using-quanteda-to-do-some-analysis" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Using quanteda to do some analysis</h1>
<p>The previous analysis is a bit rough and slow. To do faster, better structured corpus analysis we can use the <code>quanteda</code> package. <code>quanteda</code> is a powerful package for managing and analysing text data in R. It provides a range of functions for creating, manipulating, and analysing corpora, as well as for visualising the results.</p>
<p>To use <code>quanteda</code>, you first need to create a corpus object from your text data. This can be done using the <code>corpus()</code> function, which takes a character vector or a data frame as input. The code below shows how to create a corpus object from the <code>ofsted_data</code> data frame.</p>
<p>Once the text files have been read in as text, they need to be converted to a format <code>quanteda</code> can work with. This is done using the <code>corpus</code> function. The code below shows how to convert the <code>ofsted_data</code> object to a corpus object, you must have your corpus text in a column called <code>text</code>. You can think of a corpus like a library of the documents you are using in your project.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Converting a text file to a corpus object</span></span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>ofsted_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(ofsted_london <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4"></a>                          <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>                          <span class="fu">select</span>(text, type, grade, phase_of_education_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="basic-analysis-in-quanteda" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="basic-analysis-in-quanteda">
<span class="header-section-number">2.1</span> Basic analysis in quanteda</h2>
<p>Once you have created a corpus object, you can carry out a range of analyses on it. The <code>quanteda</code> package provides a wide range of functions for analysing corpora. A first step is getting some summary descriptive statistics related to your corpus. The code below shows how to get a summary of the corpus object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># A simple descriptive summary of the corpus</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="fu">summary</span>(ofsted_corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 18800 documents, showing 100 documents:

  Text Types Tokens Sentences type grade phase_of_education_name
 text1  1895  10041       431 full other                 Primary
 text2   594   1612        63 full  good                 Primary
 [ reached 'max' / getOption("max.print") -- omitted 98 rows ]</code></pre>
</div>
</div>
<p>You can see that {quanteda} has used the “text” column of <code>ofsted_data</code> to construct <code>Text</code> <code>Types</code> <code>Tokens</code> <code>Sentences</code>. Types and tokens refer to different ways of counting the unique and total words in a corpus:</p>
<p><strong>Tokens</strong>: This refers to the total number of words (or word-like units) in the corpus, including repetitions. Each individual occurrence of a word, regardless of whether it appears elsewhere in the corpus, counts as a token. <strong>Types</strong>: This refers to the number of unique words in the corpus, disregarding any repetitions. A type is counted only once, no matter how many times it appears in the text. <strong>Sentences</strong>: An attempt to work out the number of sentences in each test, using punctuation delimiters</p>
<p>the corpus command has also kept the data from the other columns, e.g.&nbsp;<code>type</code> <code>grade</code> <code>phase_of_education_name</code>, this is now <em>metadata</em> about your corpus objects. You can add further metadata by using the <code>docvars</code> function. The code below shows how to add the number of speakers to the <code>ofsted_corpus</code> object. Note that you must define a vector with the same number of items in it as there are documents in your corpus:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Adding metadata to the corpus</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">docvars</span>(ofsted_corpus, <span class="st">"urn"</span>) <span class="ot">&lt;-</span> ofsted_london<span class="sc">$</span>urn</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="fu">summary</span>(ofsted_corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 18800 documents, showing 100 documents:

  Text Types Tokens Sentences type grade phase_of_education_name         urn
 text1  1895  10041       431 full other                 Primary URN: 100000
 [ reached 'max' / getOption("max.print") -- omitted 99 rows ]</code></pre>
</div>
</div>
<p>To view an individual corpus text you can use the <code>as.character</code> function. This will show you the text in the corpus object. Be careful, this can produce a long output! Note the <code>\n</code> in the text, this is a newline character.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># gives the text of the third document</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="fu">as.character</span>(ofsted_corpus[<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to filter the corpus, you can use the <code>corpus_subset</code> function. This function allows you to filter the corpus object based on the metadata you have added. The code below shows how to filter the <code>ofsted_corpus</code> object to only include schools grade “satisfactory”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Creating a new corpus which contain good schools </span></span>
<span id="cb25-2"><a href="#cb25-2"></a>ofsted_corpus_good <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(ofsted_corpus, grade <span class="sc">==</span> <span class="st">"good"</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="fu">summary</span>(ofsted_corpus_good)</span>
<span id="cb25-4"><a href="#cb25-4"></a></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="co"># We can also extract the docvars from the corpus object, this is useful for getting the metadata about the corpus</span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="fu">docvars</span>(ofsted_corpus, <span class="st">"grade"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="tokenising-the-corpus" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="tokenising-the-corpus">
<span class="header-section-number">2.2</span> Tokenising the corpus</h2>
<p>Now we have a corpus object we need to define the <code>tokens</code> that we are going to be studying. Tokens are units of analysis, for corpora we generally use words as tokens, but you can also use phrases, punctuation or sentences. The <code>quanteda</code> package provides the <code>tokens()</code> function to convert a corpus object into a tokens object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>ofsted_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(ofsted_corpus, </span>
<span id="cb26-2"><a href="#cb26-2"></a>                        <span class="at">what=</span><span class="st">"word"</span>,</span>
<span id="cb26-3"><a href="#cb26-3"></a>                        <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-4"><a href="#cb26-4"></a>                        <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-5"><a href="#cb26-5"></a>                        <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-6"><a href="#cb26-6"></a>ofsted_tokens</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tokens consisting of 18,800 documents and 4 docvars.
text1 :
 [1] "INSPECTION" "REPORT"     "SIR"        "JOHN"       "CASS’S"    
 [6] "FOUNDATION" "PRIMARY"    "SCHOOL"     "City"       "of"        
[11] "London"     "LEA"       
[ ... and 8,606 more ]

text2 :
 [1] "Sir"        "John"       "Cass's"     "Foundation" "Primary"   
 [6] "School"     "Inspection" "report"     "Unique"     "Reference" 
[11] "Number"     "Local"     
[ ... and 1,403 more ]

text3 :
 [1] "Sir"        "John"       "Cass's"     "Foundation" "Primary"   
 [6] "School"     "Inspection" "report"     "Unique"     "Reference" 
[11] "Number"     "Local"     
[ ... and 2,544 more ]

text4 :
 [1] "School"     "report"     "Sir"        "John"       "Cass's"    
 [6] "Foundation" "Primary"    "School"     "St"         "James’s"   
[11] "Passage"    "Duke’s"    
[ ... and 3,052 more ]

text5 :
 [1] "School"     "report"     "Inspection" "of"         "The"       
 [6] "Aldgate"    "School"     "St"         "James's"    "Passage"   
[11] "Duke's"     "Place"     
[ ... and 1,762 more ]

text6 :
 [1] "INSPECTION" "REPORT"     "AGINCOURT"  "HOUSE"      "PUPIL"     
 [6] "REFERRAL"   "UNIT"       "LONDON"     "LEA"        "area"      
[11] "London"     "Borough"   
[ ... and 8,693 more ]

[ reached max_ndoc ... 18,794 more documents ]</code></pre>
</div>
</div>
<p>You can see that each document is now a vector of words, these are the tokens.</p>
<p>We can now start to interrogate these tokens using the <code>kwic</code> - key words in context - function. This allows you to search for a word or phrase in the corpus and see the context in which it appears.</p>
<p>The code below shows how to use the <code>kwic</code> function to search for the word “teacher” in the <code>ofsted_tokens</code> object. The <code>pattern</code> argument is used to specify the word or phrase you want to search for and ou can use the <code>window=</code> argument to set how many tokens either side of the keyword you want to see. Here we have set the window to 5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">kwic</span>(ofsted_tokens, <span class="at">pattern =</span> <span class="st">"shakespspeare"</span>, <span class="at">window =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keyword-in-context with 0 matches.</code></pre>
</div>
</div>
<p>To see all the matches, you turn the kwic output into a data frame that you can then view:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>kwic_df <span class="ot">&lt;-</span> <span class="fu">kwic</span>(ofsted_tokens, <span class="at">pattern =</span> <span class="st">"shakespspeare"</span>, <span class="at">window =</span> <span class="dv">5</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a>kwic_df <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>kwic</code> command allows patterns that are regular expressions if we add the parameter <code>valuetype = "regex"</code>, for example we might want to look at all tokens that start (<code>^</code>) with the word “shakesp”, e.g.&nbsp;shakespeare, shakesperian, shakesphere(?!), etc. Note: kwic is <code>case_insensitive</code> by default meaning it’ll pick up upper and lower case text.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">kwic</span>(ofsted_tokens, <span class="at">pattern =</span> <span class="st">"^shakesp"</span>, </span>
<span id="cb31-2"><a href="#cb31-2"></a>     <span class="at">valuetype =</span> <span class="st">"regex"</span>, </span>
<span id="cb31-3"><a href="#cb31-3"></a>     <span class="at">window =</span> <span class="dv">5</span>,</span>
<span id="cb31-4"><a href="#cb31-4"></a>     <span class="at">case_insensitive =</span> <span class="cn">TRUE</span>) <span class="co"># set this to FALSE to be case sensitive.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keyword-in-context with 824 matches.                                                               
  [text46, 346]                 help pupils learn and perform |
 [text56, 6341]                       working on a version of |
                                                                       
  Shakespearian   | plays They also deliver training                   
  Shakespeare’s   | Midsummer Night’s Dream and of                     
 [ reached 'max' / getOption("max.print") -- omitted 822 rows ]</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For more information on regular expressions, see the <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html">R documentation</a>.</p>
<p>The following symbols can be useful in</p>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead><tr class="header">
<th>Pattern</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>.</td>
<td>Any single character except a newline</td>
</tr>
<tr class="even">
<td>^</td>
<td>Beginning of String (or Line)</td>
</tr>
<tr class="odd">
<td>$</td>
<td>End of String (or Line)</td>
</tr>
<tr class="even">
<td>[]</td>
<td>A set of characters, e.g., [a-z] for lowercase letters</td>
</tr>
<tr class="odd">
<td>[^]</td>
<td>Negation inside square brackets, e.g., [^a-z] for non-lowercase letters</td>
</tr>
<tr class="even">
<td>()</td>
<td>Grouping (capturing group), used for subpatterns</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td>*</td>
<td>0 or more of the preceding element</td>
</tr>
<tr class="odd">
<td>+</td>
<td>1 or more of the preceding element</td>
</tr>
<tr class="even">
<td>?</td>
<td>0 or 1 of the preceding element (optional)</td>
</tr>
<tr class="odd">
<td>{n}</td>
<td>Exactly n occurrences of the preceding element</td>
</tr>
<tr class="even">
<td>{n,}</td>
<td>n or more occurrences of the preceding element</td>
</tr>
<tr class="odd">
<td>{n,m}</td>
<td>Between n and m occurrences of the preceding element</td>
</tr>
<tr class="even">
<td>b</td>
<td>Word boundary (matches between word and non-word characters)</td>
</tr>
<tr class="odd">
<td>B</td>
<td>Not a word boundary</td>
</tr>
<tr class="even">
<td>A</td>
<td>Beginning of the string (similar to <code>^</code> but anchors the start of the whole string)</td>
</tr>
<tr class="odd">
<td>Z</td>
<td>End of the string (similar to <code>$</code> but anchors the end of the whole string)</td>
</tr>
<tr class="even">
<td>\1, \2, …</td>
<td>Backreference to capturing groups, e.g., \1 refers to the first captured group</td>
</tr>
<tr class="odd">
<td>(?=…)</td>
<td>Positive lookahead (assertion, matches a position only if the pattern inside matches)</td>
</tr>
<tr class="even">
<td>(?!…)</td>
<td>Negative lookahead (assertion, matches a position only if the pattern inside does not match)</td>
</tr>
<tr class="odd">
<td>(?&lt;=…)</td>
<td>Positive lookbehind (matches if preceded by a pattern)</td>
</tr>
<tr class="even">
<td>(?&lt;!…)</td>
<td>Negative lookbehind (matches if not preceded by a pattern)</td>
</tr>
<tr class="odd">
<td>[:alpha:]</td>
<td>Any letter</td>
</tr>
<tr class="even">
<td>[:lower:]</td>
<td>Any lowercase letter</td>
</tr>
<tr class="odd">
<td>[:upper:]</td>
<td>Any uppercase letter</td>
</tr>
<tr class="even">
<td>[:digit:]</td>
<td>Any digit (equivalent to </td>
</tr>
<tr class="odd">
<td>[:alnum:]</td>
<td>Any letter or number</td>
</tr>
<tr class="even">
<td>[:xdigit:]</td>
<td>Any hexadecimal digit</td>
</tr>
<tr class="odd">
<td>[:punct:]</td>
<td>Any punctuation character</td>
</tr>
<tr class="even">
<td>[:graph:]</td>
<td>Any letter, number, or punctuation character</td>
</tr>
<tr class="odd">
<td>[:space:]</td>
<td>A space, a tab, a new line, etc. (equivalent to )</td>
</tr>
</tbody>
</table>
<p>For example: - the regex <code>^mini</code> will match any word that starts with “mini”. - the regex <code>able$</code> will match any word that ends with “able”. - the regex <code>colou?r</code> matches both “color” and “colour”. - the regex <code>[J|j]ane</code> matches both “Jane” and “jane”.</p>
</div>
</div>
<p>Note that you can output the result of <code>kwic</code> search to a data frame and then use ggplot to represent the data. You’ll note that this raises some issues about the cleanliness of the data, as many words are joined on an apostrophe <code>'</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Doing a key word in context search wtih regex and plotting</span></span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a>shakespeare_search <span class="ot">&lt;-</span> <span class="fu">kwic</span>(ofsted_tokens, <span class="at">pattern =</span> <span class="st">"^shakesp"</span>, </span>
<span id="cb33-4"><a href="#cb33-4"></a>                       <span class="at">valuetype =</span> <span class="st">"regex"</span>, </span>
<span id="cb33-5"><a href="#cb33-5"></a>                       <span class="at">window =</span> <span class="dv">5</span>,</span>
<span id="cb33-6"><a href="#cb33-6"></a>                       <span class="at">case_insensitive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-7"><a href="#cb33-7"></a></span>
<span id="cb33-8"><a href="#cb33-8"></a><span class="fu">ggplot</span>(shakespeare_search, <span class="fu">aes</span>(<span class="at">x =</span> keyword, <span class="at">fill =</span> keyword)) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Occurrences of 'shakespeare' in Ofsted corpus"</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12"></a>  <span class="fu">xlab</span>(<span class="st">"keyword"</span>) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb33-14"><a href="#cb33-14"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_ofsted_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># if you're missing the metadata, you can add it back in using the `docvars` function</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>shakespeare_search_meta <span class="ot">&lt;-</span> shakespeare_search <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-5"><a href="#cb34-5"></a>    <span class="at">id =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(docname, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)),</span>
<span id="cb34-6"><a href="#cb34-6"></a>    <span class="at">grade =</span> <span class="fu">docvars</span>(ofsted_tokens, <span class="st">"grade"</span>)[id],</span>
<span id="cb34-7"><a href="#cb34-7"></a>    <span class="at">phase =</span> <span class="fu">docvars</span>(ofsted_tokens, <span class="st">"phase_of_education_name"</span>)[id]</span>
<span id="cb34-8"><a href="#cb34-8"></a>  )</span>
<span id="cb34-9"><a href="#cb34-9"></a></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="fu">ggplot</span>(shakespeare_search_meta, <span class="fu">aes</span>(<span class="at">x =</span> keyword, <span class="at">fill =</span> keyword)) <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Occurrences of 'shakepeare' in Ofsted corpus, by stage"</span>) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14"></a>  <span class="fu">xlab</span>(<span class="st">"keyword"</span>) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17"></a>  <span class="fu">facet_wrap</span>(grade<span class="sc">~</span>., <span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_ofsted_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Sometimes we want to create tokens on a phrase level, as we are interested where words appear together, for example we might be looking for information on “assessment for learning” in schools:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">kwic</span>(ofsted_tokens, <span class="at">pattern =</span> <span class="fu">phrase</span>(<span class="st">"formative assessment"</span>), <span class="at">window =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keyword-in-context with 87 matches.                                                                       
 [text97, 7395:7396]                        Assessment The day to day |
 [text97, 7417:7418]         in appropriately planned future learning |
                                                                     
 formative assessment | for children under the age                   
 Formative assessment | which informs further planning is            
 [ reached 'max' / getOption("max.print") -- omitted 85 rows ]</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>An alternative way to represent where words occur in a text is to use the <code>str_view</code> function from the <code>stringr</code> package, which highlights matches:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb37-2"><a href="#cb37-2"></a></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="co"># Read in lyrics of Bohemain Rhapsody from Github</span></span>
<span id="cb37-4"><a href="#cb37-4"></a></span>
<span id="cb37-5"><a href="#cb37-5"></a>url <span class="ot">&lt;-</span> <span class="st">"https://gist.githubusercontent.com/matematikaadit/3a513cc5fe6ebb9565ee1584e2b4f00d/raw/"</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>file_content <span class="ot">&lt;-</span> <span class="fu">readLines</span>(url)</span>
<span id="cb37-7"><a href="#cb37-7"></a></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="fu">str_view</span>(file_content, <span class="st">"poor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[10] │ I'm just a &lt;poor&gt; boy, I need no sympathy,
[45] │ I'm just a &lt;poor&gt; boy, nobody loves me.
[46] │ He's just a &lt;poor&gt; boy from a &lt;poor&gt; family,</code></pre>
</div>
</div>
</div>
</div>
<section id="questions-2" class="level3" data-number="2.2.1"><h3 data-number="2.2.1" class="anchored" data-anchor-id="questions-2">
<span class="header-section-number">2.2.1</span> Questions</h3>
<div class="question">
<p>Using just the tokens from reports for schools in London [<a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EQRUsQaFFGNImkb881H7VEQBYYyh0GXwN6IMlwnjNO7OVw?e=9thIv9">download</a>]:</p>
<ol type="1">
<li>Make a data frame of the five tokens that come after the token “behaviour” (kwic is case insensitive) in London Ofsted reports</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>behaviour mentions</summary><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>ofsted_london_tokens <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>  <span class="fu">kwic</span>(<span class="at">pattern =</span> <span class="st">"behaviour"</span>, </span>
<span id="cb39-3"><a href="#cb39-3"></a>       <span class="at">valuetype =</span> <span class="st">"regex"</span>, <span class="at">window =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4"></a>  <span class="fu">as.data.frame</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Find all variations of the word improve (improved / improvement / improving) in the London Ofsted corpus</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>improve mentions</summary><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>ofsted_london_tokens <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>  <span class="fu">kwic</span>(<span class="at">pattern =</span> <span class="st">"improv"</span>, </span>
<span id="cb40-3"><a href="#cb40-3"></a>       <span class="at">valuetype =</span> <span class="st">"regex"</span>, <span class="at">window =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4"></a>  <span class="fu">as.data.frame</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Find all sentences that include to age groups like “11–16”</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>age group mentions</summary><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>ofsted_london_tokens <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">kwic</span>(<span class="at">pattern =</span> <span class="st">"11[–]16"</span>, </span>
<span id="cb41-3"><a href="#cb41-3"></a>       <span class="at">valuetype =</span> <span class="st">"regex"</span>, <span class="at">window =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="fu">as.data.frame</span>() </span>
<span id="cb41-5"><a href="#cb41-5"></a></span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="co"># or to match those 'like' this</span></span>
<span id="cb41-7"><a href="#cb41-7"></a>ofsted_london_tokens <span class="sc">%&gt;%</span></span>
<span id="cb41-8"><a href="#cb41-8"></a>  <span class="fu">kwic</span>(<span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">b</span><span class="sc">\\</span><span class="st">d{1,2}[–-]</span><span class="sc">\\</span><span class="st">d{1,2}</span><span class="sc">\\</span><span class="st">b"</span>, </span>
<span id="cb41-9"><a href="#cb41-9"></a>       <span class="at">valuetype =</span> <span class="st">"regex"</span>, <span class="at">window =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-10"><a href="#cb41-10"></a>  <span class="fu">as.data.frame</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Find another word or phrase of interest in the Ofsted corpus, and plot the results</li>
</ol>
</div>
</section></section><section id="word-frequencies" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="word-frequencies">
<span class="header-section-number">2.3</span> Word frequencies</h2>
<p>A common corpus analysis technique is to examine the frequency of words in the corpus. We can do this using a document-feature matrix (DFM), which allows you to see the frequency of words in the corpus. {quanteda} provides the <code>dfm()</code> command to create a dfm object, to use this we pass the tokens object.</p>
<p>Then the <code>featfreq</code> function is used to get the word frequencies. Note you can output the output to a dataframe using <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> which will allow further processing and use with other packages such as <code>ggplot</code> to make graphs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="co"># Create a document-feature matrix (DFM)</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>dfm_london <span class="ot">&lt;-</span> <span class="fu">dfm</span>(ofsted_london_tokens)</span>
<span id="cb42-4"><a href="#cb42-4"></a></span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="co"># Get word frequencies</span></span>
<span id="cb42-6"><a href="#cb42-6"></a>word_frequencies <span class="ot">&lt;-</span> <span class="fu">featfreq</span>(dfm_london)</span>
<span id="cb42-7"><a href="#cb42-7"></a></span>
<span id="cb42-8"><a href="#cb42-8"></a><span class="co"># Convert to dataframe</span></span>
<span id="cb42-9"><a href="#cb42-9"></a>word_frequencies_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(word_frequencies)</span>
<span id="cb42-10"><a href="#cb42-10"></a>word_frequencies_df <span class="sc">%&gt;%</span> </span>
<span id="cb42-11"><a href="#cb42-11"></a>  <span class="fu">mutate</span>(<span class="at">feat =</span> <span class="fu">rownames</span>(word_frequencies_df)) <span class="sc">%&gt;%</span></span>
<span id="cb42-12"><a href="#cb42-12"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-13"><a href="#cb42-13"></a>  <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="gfrrwkeqzx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#gfrrwkeqzx table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#gfrrwkeqzx thead, #gfrrwkeqzx tbody, #gfrrwkeqzx tfoot, #gfrrwkeqzx tr, #gfrrwkeqzx td, #gfrrwkeqzx th {
  border-style: none;
}

#gfrrwkeqzx p {
  margin: 0;
  padding: 0;
}

#gfrrwkeqzx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gfrrwkeqzx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gfrrwkeqzx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gfrrwkeqzx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gfrrwkeqzx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gfrrwkeqzx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gfrrwkeqzx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gfrrwkeqzx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gfrrwkeqzx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gfrrwkeqzx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gfrrwkeqzx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gfrrwkeqzx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gfrrwkeqzx .gt_spanner_row {
  border-bottom-style: hidden;
}

#gfrrwkeqzx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gfrrwkeqzx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gfrrwkeqzx .gt_from_md > :first-child {
  margin-top: 0;
}

#gfrrwkeqzx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gfrrwkeqzx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gfrrwkeqzx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gfrrwkeqzx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gfrrwkeqzx .gt_row_group_first td {
  border-top-width: 2px;
}

#gfrrwkeqzx .gt_row_group_first th {
  border-top-width: 2px;
}

#gfrrwkeqzx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gfrrwkeqzx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gfrrwkeqzx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gfrrwkeqzx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gfrrwkeqzx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gfrrwkeqzx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gfrrwkeqzx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#gfrrwkeqzx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gfrrwkeqzx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gfrrwkeqzx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gfrrwkeqzx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gfrrwkeqzx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gfrrwkeqzx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gfrrwkeqzx .gt_left {
  text-align: left;
}

#gfrrwkeqzx .gt_center {
  text-align: center;
}

#gfrrwkeqzx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gfrrwkeqzx .gt_font_normal {
  font-weight: normal;
}

#gfrrwkeqzx .gt_font_bold {
  font-weight: bold;
}

#gfrrwkeqzx .gt_font_italic {
  font-style: italic;
}

#gfrrwkeqzx .gt_super {
  font-size: 65%;
}

#gfrrwkeqzx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#gfrrwkeqzx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gfrrwkeqzx .gt_indent_1 {
  text-indent: 5px;
}

#gfrrwkeqzx .gt_indent_2 {
  text-indent: 10px;
}

#gfrrwkeqzx .gt_indent_3 {
  text-indent: 15px;
}

#gfrrwkeqzx .gt_indent_4 {
  text-indent: 20px;
}

#gfrrwkeqzx .gt_indent_5 {
  text-indent: 25px;
}

#gfrrwkeqzx .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#gfrrwkeqzx div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings header">
<th id="word_frequencies" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">word_frequencies</th>
<th id="feat" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">feat</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="word_frequencies">455756</td>
<td class="gt_row gt_left" headers="feat">inspection</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="word_frequencies">174792</td>
<td class="gt_row gt_left" headers="feat">report</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="word_frequencies">1246</td>
<td class="gt_row gt_left" headers="feat">sir</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="word_frequencies">5126</td>
<td class="gt_row gt_left" headers="feat">john</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="word_frequencies">106</td>
<td class="gt_row gt_left" headers="feat">cass’s</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="word_frequencies">44115</td>
<td class="gt_row gt_left" headers="feat">foundation</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="word_frequencies">133494</td>
<td class="gt_row gt_left" headers="feat">primary</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="word_frequencies">1300525</td>
<td class="gt_row gt_left" headers="feat">school</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="word_frequencies">2134</td>
<td class="gt_row gt_left" headers="feat">city</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="word_frequencies">2680691</td>
<td class="gt_row gt_left" headers="feat">of</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>A useful feature is to be able to add a grouping variable when doing word counts. For example, we can group by file, using the <code>dfm_group()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">library</span>(quanteda.textstats)</span>
<span id="cb43-2"><a href="#cb43-2"></a></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="co"># get the available document variables</span></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="fu">print</span>(<span class="fu">docvars</span>(ofsted_london_tokens))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     file year month day name urn reports urls closed_link closed_name type
     grade gender phase_of_education_name age sch_type la_name gor_name easting
     northing urban_rural_name number_of_pupils percentage_fsm inspector
 [ reached 'max' / getOption("max.print") -- omitted 18800 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Create a document-feature matrix (DFM) grouped by transcript </span></span>
<span id="cb45-2"><a href="#cb45-2"></a>dfm_london <span class="ot">&lt;-</span> <span class="fu">dfm</span>(ofsted_london_tokens) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">dfm_group</span>(<span class="at">groups =</span> grade)</span>
<span id="cb45-4"><a href="#cb45-4"></a></span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="co"># Get word frequencies with a grouping</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>word_frequencies <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(dfm_london, <span class="at">groups =</span> grade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="cleaning-transcripts" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="cleaning-transcripts">
<span class="header-section-number">2.4</span> Cleaning transcripts</h2>
<p>In some contexts, before analysis, you may want to clean the text. This can involve removing punctuation, numbers, and other non-word characters. As we saw above, the <code>tokens</code> function has a <code>remove_punct</code> argument that can be set to <code>TRUE</code> to remove punctuation. We can also remove words that are frequent but probably not very interesting, such as “i”, “me” , “my”, “myself”, “we”, “our”, “ours”, “ourselves”, “you”, and “your”. These common, high frequency words known as <em>stopwords</em>, and <code>quanteda</code> has a built in dictionary of stopwords for you to remove.</p>
<p>You can see those included by running <code>head(stopwords("en"), 20)</code> the 20 limits the ouput to the first 20 words. Here <code>en</code> specifies you are interested in stopwords in English.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># quanteda's stop words</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="fu">head</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>), <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "i"          "me"         "my"         "myself"     "we"        
 [6] "our"        "ours"       "ourselves"  "you"        "your"      
[11] "yours"      "yourself"   "yourselves" "he"         "him"       
 [ reached getOption("max.print") -- omitted 5 entries ]</code></pre>
</div>
</div>
<p>To remove stopwords, you can use the <code>remove</code> argument in the <code>tokens</code> function: <code>tokens_remove(tokens, stopwords("en"))</code>. The code below shows how to create a new tokens object with stopwords and punctuation removed. Let us compare outputs with and without the removal of stopwords and punctuation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># removing stopwords and punctuation</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>ofsted_tokens_no_stop <span class="ot">&lt;-</span> ofsted_tokens <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>))</span>
<span id="cb48-4"><a href="#cb48-4"></a></span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="co"># Get word frequencies</span></span>
<span id="cb48-6"><a href="#cb48-6"></a><span class="co"># Create a document-feature matrix (DFM)</span></span>
<span id="cb48-7"><a href="#cb48-7"></a>dfm_df_no_stop <span class="ot">&lt;-</span> <span class="fu">dfm</span>(ofsted_tokens_no_stop)</span>
<span id="cb48-8"><a href="#cb48-8"></a></span>
<span id="cb48-9"><a href="#cb48-9"></a><span class="co"># Get word frequencies</span></span>
<span id="cb48-10"><a href="#cb48-10"></a>word_frequencies_no_stop <span class="ot">&lt;-</span> <span class="fu">featfreq</span>(dfm_df_no_stop)</span>
<span id="cb48-11"><a href="#cb48-11"></a></span>
<span id="cb48-12"><a href="#cb48-12"></a><span class="co"># Convert to dataframe</span></span>
<span id="cb48-13"><a href="#cb48-13"></a>word_frequencies_no_stop_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(word_frequencies_no_stop)</span>
<span id="cb48-14"><a href="#cb48-14"></a>word_frequencies_no_stop_df <span class="sc">%&gt;%</span> </span>
<span id="cb48-15"><a href="#cb48-15"></a>  <span class="fu">mutate</span>(<span class="at">feat =</span> <span class="fu">rownames</span>(word_frequencies_no_stop_df)) <span class="sc">%&gt;%</span></span>
<span id="cb48-16"><a href="#cb48-16"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="uqbyzvphhz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#uqbyzvphhz table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#uqbyzvphhz thead, #uqbyzvphhz tbody, #uqbyzvphhz tfoot, #uqbyzvphhz tr, #uqbyzvphhz td, #uqbyzvphhz th {
  border-style: none;
}

#uqbyzvphhz p {
  margin: 0;
  padding: 0;
}

#uqbyzvphhz .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#uqbyzvphhz .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#uqbyzvphhz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uqbyzvphhz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uqbyzvphhz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uqbyzvphhz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uqbyzvphhz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uqbyzvphhz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uqbyzvphhz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uqbyzvphhz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uqbyzvphhz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uqbyzvphhz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uqbyzvphhz .gt_spanner_row {
  border-bottom-style: hidden;
}

#uqbyzvphhz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#uqbyzvphhz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uqbyzvphhz .gt_from_md > :first-child {
  margin-top: 0;
}

#uqbyzvphhz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uqbyzvphhz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uqbyzvphhz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#uqbyzvphhz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#uqbyzvphhz .gt_row_group_first td {
  border-top-width: 2px;
}

#uqbyzvphhz .gt_row_group_first th {
  border-top-width: 2px;
}

#uqbyzvphhz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uqbyzvphhz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#uqbyzvphhz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#uqbyzvphhz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uqbyzvphhz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uqbyzvphhz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uqbyzvphhz .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#uqbyzvphhz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#uqbyzvphhz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uqbyzvphhz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uqbyzvphhz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uqbyzvphhz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uqbyzvphhz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uqbyzvphhz .gt_left {
  text-align: left;
}

#uqbyzvphhz .gt_center {
  text-align: center;
}

#uqbyzvphhz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uqbyzvphhz .gt_font_normal {
  font-weight: normal;
}

#uqbyzvphhz .gt_font_bold {
  font-weight: bold;
}

#uqbyzvphhz .gt_font_italic {
  font-style: italic;
}

#uqbyzvphhz .gt_super {
  font-size: 65%;
}

#uqbyzvphhz .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#uqbyzvphhz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#uqbyzvphhz .gt_indent_1 {
  text-indent: 5px;
}

#uqbyzvphhz .gt_indent_2 {
  text-indent: 10px;
}

#uqbyzvphhz .gt_indent_3 {
  text-indent: 15px;
}

#uqbyzvphhz .gt_indent_4 {
  text-indent: 20px;
}

#uqbyzvphhz .gt_indent_5 {
  text-indent: 25px;
}

#uqbyzvphhz .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#uqbyzvphhz div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings header">
<th id="word_frequencies_no_stop" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">word_frequencies_no_stop</th>
<th id="feat" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">feat</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="word_frequencies_no_stop">455756</td>
<td class="gt_row gt_left" headers="feat">inspection</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="word_frequencies_no_stop">174792</td>
<td class="gt_row gt_left" headers="feat">report</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="word_frequencies_no_stop">1246</td>
<td class="gt_row gt_left" headers="feat">sir</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="word_frequencies_no_stop">5126</td>
<td class="gt_row gt_left" headers="feat">john</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="word_frequencies_no_stop">106</td>
<td class="gt_row gt_left" headers="feat">cass’s</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="word_frequencies_no_stop">44115</td>
<td class="gt_row gt_left" headers="feat">foundation</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="word_frequencies_no_stop">133494</td>
<td class="gt_row gt_left" headers="feat">primary</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="word_frequencies_no_stop">1300525</td>
<td class="gt_row gt_left" headers="feat">school</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="word_frequencies_no_stop">2134</td>
<td class="gt_row gt_left" headers="feat">city</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="word_frequencies_no_stop">33570</td>
<td class="gt_row gt_left" headers="feat">london</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can compare the results of the two word frequency lists to see the impact of removing stopwords.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># graphs of frequencies before and after removing stopwords</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>word_frequencies_df_top <span class="ot">&lt;-</span> word_frequencies_df <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3"></a>  <span class="fu">mutate</span>(<span class="at">feat =</span> <span class="fu">rownames</span>(word_frequencies_df)) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(word_frequencies)) <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb49-6"><a href="#cb49-6"></a></span>
<span id="cb49-7"><a href="#cb49-7"></a><span class="fu">ggplot</span>(word_frequencies_df_top, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feat, <span class="sc">-</span> word_frequencies), <span class="at">y =</span> word_frequencies, <span class="at">fill =</span> feat)) <span class="sc">+</span></span>
<span id="cb49-8"><a href="#cb49-8"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb49-10"><a href="#cb49-10"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 word frequencies before removing stopwords"</span>) <span class="sc">+</span></span>
<span id="cb49-11"><a href="#cb49-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Word"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)<span class="sc">+</span></span>
<span id="cb49-12"><a href="#cb49-12"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb49-13"><a href="#cb49-13"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_ofsted_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>word_frequencies_no_stop_df_top <span class="ot">&lt;-</span> word_frequencies_no_stop_df <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>  <span class="fu">mutate</span>(<span class="at">feat =</span> <span class="fu">rownames</span>(word_frequencies_no_stop_df)) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(word_frequencies_no_stop_df)) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb50-5"><a href="#cb50-5"></a></span>
<span id="cb50-6"><a href="#cb50-6"></a><span class="fu">ggplot</span>(word_frequencies_no_stop_df_top, </span>
<span id="cb50-7"><a href="#cb50-7"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feat, <span class="sc">-</span> word_frequencies_no_stop), </span>
<span id="cb50-8"><a href="#cb50-8"></a>           <span class="at">y =</span> word_frequencies_no_stop, <span class="at">fill =</span> feat)) <span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb50-10"><a href="#cb50-10"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb50-11"><a href="#cb50-11"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 word frequencies after removing stopwords and punctuation"</span>) <span class="sc">+</span></span>
<span id="cb50-12"><a href="#cb50-12"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Word"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb50-13"><a href="#cb50-13"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb50-14"><a href="#cb50-14"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_ofsted_files/figure-html/unnamed-chunk-39-2.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>The built in functions for removing punctuation and stop words are not always ideal. You may want to create your own list of words to remove or use a different method to remove them. You can also use the <code>tokens</code> function with the <code>remove</code> argument to remove specific words. The code below shows how to remove the word “teacher” (and others) from the <code>ofsted_tokens</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># custom removal of words</span></span>
<span id="cb51-2"><a href="#cb51-2"></a></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="co"># Create a custom list of stop words</span></span>
<span id="cb51-4"><a href="#cb51-4"></a>custom_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cass"</span>, <span class="st">"cass's"</span>, <span class="st">"teachers"</span>, <span class="st">"teacher"</span>, </span>
<span id="cb51-5"><a href="#cb51-5"></a>                      <span class="st">"year"</span>, <span class="st">"inspection"</span>, <span class="st">"john"</span>, <span class="st">"school"</span>)</span>
<span id="cb51-6"><a href="#cb51-6"></a></span>
<span id="cb51-7"><a href="#cb51-7"></a>ofsted_tokens_no_stop <span class="ot">&lt;-</span> ofsted_tokens <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="#cb51-8"></a>  <span class="fu">tokens</span>(<span class="at">remove_punct =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-9"><a href="#cb51-9"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-10"><a href="#cb51-10"></a>  <span class="fu">tokens_remove</span>(custom_stopwords)</span>
<span id="cb51-11"><a href="#cb51-11"></a></span>
<span id="cb51-12"><a href="#cb51-12"></a><span class="co"># Create a document-feature matrix (DFM)</span></span>
<span id="cb51-13"><a href="#cb51-13"></a>dfm_no_stop <span class="ot">&lt;-</span> <span class="fu">dfm</span>(ofsted_tokens_no_stop)</span>
<span id="cb51-14"><a href="#cb51-14"></a></span>
<span id="cb51-15"><a href="#cb51-15"></a><span class="co"># Get word frequencies</span></span>
<span id="cb51-16"><a href="#cb51-16"></a>word_frequencies_no_stop <span class="ot">&lt;-</span> <span class="fu">featfreq</span>(dfm_no_stop)</span>
<span id="cb51-17"><a href="#cb51-17"></a></span>
<span id="cb51-18"><a href="#cb51-18"></a><span class="co"># Convert to data frame</span></span>
<span id="cb51-19"><a href="#cb51-19"></a>word_frequencies_no_stop_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(word_frequencies_no_stop) <span class="sc">%&gt;%</span></span>
<span id="cb51-20"><a href="#cb51-20"></a>  <span class="fu">mutate</span>(<span class="at">feat =</span> <span class="fu">names</span>(word_frequencies_no_stop)) </span>
<span id="cb51-21"><a href="#cb51-21"></a></span>
<span id="cb51-22"><a href="#cb51-22"></a><span class="fu">ggplot</span>(word_frequencies_no_stop_df <span class="sc">%&gt;%</span></span>
<span id="cb51-23"><a href="#cb51-23"></a>           <span class="fu">arrange</span>(<span class="fu">desc</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb51-24"><a href="#cb51-24"></a>           <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>), </span>
<span id="cb51-25"><a href="#cb51-25"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feat, value), </span>
<span id="cb51-26"><a href="#cb51-26"></a>           <span class="at">y =</span> value, </span>
<span id="cb51-27"><a href="#cb51-27"></a>           <span class="at">fill =</span> feat)) <span class="sc">+</span></span>
<span id="cb51-28"><a href="#cb51-28"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb51-29"><a href="#cb51-29"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb51-30"><a href="#cb51-30"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 word frequencies after removing stopwords and punctuation"</span>) <span class="sc">+</span></span>
<span id="cb51-31"><a href="#cb51-31"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Word"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb51-32"><a href="#cb51-32"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb51-33"><a href="#cb51-33"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_ofsted_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<section id="creating-a-custom-dictionary" class="level3" data-number="2.4.1"><h3 data-number="2.4.1" class="anchored" data-anchor-id="creating-a-custom-dictionary">
<span class="header-section-number">2.4.1</span> Creating a custom dictionary</h3>
<p>We have seen how to search for a single word or phrase in the corpus. You may want to search for multiple words or phrases at once. This can be done using a dictionary. A dictionary is a list of words or phrases that you want to search for in the corpus. The code below shows how to create a dictionary object using the <code>dictionary</code> function. The <code>dictionary</code> function takes a list of words or phrases as input. You can use the dictionary when making a <code>dfm</code> to create word counts</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># Setting up a dictionary to search for</span></span>
<span id="cb52-2"><a href="#cb52-2"></a></span>
<span id="cb52-3"><a href="#cb52-3"></a>dict <span class="ot">&lt;-</span> <span class="fu">dictionary</span>(<span class="fu">list</span>(<span class="at">subject =</span> <span class="fu">c</span>(<span class="st">"mathematics"</span>, <span class="st">"science"</span>, <span class="st">"history"</span>, <span class="st">"geography"</span>),</span>
<span id="cb52-4"><a href="#cb52-4"></a>                        <span class="at">parents =</span> <span class="fu">c</span>(<span class="st">"mother"</span>, <span class="st">"father"</span>, <span class="st">"dad"</span>, <span class="st">"mum"</span>)))</span>
<span id="cb52-5"><a href="#cb52-5"></a></span>
<span id="cb52-6"><a href="#cb52-6"></a><span class="co"># searching for a phrase</span></span>
<span id="cb52-7"><a href="#cb52-7"></a></span>
<span id="cb52-8"><a href="#cb52-8"></a><span class="co"># Create a document-feature matrix (DFM) using the dictionary to search for words</span></span>
<span id="cb52-9"><a href="#cb52-9"></a></span>
<span id="cb52-10"><a href="#cb52-10"></a>dfm_dict_search <span class="ot">&lt;-</span> ofsted_tokens_no_stop <span class="sc">%&gt;%</span></span>
<span id="cb52-11"><a href="#cb52-11"></a>       <span class="fu">tokens_lookup</span>(<span class="at">dictionary =</span> dict) <span class="sc">%&gt;%</span></span>
<span id="cb52-12"><a href="#cb52-12"></a>      <span class="fu">dfm</span>()</span>
<span id="cb52-13"><a href="#cb52-13"></a></span>
<span id="cb52-14"><a href="#cb52-14"></a><span class="co"># display the dfm</span></span>
<span id="cb52-15"><a href="#cb52-15"></a><span class="fu">featfreq</span>(dfm_dict_search)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>subject parents 
 245155    1256 </code></pre>
</div>
</div>
</section><section id="questions-3" class="level3" data-number="2.4.2"><h3 data-number="2.4.2" class="anchored" data-anchor-id="questions-3">
<span class="header-section-number">2.4.2</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Remove the stopwords from the London corpus, and remove the custom stopwords: “London”, “City”, “School”. Create a DFM and display the most common words:</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>custom stop words</summary><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>ofsted_london_tokens_no_stop <span class="ot">&lt;-</span> ofsted_london_tokens <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>  <span class="fu">tokens</span>(<span class="at">remove_punct =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4"></a>  <span class="fu">tokens_remove</span>(<span class="fu">c</span>(<span class="st">"London"</span>, <span class="st">"City"</span>, <span class="st">"school"</span>))</span>
<span id="cb54-5"><a href="#cb54-5"></a></span>
<span id="cb54-6"><a href="#cb54-6"></a>dfm_london_no_stop <span class="ot">&lt;-</span> <span class="fu">dfm</span>(ofsted_london_tokens_no_stop)</span>
<span id="cb54-7"><a href="#cb54-7"></a>word_frequencies_london_no_stop <span class="ot">&lt;-</span> <span class="fu">featfreq</span>(dfm_london_no_stop)</span>
<span id="cb54-8"><a href="#cb54-8"></a>word_frequencies_london_no_stop_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(word_frequencies_london_no_stop) <span class="sc">%&gt;%</span></span>
<span id="cb54-9"><a href="#cb54-9"></a>  <span class="fu">mutate</span>(<span class="at">feat =</span> <span class="fu">names</span>(word_frequencies_london_no_stop)) <span class="sc">%&gt;%</span></span>
<span id="cb54-10"><a href="#cb54-10"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>How do the frequency of words differ between Primary and Secondary schools? HINT: use <code>bind_rows(prim_top, second_top)</code> to combine the two data frames.</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>primary vs secondary</summary><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>ofsted_london_tokens_no_stop <span class="ot">&lt;-</span> ofsted_london_tokens <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>  <span class="fu">tokens</span>(<span class="at">remove_punct =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4"></a>  <span class="fu">tokens_remove</span>(<span class="fu">c</span>(<span class="st">"London"</span>, <span class="st">"City"</span>, <span class="st">"school"</span>))</span>
<span id="cb55-5"><a href="#cb55-5"></a></span>
<span id="cb55-6"><a href="#cb55-6"></a>dfm_london_no_stop <span class="ot">&lt;-</span> <span class="fu">dfm</span>(ofsted_london_tokens_no_stop) <span class="sc">%&gt;%</span></span>
<span id="cb55-7"><a href="#cb55-7"></a>  <span class="fu">dfm_group</span>(<span class="at">groups =</span> phase_of_education_name)</span>
<span id="cb55-8"><a href="#cb55-8"></a></span>
<span id="cb55-9"><a href="#cb55-9"></a>word_frequencies_london_no_stop_df <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(dfm_london_no_stop, <span class="at">groups =</span> phase_of_education_name)</span>
<span id="cb55-10"><a href="#cb55-10"></a></span>
<span id="cb55-11"><a href="#cb55-11"></a>prim_top <span class="ot">&lt;-</span> word_frequencies_london_no_stop_df <span class="sc">%&gt;%</span> </span>
<span id="cb55-12"><a href="#cb55-12"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"Primary"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-13"><a href="#cb55-13"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(frequency)) <span class="sc">%&gt;%</span></span>
<span id="cb55-14"><a href="#cb55-14"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb55-15"><a href="#cb55-15"></a></span>
<span id="cb55-16"><a href="#cb55-16"></a>second_top <span class="ot">&lt;-</span>  word_frequencies_london_no_stop_df <span class="sc">%&gt;%</span> </span>
<span id="cb55-17"><a href="#cb55-17"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"Secondary"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-18"><a href="#cb55-18"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(frequency)) <span class="sc">%&gt;%</span></span>
<span id="cb55-19"><a href="#cb55-19"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb55-20"><a href="#cb55-20"></a></span>
<span id="cb55-21"><a href="#cb55-21"></a>word_frequencies <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(prim_top, second_top)</span>
<span id="cb55-22"><a href="#cb55-22"></a></span>
<span id="cb55-23"><a href="#cb55-23"></a>word_frequencies <span class="sc">%&gt;%</span></span>
<span id="cb55-24"><a href="#cb55-24"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> feature,</span>
<span id="cb55-25"><a href="#cb55-25"></a>             <span class="at">y =</span> frequency, </span>
<span id="cb55-26"><a href="#cb55-26"></a>             <span class="at">fill =</span> group)) <span class="sc">+</span></span>
<span id="cb55-27"><a href="#cb55-27"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position=</span><span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb55-28"><a href="#cb55-28"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb55-29"><a href="#cb55-29"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 word frequencies in London schools"</span>) <span class="sc">+</span></span>
<span id="cb55-30"><a href="#cb55-30"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Word"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb55-31"><a href="#cb55-31"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb55-32"><a href="#cb55-32"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Create a dictionary to search for the environmental terms: “climate change”, “global warming”, “sustainability”, “carbon footprint”, “renewable energy”, “pollution”. Use this dictionary to create a DFM and display the word frequencies.</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>environmental terms</summary><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>ofsted_london_tokens_no_stop <span class="ot">&lt;-</span> ofsted_london_tokens <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>  <span class="fu">tokens</span>(<span class="at">remove_punct =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4"></a>  <span class="fu">tokens_remove</span>(<span class="fu">c</span>(<span class="st">"London"</span>, <span class="st">"City"</span>, <span class="st">"school"</span>))</span>
<span id="cb56-5"><a href="#cb56-5"></a></span>
<span id="cb56-6"><a href="#cb56-6"></a>dict_env <span class="ot">&lt;-</span> <span class="fu">dictionary</span>(<span class="fu">list</span>(<span class="at">environment =</span> <span class="fu">c</span>(<span class="st">"climate change"</span>, <span class="st">"global</span></span>
<span id="cb56-7"><a href="#cb56-7"></a><span class="st">                                            warming"</span>, <span class="st">"sustainability"</span>, </span>
<span id="cb56-8"><a href="#cb56-8"></a>                                            <span class="st">"carbon footprint"</span>, </span>
<span id="cb56-9"><a href="#cb56-9"></a>                                            <span class="st">"renewable energy"</span>,</span>
<span id="cb56-10"><a href="#cb56-10"></a>                                            <span class="st">"pollution"</span>)))</span>
<span id="cb56-11"><a href="#cb56-11"></a></span>
<span id="cb56-12"><a href="#cb56-12"></a>dfm_env <span class="ot">&lt;-</span> ofsted_london_tokens_no_stop <span class="sc">%&gt;%</span></span>
<span id="cb56-13"><a href="#cb56-13"></a>  <span class="fu">tokens_lookup</span>(<span class="at">dictionary =</span> dict_env) <span class="sc">%&gt;%</span></span>
<span id="cb56-14"><a href="#cb56-14"></a>  <span class="fu">dfm</span>()</span>
<span id="cb56-15"><a href="#cb56-15"></a></span>
<span id="cb56-16"><a href="#cb56-16"></a><span class="fu">featfreq</span>(dfm_env)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Come up with your own dictionary of words or phrases that you are interested in, and use it to create a DFM and display the word frequencies.</li>
</ol>
</div>
</section></section><section id="words-that-co-occur" class="level2" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="words-that-co-occur">
<span class="header-section-number">2.5</span> Words that co-occur</h2>
</section><section id="word-clouds" class="level2" data-number="2.6"><h2 data-number="2.6" class="anchored" data-anchor-id="word-clouds">
<span class="header-section-number">2.6</span> Word clouds</h2>
<p>A common way to visualise word frequencies is to use a word cloud. A word cloud is a visual representation of text data, where the size of each word indicates its frequency in the text. The <code>quanteda.textplots</code> package can be used to create word clouds in R.</p>
<p>The code below shows how to create a word cloud from the object. The <code>text_plotwordcloud</code> function is used to create the word cloud from a ‘dfm’ object. The <code>dim.trim</code> function is used to set the minimum frequency of words to include in the word cloud. If low frequencies words are left in, the word cloud is hard to read. The <code>min_termfreq</code> argument is used to set the minimum frequency of words to include in the word cloud (our corpus has thousands of words, so setting this to 100 will get the most commons ones). The <code>textplot_wordcloud</code> function is used to create the word cloud.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="co"># Get word frequencies</span></span>
<span id="cb57-4"><a href="#cb57-4"></a></span>
<span id="cb57-5"><a href="#cb57-5"></a><span class="co"># Create a document-feature matrix (DFM)</span></span>
<span id="cb57-6"><a href="#cb57-6"></a><span class="co"># Trim to remove low frequency words</span></span>
<span id="cb57-7"><a href="#cb57-7"></a></span>
<span id="cb57-8"><a href="#cb57-8"></a>dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(ofsted_tokens_no_stop) <span class="sc">%&gt;%</span></span>
<span id="cb57-9"><a href="#cb57-9"></a>    <span class="fu">dfm_trim</span>(<span class="at">min_termfreq =</span> <span class="dv">100</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb57-10"><a href="#cb57-10"></a></span>
<span id="cb57-11"><a href="#cb57-11"></a><span class="co"># Create a word cloud</span></span>
<span id="cb57-12"><a href="#cb57-12"></a></span>
<span id="cb57-13"><a href="#cb57-13"></a><span class="fu">textplot_wordcloud</span>(dfm) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_ofsted_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>The argument <code>color</code>can be use to set a colour gradient by frequency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># Create a word cloud comparing texts</span></span>
<span id="cb58-2"><a href="#cb58-2"></a> </span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="fu">textplot_wordcloud</span>(dfm, <span class="at">color =</span><span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"skyblue"</span>, <span class="st">"blue"</span>, <span class="st">"darkblue"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_ofsted_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>The <code>textplot_wordcloud()</code> function has an argument to produce comparative plots by text, by setting the <code>comparison</code> argument to true. We also need to limit the number of documents being compared to a maximum of 8.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># Create a word cloud comparing texts</span></span>
<span id="cb59-2"><a href="#cb59-2"></a> <span class="fu">textplot_wordcloud</span>(dfm[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,], <span class="at">comparison =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_ofsted_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<section id="questions-4" class="level3" data-number="2.6.1"><h3 data-number="2.6.1" class="anchored" data-anchor-id="questions-4">
<span class="header-section-number">2.6.1</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Create a word cloud of the words in the Ofsted corpus of <em>outstanding</em> schools - use a minimum count of 200. HINT: start from the beginning of the chapter and <code>filter</code> the <code>ofsted_london</code> data to only include outstanding schools, you then need to turn this into a corpus object, then a tokens object, and finally a dfm object:</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>outstanding word cloud</summary><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>outstanding_data <span class="ot">&lt;-</span> ofsted_london <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>  <span class="fu">filter</span>(grade <span class="sc">==</span> <span class="st">"outstanding"</span>)</span>
<span id="cb60-3"><a href="#cb60-3"></a></span>
<span id="cb60-4"><a href="#cb60-4"></a></span>
<span id="cb60-5"><a href="#cb60-5"></a>outstanding_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(outstanding_data <span class="sc">%&gt;%</span> </span>
<span id="cb60-6"><a href="#cb60-6"></a>                          <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-7"><a href="#cb60-7"></a>                          <span class="fu">select</span>(text, type, grade, phase_of_education_name))</span>
<span id="cb60-8"><a href="#cb60-8"></a></span>
<span id="cb60-9"><a href="#cb60-9"></a>outstanding_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(outstanding_corpus,</span>
<span id="cb60-10"><a href="#cb60-10"></a>                        <span class="at">what=</span><span class="st">"word"</span>,</span>
<span id="cb60-11"><a href="#cb60-11"></a>                        <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb60-12"><a href="#cb60-12"></a>                        <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb60-13"><a href="#cb60-13"></a>                        <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-14"><a href="#cb60-14"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>))</span>
<span id="cb60-15"><a href="#cb60-15"></a></span>
<span id="cb60-16"><a href="#cb60-16"></a>dfm_outstanding <span class="ot">&lt;-</span> <span class="fu">dfm</span>(outstanding_tokens) </span>
<span id="cb60-17"><a href="#cb60-17"></a></span>
<span id="cb60-18"><a href="#cb60-18"></a><span class="fu">textplot_wordcloud</span>(dfm_outstanding, <span class="at">min_count =</span> <span class="dv">200</span>, <span class="at">comparison =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Make word clouds comparing the text for outstanding, good and requires improvement schools - use a minimum count of 200. HINT: you can <code>dfm_group</code> to group the dfm by grade, then use the <code>textplot_wordcloud</code> function to create a comparative word cloud on this grouped dfm object.</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>grouped word cloud</summary><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>outstanding_data <span class="ot">&lt;-</span> ofsted_london <span class="sc">%&gt;%</span>   <span class="co"># filter for the three grades</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>  <span class="fu">filter</span>(grade <span class="sc">==</span> <span class="st">"outstanding"</span> <span class="sc">|</span> grade <span class="sc">==</span>  <span class="st">"good"</span> <span class="sc">|</span> grade <span class="sc">==</span> <span class="st">"requires improvement"</span>)</span>
<span id="cb61-3"><a href="#cb61-3"></a></span>
<span id="cb61-4"><a href="#cb61-4"></a></span>
<span id="cb61-5"><a href="#cb61-5"></a>outstanding_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(outstanding_data <span class="sc">%&gt;%</span>     <span class="co"># create a corpus</span></span>
<span id="cb61-6"><a href="#cb61-6"></a>                          <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-7"><a href="#cb61-7"></a>                          <span class="fu">select</span>(text, type, grade, phase_of_education_name))</span>
<span id="cb61-8"><a href="#cb61-8"></a></span>
<span id="cb61-9"><a href="#cb61-9"></a>outstanding_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(outstanding_corpus,     <span class="co"># tokenize and remove stopwords</span></span>
<span id="cb61-10"><a href="#cb61-10"></a>                        <span class="at">what=</span><span class="st">"word"</span>,</span>
<span id="cb61-11"><a href="#cb61-11"></a>                        <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-12"><a href="#cb61-12"></a>                        <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-13"><a href="#cb61-13"></a>                        <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-14"><a href="#cb61-14"></a>    <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>))</span>
<span id="cb61-15"><a href="#cb61-15"></a></span>
<span id="cb61-16"><a href="#cb61-16"></a>dfm_groups <span class="ot">&lt;-</span> <span class="fu">dfm</span>(outstanding_tokens) <span class="sc">%&gt;%</span></span>
<span id="cb61-17"><a href="#cb61-17"></a>  <span class="fu">dfm_group</span>(<span class="at">groups =</span> <span class="fu">docvars</span>(outstanding_corpus, <span class="st">"grade"</span>))  <span class="co"># group by grade</span></span>
<span id="cb61-18"><a href="#cb61-18"></a>  </span>
<span id="cb61-19"><a href="#cb61-19"></a></span>
<span id="cb61-20"><a href="#cb61-20"></a><span class="fu">textplot_wordcloud</span>(dfm_groups,    <span class="co"># plot</span></span>
<span id="cb61-21"><a href="#cb61-21"></a>                   <span class="at">min_count =</span> <span class="dv">200</span>, </span>
<span id="cb61-22"><a href="#cb61-22"></a>                   <span class="at">comparison =</span> <span class="cn">TRUE</span>, </span>
<span id="cb61-23"><a href="#cb61-23"></a>                   <span class="at">max_words =</span> <span class="dv">100</span>,</span>
<span id="cb61-24"><a href="#cb61-24"></a>                   <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>, <span class="st">"royalblue"</span>, <span class="st">"firebrick"</span>)) </span>
<span id="cb61-25"><a href="#cb61-25"></a>                    <span class="co"># specify the colours of three grades</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section></section><section id="sentiment-analysis" class="level2" data-number="2.7"><h2 data-number="2.7" class="anchored" data-anchor-id="sentiment-analysis">
<span class="header-section-number">2.7</span> Sentiment analysis</h2>
<p>Sentiment analysis is a way to determine the emotional tone behind a series of words. The <code>syuzhet</code> package can be used to perform sentiment analysis in R. The package uses a dictionary-based approach to sentiment analysis. Words are assigned a score based on their emotional valence, with positive words having a positive score and negative words having a negative score. The scores are then aggregated to give an overall measure of the emotional tone of the text.</p>
<p>The package uses the <a href="https://saifmohammad.com/WebPages/NRC-Emotion-Lexicon.htm">NRC lexicon</a> a list of words and their associations with eight emotions (emotions (anger, fear, anticipation, trust, surprise, sadness, joy, and disgust) and two sentiments (negative and positive). The categorisations were achieved through a crowd sourcing process. You can see some of the categorisations below:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     lang           word sentiment value
1 english           abba  positive     1
2 english        ability  positive     1
3 english abovementioned  positive     1
 [ reached 'max' / getOption("max.print") -- omitted 7 rows ]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     lang        word sentiment value
1 english     abandon  negative     1
2 english   abandoned  negative     1
3 english abandonment  negative     1
 [ reached 'max' / getOption("max.print") -- omitted 7 rows ]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     lang       word sentiment value
1 english aberration   disgust     1
2 english      abhor   disgust     1
3 english  abhorrent   disgust     1
 [ reached 'max' / getOption("max.print") -- omitted 7 rows ]</code></pre>
</div>
</div>
<p>The code below shows how to perform sentiment analysis on the text of a selected Ofsted <a href="https://files.ofsted.gov.uk/v1/file/967877">report</a>. The <code>get_sentiment</code> function is used to perform sentiment analysis. The <code>method</code> argument is used to set the method of sentiment analysis to use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="co"># load text for target school</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>text <span class="ot">&lt;-</span> ofsted_london <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3"></a>  <span class="fu">filter</span>(urls <span class="sc">==</span> <span class="st">"https://files.ofsted.gov.uk/v1/file/967877"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4"></a>  <span class="fu">pull</span>(text)</span>
<span id="cb65-5"><a href="#cb65-5"></a></span>
<span id="cb65-6"><a href="#cb65-6"></a><span class="co"># break the text into sentences to give units for analysis</span></span>
<span id="cb65-7"><a href="#cb65-7"></a>sentences <span class="ot">&lt;-</span> <span class="fu">get_sentences</span>(text)</span>
<span id="cb65-8"><a href="#cb65-8"></a></span>
<span id="cb65-9"><a href="#cb65-9"></a><span class="co"># Perform sentiment analysis</span></span>
<span id="cb65-10"><a href="#cb65-10"></a></span>
<span id="cb65-11"><a href="#cb65-11"></a>syuzhet_vector <span class="ot">&lt;-</span> <span class="fu">get_sentiment</span>(sentences, <span class="at">method=</span><span class="st">"syuzhet"</span>)</span>
<span id="cb65-12"><a href="#cb65-12"></a></span>
<span id="cb65-13"><a href="#cb65-13"></a><span class="co"># convert the suzhet vector to a dataframe for more choies in plotting</span></span>
<span id="cb65-14"><a href="#cb65-14"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(syuzhet_vector)</span>
<span id="cb65-15"><a href="#cb65-15"></a></span>
<span id="cb65-16"><a href="#cb65-16"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(syuzhet_vector), <span class="at">y =</span> syuzhet_vector)) <span class="sc">+</span></span>
<span id="cb65-17"><a href="#cb65-17"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">span =</span><span class="fl">0.5</span>) <span class="sc">+</span> <span class="co"># Span here sets the amount of damping on the line</span></span>
<span id="cb65-18"><a href="#cb65-18"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Sentiment analysis of an ofsted report"</span>, <span class="at">x =</span> <span class="st">"Line"</span>, <span class="at">y =</span> <span class="st">"Sentiment"</span>) <span class="sc">+</span></span>
<span id="cb65-19"><a href="#cb65-19"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_ofsted_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># The `plot` function is used to plot the sentiment analysis results.</span></span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="co"># The `type` argument is used to set the type of plot to create.</span></span>
<span id="cb66-3"><a href="#cb66-3"></a><span class="co"># The `main`, `xlab`, and `ylab` arguments are used to set the title and labels of the plot.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="question">
<p>Choose an Ofsted report (or another document) and carry out a sentiment analysis</p>
</div>



</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bokhove2023useful" class="csl-entry" role="listitem">
Bokhove, Christian, John Jerrim, and Sam Sims. 2023. <span>“How Useful Are Ofsted Inspection Judgements for Informing Secondary School Choice?”</span> <em>Journal of School Choice</em> 17 (1): 35–61.
</div>
<div id="ref-bokhove2024schools" class="csl-entry" role="listitem">
———. 2024. <span>“Do Schools That Employ an Inspector Get Better Inspection Grades?”</span> <em>British Educational Research Journal</em> 50 (5): 2383–2406.
</div>
</div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>