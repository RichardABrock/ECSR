<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Introduction to R – ECSR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../css/mastemr.css">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="index.qmd" class="navbar-brand navbar-brand-logo">
    <img src="../images/KCL_logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="index.qmd">
    <span class="navbar-title">ECSR</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/01-1-Loading_R.html">Introduction to R</a></li><li class="breadcrumb-item"><a href="../chapters/01-1-Loading_R.html">Introduction to R</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-1-Loading_R.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Introduction to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-2-Intro_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loading packages and exploring data</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to Stats</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-1-Descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Descriptive Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-2-ChisqPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis testing and Chi-square tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-3-T-testsPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T-tests</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Intro_to_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making graphs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Corpus analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A9-Corpus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Corpus Analysis</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Publications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-Rpublications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Publishing using R and quarto</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-PISA_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PISA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-DfE_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DfE England</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A3-TIMSS_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TIMSS, PIRLS and ICILS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A4-Other_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A5-Self_Study_Tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self Study Tasks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A6-selecting_statistical_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selecting statistical tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A7-QandA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Questions and Answers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A10-Leaflet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Leaflet</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#getting-set-up" id="toc-getting-set-up" class="nav-link active" data-scroll-target="#getting-set-up"><span class="header-section-number">1</span> Getting set up</a>
  <ul class="collapse">
<li><a href="#sec-installation" id="toc-sec-installation" class="nav-link" data-scroll-target="#sec-installation"><span class="header-section-number">1.1</span> Installation for KCL staff</a></li>
  <li><a href="#sec-installation" id="toc-sec-installation" class="nav-link" data-scroll-target="#sec-installation"><span class="header-section-number">1.2</span> Installation (on your own machine)</a></li>
  <li><a href="#sec-packages" id="toc-sec-packages" class="nav-link" data-scroll-target="#sec-packages"><span class="header-section-number">1.3</span> Setting up RStudio and the tidyverse</a></li>
  </ul>
</li>
  <li><a href="#starting-to-code" id="toc-starting-to-code" class="nav-link" data-scroll-target="#starting-to-code"><span class="header-section-number">2</span> Starting to code</a></li>
  <li>
<a href="#your-first-program" id="toc-your-first-program" class="nav-link" data-scroll-target="#your-first-program"><span class="header-section-number">3</span> Your first program</a>
  <ul class="collapse">
<li>
<a href="#objects-and-instructions" id="toc-objects-and-instructions" class="nav-link" data-scroll-target="#objects-and-instructions"><span class="header-section-number">3.1</span> Objects and instructions</a>
  <ul class="collapse">
<li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions"><span class="header-section-number">3.1.1</span> Questions</a></li>
  </ul>
</li>
  <li>
<a href="#naming-objects" id="toc-naming-objects" class="nav-link" data-scroll-target="#naming-objects"><span class="header-section-number">3.2</span> Naming objects</a>
  <ul class="collapse">
<li><a href="#questions-1" id="toc-questions-1" class="nav-link" data-scroll-target="#questions-1"><span class="header-section-number">3.2.1</span> Questions</a></li>
  </ul>
</li>
  <li><a href="#comments" id="toc-comments" class="nav-link" data-scroll-target="#comments"><span class="header-section-number">3.3</span> Comments</a></li>
  <li>
<a href="#sec-datatypes" id="toc-sec-datatypes" class="nav-link" data-scroll-target="#sec-datatypes"><span class="header-section-number">3.4</span> Datatypes</a>
  <ul class="collapse">
<li><a href="#questions-2" id="toc-questions-2" class="nav-link" data-scroll-target="#questions-2"><span class="header-section-number">3.4.1</span> Questions</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#sec-vectors" id="toc-sec-vectors" class="nav-link" data-scroll-target="#sec-vectors"><span class="header-section-number">4</span> Vectors</a>
  <ul class="collapse">
<li><a href="#questions-3" id="toc-questions-3" class="nav-link" data-scroll-target="#questions-3"><span class="header-section-number">4.1</span> Questions</a></li>
  </ul>
</li>
  <li><a href="#summary-questions" id="toc-summary-questions" class="nav-link" data-scroll-target="#summary-questions"><span class="header-section-number">5</span> Summary questions</a></li>
  <li>
<a href="#packages-and-libraries" id="toc-packages-and-libraries" class="nav-link" data-scroll-target="#packages-and-libraries"><span class="header-section-number">6</span> Packages and libraries</a>
  <ul class="collapse">
<li><a href="#sec-load-run-pckges" id="toc-sec-load-run-pckges" class="nav-link" data-scroll-target="#sec-load-run-pckges"><span class="header-section-number">6.1</span> Installing and loading packages</a></li>
  <li><a href="#the-tidyverse" id="toc-the-tidyverse" class="nav-link" data-scroll-target="#the-tidyverse"><span class="header-section-number">6.2</span> The Tidyverse</a></li>
  </ul>
</li>
  <li><a href="#sec-loading" id="toc-sec-loading" class="nav-link" data-scroll-target="#sec-loading"><span class="header-section-number">7</span> Loading data</a></li>
  <li><a href="#dataframes" id="toc-dataframes" class="nav-link" data-scroll-target="#dataframes"><span class="header-section-number">8</span> Dataframes</a></li>
  <li><a href="#loading-data-from-the-web" id="toc-loading-data-from-the-web" class="nav-link" data-scroll-target="#loading-data-from-the-web"><span class="header-section-number">9</span> Loading data from the web</a></li>
  <li><a href="#sec-loading-computer" id="toc-sec-loading-computer" class="nav-link" data-scroll-target="#sec-loading-computer"><span class="header-section-number">10</span> Loading data from your computer</a></li>
  <li>
<a href="#setting-working-directories" id="toc-setting-working-directories" class="nav-link" data-scroll-target="#setting-working-directories"><span class="header-section-number">11</span> Setting working directories</a>
  <ul class="collapse">
<li><a href="#proper-addresses" id="toc-proper-addresses" class="nav-link" data-scroll-target="#proper-addresses"><span class="header-section-number">11.1</span> Proper addresses</a></li>
  </ul>
</li>
  <li><a href="#sec-parquet" id="toc-sec-parquet" class="nav-link" data-scroll-target="#sec-parquet"><span class="header-section-number">12</span> .parquet and .feather files</a></li>
  <li><a href="#csv-files" id="toc-csv-files" class="nav-link" data-scroll-target="#csv-files"><span class="header-section-number">13</span> .csv files</a></li>
  <li><a href="#spss-.sav" id="toc-spss-.sav" class="nav-link" data-scroll-target="#spss-.sav"><span class="header-section-number">14</span> SPSS / .sav</a></li>
  <li><a href="#xml" id="toc-xml" class="nav-link" data-scroll-target="#xml"><span class="header-section-number">15</span> .xml</a></li>
  <li><a href="#json" id="toc-json" class="nav-link" data-scroll-target="#json"><span class="header-section-number">16</span> .json</a></li>
  <li><a href="#writing-excel-files" id="toc-writing-excel-files" class="nav-link" data-scroll-target="#writing-excel-files"><span class="header-section-number">17</span> Writing excel files</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/01-1-Loading_R.html">Introduction to R</a></li><li class="breadcrumb-item"><a href="../chapters/01-1-Loading_R.html">Introduction to R</a></li></ol></nav><div class="quarto-title">
<h1 class="title">Introduction to R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>This short course aims to take you through the process of writing your first programs in the <strong>R statistical programming language</strong> to analyse national and international educational datasets. To do this we will be using the <strong>R Studio</strong> integrated development environment (IDE), a desktop application to support you in writing R scripts. R Studio supports your programming by flagging up errors in your code as you write it, and helping you manage your analysis environment by giving you quick access to tables, objects and graphs as you develop them. In addition, we will be looking at data analysis using the <strong>tidyverse</strong> code packages. The tidyverse is a standardised collection of supporting code that helps you read data, tidy it into a usable format, analyse it and present your findings.</p>
<p>The R programming language offers similar functionality to an application based statistical tool such as SPSS, with more of a focus on you writing code to solve your problems, rather than using prebuilt tools. R is open source, meaning that it is free to use and that lots of people have written code in R that they have shared with others. R statistical libraries are some of the most comprehensive in existence. R is popular<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> in academia and industry, being used for everything from sales modelling to cancer detection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># This example shows how R can pull data directly from the internet</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># tidy it and start making graphs. All within 9 lines of code</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>education <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="st">"https://barrolee.github.io/BarroLeeDataSet/BLData/BL_v3_MF.csv"</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>education <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="fu">filter</span>(agefrom <span class="sc">==</span> <span class="dv">15</span>, ageto <span class="sc">==</span> <span class="dv">24</span>,</span>
<span id="cb1-10"><a href="#cb1-10"></a>         country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Germany"</span>,<span class="st">"France"</span>,<span class="st">"Italy"</span>,<span class="st">"United Kingdom"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>yr_sch, <span class="at">colour=</span>country)) <span class="sc">+</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="01-1-Loading_R_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Whilst it is possible to use R through menu systems and drop down tools, the focus of this course is for you to write your own R scripts. These are text files that will tell the computer how to go through the process of loading, cleaning, analysing and presenting data. The sequential and modular nature of these files makes it very easy to develop and test each stage separately, reuse code in the future, and share with others.</p>
<p>This booklet is written with the following sections to support you:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Code examples and questions appear like this</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1] Code output appears like this</code></pre>
<p><code>Courier font</code> indicates keyboard presses, column names, column values and function names.</p>
<p><code>&lt;folder&gt;</code> Courier font within brackets describe values that can be passed to functions and that you need to define yourself. I.e. copying and pasting these code chunks verbatim won’t work!</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>specifies things to note</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>gives warning messages</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>highlights issues that might break your code</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>gives suggestions on how to do things in a better way</p>
</div>
</div>
<div class="question">
<p>Activities and coding tasks look like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>what <span class="ot">&lt;-</span> <span class="st">"does this"</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>code <span class="sc">==</span> <span class="st">"do"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<section id="getting-set-up" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Getting set up</h1>
<section id="sec-installation" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="sec-installation">
<span class="header-section-number">1.1</span> Installation for KCL staff</h2>
<p>If you are a KCL staff member, you can install R and R Studio using the KCL self service application. If you are not a KCL staff member, please follow the instructions in the next section.</p>
<ol type="1">
<li>Open the KCL self-service centre, and search for R and R Studio</li>
</ol>
<p><img src="images/self_service_main.png" class="img-fluid" width="600"></p>
<ol start="2" type="1">
<li>Search for “R binary” and install</li>
</ol>
<p><img src="images/R_self_service.png" class="img-fluid" width="600"></p>
<ol start="3" type="1">
<li>Search for “RStudio desktop” and install</li>
</ol>
<p><img src="images/R_studio_selfe.png" class="img-fluid" width="600"></p>
</section><section id="sec-installation" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="sec-installation">
<span class="header-section-number">1.2</span> Installation (on your own machine)</h2>
<ol type="1">
<li>
<p>Install R (default settings should be fine)</p>
<ol type="a">
<li>
<strong>Windows</strong> users visit: <a href="https://cran.r-project.org/bin/windows/base/">here</a>
</li>
<li>
<strong>Mac</strong> users visit: <a href="https://cran.r-project.org/bin/macosx/">here</a> and make sure you get the correct version of R: for Apple silicon (M1-3) Macs (~November 2020 onwards), or older Intel Macs (~up to November 2020)</li>
<li>
<strong>Linux</strong> users visit: <a href="https://cran.rstudio.com/bin/linux/">here</a>
</li>
</ol>
</li>
<li><p>Install <strong>RStudio</strong>, visit <a href="https://rstudio.com/products/rstudio/download/#download">here</a> and it should present you with the version suitable for your operating system.</p></li>
</ol>
<p>(If the above doesn’t work follow the instructions <a href="https://www.rstudio.com/products/rstudio/download/#download">here</a>)</p>
</section><section id="sec-packages" class="level2" data-number="1.3"><h2 data-number="1.3" class="anchored" data-anchor-id="sec-packages">
<span class="header-section-number">1.3</span> Setting up RStudio and the tidyverse</h2>
<ol type="1">
<li><p>Open RStudio</p></li>
<li>
<p>On the bottom right-hand side, select <strong>Packages</strong>, then select <strong>Install</strong>, then type <strong>“tidyverse”</strong> into the Packages field of the new window:</p>
<p><img src="images/tidyverse_install.png" class="img-fluid"></p>
</li>
<li><p>Click Install and you should see things happening in the console (bottom left). Wait for the console activity to finish (it’ll be downloading and checking packages). If it asks any questions, type <code>N</code> for no and press enter.</p></li>
<li>
<p>Add a new R Script using the <img src="images/RStudio_new_button.png" class="img-fluid"> button</p>
<p><img src="images/RStudio_new_button_RScript.png" width="210" height="74"></p>
</li>
<li>
<p>In the new R script, write the following:</p>
<p><img src="images/code_starwars.png" class="img-fluid" width="514"></p>
</li>
<li>
<p>Select all the lines and press <code>Control</code> or <code>Command ⌘</code> and <code>Enter</code> on your keyboard at the same time. Alternatively, press the <img src="images/RStudio-run.png" class="img-fluid" width="36"> button</p>
<p><img src="images/code_starwars_select.png" class="img-fluid" width="585"></p>
</li>
<li>
<p>Check that you have the following in the console window (depending on your screen size you might have fewer columns):</p>
<p><img src="images/output_data_starwars.png" class="img-fluid"></p>
</li>
<li><p>Install the <code>arrow</code> package, repeat step 2, above.</p></li>
<li><p>Download the <code>PISA_student_2022_subset.parquet</code> dataset from <a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EUT13jrQxKJCp64WnH1MG3MBHoDqkzx1NJZIoVpUFHUYvg?e=pi2ZoD">here</a> and <strong>download</strong> it on your computer, make a note of the <strong>full folder location</strong> where you have saved this!</p></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you need help with finding the full folder location of your file, often a hurdle for Mac users, go to <a href="#sec-loading-computer" class="quarto-xref">Chapter&nbsp;10</a></p>
</div>
</div>
<ol start="10" type="1">
<li>Copy the following code and replace <code>&lt;folder&gt;</code> with the full folder location of where your dataset was saved, make sure that you have <code>.parquet</code> on the end. And keep the <code>(r"[  ]")</code>! Make sure you run all the lines in the code below, including the <code><a href="https://github.com/apache/arrow/">library(arrow)</a></code> and <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code> lines.</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>examples of what this should look like for PC and Mac</summary><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># For Pete (PC) the address format was:</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>PISA_2022 <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(r<span class="st">"[C:\Users\Peter\KCL\MASTEMR\PISA_student_2022_subset.parquet]"</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># For Richard (Mac) the address format was:</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>PISA_2022 <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(r<span class="st">"[/Users/k1765032/Documents/Teaching/STEM MA/Quantitative module/Data sets/PISA_student_2022_subset.parquet]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a>PISA_2022 <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(r<span class="st">"[&lt;folder&gt;PISA_student_2022_subset.parquet]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you can’t load the parquet file, you can load the data as an RDS file which takes longer, but should work if you are having problems with the arrow package. Download the data as an RDS file <a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EcwRptXp981NsGn4DuL3ifcBQjZZuRXnim3AGM48ozoVbA?e=0AARqx">here</a></p>
<p>Then use the code below to load the RDS file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a>PISA_2022 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"[&lt;folder&gt;PISA_student_2022_subset_RDS.rds]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="11" type="1">
<li>Underneath the code you have already written, copy the code below (you don’t have to write it yourself), and run it. Try and figure out what each line does and what it’s telling you.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">mutate</span>(<span class="at">maths_better =</span> PV1MATH <span class="sc">&gt;</span> PV1READ) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">select</span>(CNT, ST004D01T, maths_better, PV1MATH, PV1READ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ST004D01T), <span class="sc">!</span><span class="fu">is.na</span>(maths_better)) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="fu">group_by</span>(ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="fu">mutate</span>(<span class="at">students_n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="fu">group_by</span>(ST004D01T, maths_better) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb7-11"><a href="#cb7-11"></a>            <span class="at">per =</span> n<span class="sc">/</span><span class="fu">unique</span>(students_n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="12" type="1">
<li><p>That’s it, you should be set up!</p></li>
<li><p>Any issues, please drop a message on the Teams group, or mail <a href="mailto:peter.kemp@kcl.ac.uk">peter.kemp@kcl.ac.uk</a> and <a href="mailto:richard.brock@kcl.ac.uk">richard.brock@kcl.ac.uk</a></p></li>
</ol></section></section><section id="starting-to-code" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Starting to code</h1>
<p>After adding a new R Script using the button <img src="images/RStudio_new_button.png" width="27" height="29">, there are four parts to R Studio’s interface. For the moment we are most interested in the Script file section, top left.</p>
<p><img src="images/RStudio_interface.png" class="img-fluid" width="600"></p>
</section><section id="your-first-program" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Your first program</h1>
<section id="objects-and-instructions" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="objects-and-instructions">
<span class="header-section-number">3.1</span> Objects and instructions</h2>
<p>In programming languages we can attach data to a name, this is called assigning a value to an object (you might also call them <em>variables</em>). To do this in R we use the <code>&lt;-</code> arrow command. For example, I want to put the word <code>"Pete"</code> into an object called <code>myname</code> (note that words and sentences such as <code>"Pete"</code> need speech marks):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>myname <span class="ot">&lt;-</span> <span class="st">"Pete"</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">print</span>(myname)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Pete"</code></pre>
</div>
</div>
<p>We can also perform quick calculations and assign them to objects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>HoursInYear <span class="ot">&lt;-</span> <span class="dv">365</span> <span class="sc">*</span> <span class="dv">24</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">print</span>(HoursInYear) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8760</code></pre>
</div>
</div>
<div class="question">
<p>Type the two examples above into your RStudio script file and check that they work. Adapt them to say your full name and give the number of <code>MinutesInADay</code></p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember to select code and press <code>control</code> or <code>command</code> and <code>Enter</code> to run it</p>
</div>
</div>
<p>Objects can form part of calculations, for example, the code below shows how we can use the number <code>HoursInYear</code> to (roughly!) calculate the number of <code>HoursInWeek</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>HoursInYear <span class="ot">&lt;-</span> <span class="dv">365</span> <span class="sc">*</span> <span class="dv">24</span></span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a>HoursInWeek <span class="ot">&lt;-</span> HoursInYear <span class="sc">/</span> <span class="dv">52</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="fu">print</span>(HoursInWeek)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 168.4615</code></pre>
</div>
</div>
<p>Notice from the above we can perform the main arithmetic commands using keyboard symbols: <code>+</code> (add); <code>-</code> (minus); <code>*</code> (multiply); <code>/</code> (divide); <code>^</code> (power)</p>
<p>Objects can change values when you run code. For example in the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>b <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a>a <span class="ot">&lt;-</span> b</span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a>a <span class="ot">&lt;-</span> a <span class="sc">*</span> b</span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="fu">print</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25</code></pre>
</div>
</div>
<p>What’s going on here?</p>
<ul>
<li>line 1 sets <code>a</code> to equal 2000 (note: don’t use commas in writing numbers <code>a &lt;- 2,000</code> would bring up an error),</li>
<li>line 2 sets <code>b</code> to equal 5,</li>
<li>line 4 overwrites the value of <code>a</code> with the value stored in <code>b</code>, making object <code>a</code> now equal to 5</li>
<li>line six is now <code>5 * 5</code>
</li>
</ul>
<section id="questions" class="level3" data-number="3.1.1"><h3 data-number="3.1.1" class="anchored" data-anchor-id="questions">
<span class="header-section-number">3.1.1</span> Questions</h3>
<div class="question">
<p>what are the outputs of the following code snippets/what do they do? One of the examples might not output anything, why is that? Type the code into your script file to check your answers:</p>
<p>code example 1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>rabbits <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>feet <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a>totalfeet <span class="ot">&lt;-</span> rabbits <span class="sc">*</span> feet</span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="fu">print</span>(totalfeet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="dv">200</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>code example 2</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>p <span class="ot">&lt;-</span> <span class="fl">3.14</span> <span class="sc">-</span> <span class="fl">0.14</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>r <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="fu">print</span>(p <span class="sc">*</span> r<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="dv">75</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>code example 3</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>tax <span class="ot">&lt;-</span> <span class="fl">17.5</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>price <span class="ot">&lt;-</span> <span class="fl">4.50</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>sales <span class="ot">&lt;-</span> <span class="dv">128</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>tax <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb20-5"><a href="#cb20-5"></a></span>
<span id="cb20-6"><a href="#cb20-6"></a>income <span class="ot">&lt;-</span> (sales <span class="sc">*</span> price) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (tax<span class="sc">/</span><span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># prints nothing! there isn't a print statement</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section></section><section id="naming-objects" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="naming-objects">
<span class="header-section-number">3.2</span> Naming objects</h2>
<p>Correctly naming objects is very important. You can give an object almost any name, but there are a few rules to follow:</p>
<ul>
<li>Name them something sensible</li>
<li>R is case sensitive, <code>myName</code> is not equal to (<code>!=</code>) <code>myname</code>
</li>
<li>Don’t use spaces in names</li>
<li>Don’t start a name with a number</li>
<li>Keep punctuation in object names to underscore (<code>_</code> and full stop <code>.</code>) e.g.&nbsp;<code>my_name</code>, <code>my.name</code>.</li>
<li>Stick to a convention for all your objects, it’ll make your code easier to read, e.g.
<ul>
<li>
<code>myName</code>, <code>yourName</code>, <code>ourName</code> (this is <em>camelCase</em> <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>)</li>
<li>
<code>my_name</code>, <code>your_name</code>, <code>our_name</code> (this is <em>snake case</em>)</li>
</ul>
</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The actual name of an object has no effect on what it does (other than invalid names breaking your program!). For example <code>age &lt;- "Barry"</code> is perfectly valid to R, it’s just a real pain for a human to read.</p>
</div>
</div>
<section id="questions-1" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="questions-1">
<span class="header-section-number">3.2.1</span> Questions</h3>
<div class="question">
<p>Which of these are valid R object names:</p>
<ul>
<li><code>my_Number</code></li>
<li><code>my-Number</code></li>
<li><code>myNumber!</code></li>
<li><code>first name</code></li>
<li><code>FIRSTname</code></li>
<li><code>i</code></li>
<li><code>3names</code></li>
<li><code>names3</code></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>answers</summary><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># my_Number  (VALID)</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="co"># my-Number  (INVALID due to -)</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co"># myNumber!  (INVALID due to !)</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="co"># first name (INVALID due to space)</span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co"># FIRSTname  (VALID but we don't recommend so many caps)</span></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="co"># i          (VALID)</span></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="co"># 3names     (INVALID starts with a 3)</span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="co"># names3     (VALID)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For more information on the R programming style guide, see <a href="https://style.tidyverse.org/">this</a></p>
</div>
</div>
</section></section><section id="comments" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="comments">
<span class="header-section-number">3.3</span> Comments</h2>
<p>Code can often look confusing and it’s a good idea to add <code># comments</code> to your code to make it more understandable for you and others. The computer ignores comments when running your code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># this calculates the average sales per shop</span></span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a>income1 <span class="ot">&lt;-</span> <span class="dv">132</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>income2 <span class="ot">&lt;-</span> <span class="dv">665</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>income3 <span class="ot">&lt;-</span> <span class="dv">233</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>income4 <span class="ot">&lt;-</span> <span class="dv">1200</span></span>
<span id="cb23-7"><a href="#cb23-7"></a></span>
<span id="cb23-8"><a href="#cb23-8"></a>shops <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co"># everything after the hash is a comment</span></span>
<span id="cb23-9"><a href="#cb23-9"></a></span>
<span id="cb23-10"><a href="#cb23-10"></a>avgSales <span class="ot">&lt;-</span> <span class="fu">sum</span>(income1, income2, income3, income4) <span class="sc">/</span> shops  </span>
<span id="cb23-11"><a href="#cb23-11"></a></span>
<span id="cb23-12"><a href="#cb23-12"></a><span class="co"># sometimes you might want to comment out code that</span></span>
<span id="cb23-13"><a href="#cb23-13"></a><span class="co"># is no longer needed, but might be useful later</span></span>
<span id="cb23-14"><a href="#cb23-14"></a><span class="co"># standard_deviation &lt;- sd(c(income1, income2, income3, income4) )</span></span>
<span id="cb23-15"><a href="#cb23-15"></a><span class="co"># the above code isn't run</span></span>
<span id="cb23-16"><a href="#cb23-16"></a></span>
<span id="cb23-17"><a href="#cb23-17"></a><span class="fu">print</span>(avgSales) <span class="co"># but this code is</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 557.5</code></pre>
</div>
</div>
</section><section id="sec-datatypes" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="sec-datatypes">
<span class="header-section-number">3.4</span> Datatypes</h2>
<p>We have already met two different <em>datatypes</em>, the <em>character</em> datatype for words and letters (e.g.&nbsp;<code>"Peter"</code>) and the <em>numeric</em> datatype for numbers (e.g.&nbsp;<code>12</code>). Datatypes tell R how to handle data in certain circumstances. Sometimes data will be of the wrong datatype and you will need to convert between datatypes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>weeks <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>days_in_week <span class="ot">&lt;-</span> <span class="st">"7"</span></span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="co"># we now attempt to multiply a number by a string</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="co"># but it doesn't work!</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>total_days <span class="ot">&lt;-</span> weeks <span class="sc">*</span> days_in_week </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in weeks * days_in_week: non-numeric argument to binary operator</code></pre>
</div>
</div>
<p>Whilst R will understand what to do when we multiply numbers with numbers, it gets very confused and raises an error when we try to perform an <em>arithmetic</em> operation using <em>words</em> and <em>numbers</em>.</p>
<p>To perform the calculation we will need to convert the <code>days_in_week</code> from a string to a number, using the <code>as.numeric(&lt;text&gt;)</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>weeks <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>days_in_week <span class="ot">&lt;-</span> <span class="st">"7"</span></span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co"># we now attempt to multiply a number by a string</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>total_days <span class="ot">&lt;-</span> weeks <span class="sc">*</span> <span class="fu">as.numeric</span>(days_in_week)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is a <em>logical</em> datatype for boolean values of <code>TRUE</code> and <code>FALSE</code>. This will become a lot more useful later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>legs_snake <span class="ot">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># you can specify logical values directly</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>dogs_legs <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>legs_dog <span class="ot">&lt;-</span> dogs_legs <span class="sc">&gt;</span> <span class="dv">0</span> <span class="co"># or as part of a calculation</span></span>
<span id="cb28-4"><a href="#cb28-4"></a></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="co"># Do dog's have legs?</span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="fu">print</span>(legs_dog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>There are actually three datatypes for numbers in R, <code>numeric</code> for most of your work, the rarer <code>integer</code> specifically for whole numbers and the even rarer <code>complex</code> for complex numbers. When you are looking at categorical data, <code>factors</code> are used on top of the underlying datatype to store the different values, for example you might have a field of <code>character</code> to store <code>countries</code>, factors would then list the different countries stored in this character field.</p>
<p>To change from one datatype to another we use the <code>as.____</code> command: <code>as.numeric(&lt;text&gt;)</code>, <code>as.logical(&lt;data&gt;)</code>, <code>as.character(&lt;numeric&gt;)</code>.</p>
<section id="questions-2" class="level3" data-number="3.4.1"><h3 data-number="3.4.1" class="anchored" data-anchor-id="questions-2">
<span class="header-section-number">3.4.1</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Can you spot the error(s) in this code and fix them so it outputs: “July is month 7”?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>month <span class="ot">&lt;-</span> <span class="st">"July"</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>order <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  </span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="fu">print</span>(month)</span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="fu">Print</span>(<span class="st">"is"</span>)</span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="fu">print</span>(month)</span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="fu">print</span>(<span class="st">"order"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>month <span class="ot">&lt;-</span> <span class="st">"July"</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>order <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>  </span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="fu">print</span>(month)    </span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="fu">print</span>(<span class="st">"is"</span>)     <span class="co">#1 print needs a lowercase p</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="fu">print</span>(<span class="st">"month"</span>)  <span class="co">#2 month is a character not an object, use speech marks</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="fu">print</span>(order)    <span class="co">#3 order is an object, not a character, so drop the speech marks</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Can you spot the error(s) in this code and fix it?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>a <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>b <span class="ot">&lt;-</span> <span class="st">"8"</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>c <span class="sc">&lt;</span> <span class="sc">-</span> <span class="dv">3</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>  </span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="fu">print</span>(a <span class="sc">+</span> b <span class="sc">+</span> c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>a <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>b <span class="ot">&lt;-</span> <span class="dv">8</span> <span class="co">#1 b is numeric so drop the speech marks</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>c <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co">#2 the arrow needs to be together, remove the space</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>  </span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="fu">print</span>(a <span class="sc">+</span> b <span class="sc">+</span> c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Can you spot the error(s) in this code and fix it?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>pass mark <span class="ot">&lt;-</span> <span class="dv">50</span> </span>
<span id="cb34-2"><a href="#cb34-2"></a>exam_grade <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co"># did the student pass?</span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="fu">print</span>(exam_grade <span class="sc">&gt;</span> pass_mark)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>pass_mark <span class="ot">&lt;-</span> <span class="dv">50</span> <span class="co">#1 the variable name can't have any spaces</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>exam_grade <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb35-3"><a href="#cb35-3"></a></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="co"># did the student pass?</span></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="fu">print</span>(exam_grade <span class="sc">&gt;=</span> pass_mark) <span class="co"># this needs to be &gt;= as they had a passing grade</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to find out the datatype of an object you can use the structure <code>str</code> command to give you more information about the object. In this instance <code>chr</code> means that <code>month</code> is of character datatype and <code>num</code> means it is of the numeric datatype.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>month <span class="ot">&lt;-</span> <span class="st">"July"</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="fu">str</span>(month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr "July"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>month <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="fu">str</span>(month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num 7</code></pre>
</div>
</div>
</div>
</div>
</section></section></section><section id="sec-vectors" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Vectors</h1>
<p>So far we have seen how R does simple calculations and prints out the results. Underlying all of this are <em>vectors</em>. Vectors are data structures that bring together one or data elements of the <em>same</em> datatype. E.g. we might have a <code>numeric</code> vector recording the grades of a class, or a <code>character</code> vector storing the gender of a set of students. To define a vector we use <code>c(&lt;item&gt;, &lt;item&gt;, ...)</code>, where <code>c</code> stands for <em>combine</em>. Vectors are very important to R<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, even declaring a single object, <code>x &lt;- 6</code>, is creating a vector of size one. Larger vectors look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>maths_grade <span class="ot">&lt;-</span>   <span class="fu">c</span>(<span class="dv">5</span>,    <span class="dv">4</span>,    <span class="dv">4</span>,    <span class="dv">1</span>,     <span class="dv">7</span>,     <span class="dv">5</span>,     <span class="dv">8</span>)</span>
<span id="cb40-2"><a href="#cb40-2"></a>english_grade <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,    <span class="dv">5</span>,    <span class="dv">3</span>,    <span class="dv">2</span>,     <span class="dv">3</span>,     <span class="dv">6</span>,     <span class="dv">9</span>)</span>
<span id="cb40-3"><a href="#cb40-3"></a>genders <span class="ot">&lt;-</span>      <span class="fu">c</span>(<span class="st">"F"</span>,  <span class="st">"M"</span>,  <span class="st">"M"</span>,  <span class="st">"F"</span>,   <span class="st">"M"</span>,   <span class="st">"F"</span>,   <span class="st">"M"</span>)</span>
<span id="cb40-4"><a href="#cb40-4"></a>students <span class="ot">&lt;-</span>     <span class="fu">c</span>(<span class="st">"Joe"</span>, <span class="st">"Al"</span>, <span class="st">"Mo"</span>, <span class="st">"Flo"</span>, <span class="st">"Olu"</span>, <span class="st">"Sam"</span>, <span class="st">"Jimmy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can quickly perform calculations across whole vectors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># convert all genders to the lower case form</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="fu">tolower</span>(genders) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "f" "m" "m" "f" "m" "f" "m"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># raise everyone's maths grade by one(!?)</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>maths_grade <span class="sc">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6 5 5 2 8 6 9</code></pre>
</div>
</div>
<p>We can also perform calculations across vectors, in the example below we can find out which students got a better grade in Maths than in English.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># this compares each pair of values</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="co"># e.g. the first item in maths_grade (5) with</span></span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="co"># the first item in english_grade (8)</span></span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="co"># and so on</span></span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="co"># This returns a logical vector of TRUE and FALSE</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>maths_grade <span class="sc">&gt;</span> english_grade</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE  TRUE FALSE  TRUE FALSE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># To work out how many students got a better grade </span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="co"># in maths than in English we can apply sum()</span></span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="co"># to the logical vector. </span></span>
<span id="cb47-4"><a href="#cb47-4"></a><span class="co"># We know that TRUE == 1, FALSE == 0,</span></span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="co"># so sum() will count all the TRUEs</span></span>
<span id="cb47-6"><a href="#cb47-6"></a><span class="fu">sum</span>(maths_grade <span class="sc">&gt;</span> english_grade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># if you want to find out the average grade for</span></span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="co"># each student in maths and english</span></span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="co"># add both vectors together and divide by 2</span></span>
<span id="cb49-4"><a href="#cb49-4"></a>(maths_grade <span class="sc">+</span> english_grade) <span class="sc">/</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.5 4.5 3.5 1.5 5.0 5.5 8.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># we can use square brackets to pick a value from a vector</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="co"># vectors start counting from 1, so students[1] would pick Joe</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>students[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Joe"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># we can pass a numeric vector to a another vector to create a</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="co"># subset, in the example below we find the 3rd and 5th item</span></span>
<span id="cb53-3"><a href="#cb53-3"></a></span>
<span id="cb53-4"><a href="#cb53-4"></a>students[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mo"  "Olu"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># we can also use a vector of TRUE and FALSE to pick items</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="co"># TRUE will pick an item, FALSE will ignore it</span></span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="co"># for each maths_grade &gt; english_grade that is TRUE</span></span>
<span id="cb55-4"><a href="#cb55-4"></a><span class="co"># the name in that position in the student vector will be shown</span></span>
<span id="cb55-5"><a href="#cb55-5"></a>students[maths_grade <span class="sc">&gt;</span> english_grade]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mo"  "Olu"</code></pre>
</div>
</div>
<p>You should be careful when trying to compare vectors of different lengths. When combining vectors of different lengths, the shorter vector will match the length of the longer vector by wrapping its values around. For example if we try to combine a vector of the numbers 1 ot 10 with a two item logical vector <code>TRUE</code> <code>FALSE</code>, the logical vector will repeat 5 times: <code>c(TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE)</code>. We can use this vector as a <em>mask</em> to return the odd numbers, TRUE means keep, FALSE means ignore:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>nums <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>)</span>
<span id="cb57-2"><a href="#cb57-2"></a>mask <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>) </span>
<span id="cb57-3"><a href="#cb57-3"></a></span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="co"># you can see the repeat of mask by pasting them together</span></span>
<span id="cb57-5"><a href="#cb57-5"></a><span class="fu">paste</span>(nums, mask)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "1 TRUE"   "2 FALSE"  "3 TRUE"   "4 FALSE"  "5 TRUE"   "6 FALSE" 
 [7] "7 TRUE"   "8 FALSE"  "9 TRUE"   "10 FALSE"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># now to filter out the numbers we don't want</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>nums[mask]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 3 5 7 9</code></pre>
</div>
</div>
<p>This might not seem very useful, but it comes in very handy when we want to perform a single calculation across a whole vector. For example, we want to find all the students who achieved grade 5 in English, the below code creates a vector of <code>5</code>s the same size as <code>english_grade</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># this can also be rewritten english_grade &gt;= c(5)</span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="co"># note, when we are doing a comparison, we need to use double ==</span></span>
<span id="cb61-3"><a href="#cb61-3"></a>students[english_grade <span class="sc">==</span> <span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Al"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co">#which is the same as</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>students[english_grade <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Al"</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>When we are doing a comparison, we need to use double <code>==</code> equals sign. Using a single equals sign is the equivalent of an assignment <code>=</code> is the same as <code>&lt;-</code></p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are several shortcuts that you can take when creating vectors. Instead of writing a whole sequence of numbers by hand, you can use the <code>seq(&lt;start&gt;, &lt;finish&gt;, &lt;step&gt;)</code> command. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="co"># the step default is 1, so you can miss it from seq(1,10,1)</span></span>
<span id="cb65-2"><a href="#cb65-2"></a><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)   <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>)</span>
<span id="cb65-3"><a href="#cb65-3"></a><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This allows for some pretty short ways of solving quite complex problems, for example if you wanted to know the sum of all the <a href="https://projecteuler.net/problem=1">multiples of 3 and 5 below 1000</a>, you could write it like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># the unique() command gives you the unique items in a vector</span></span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="fu">sum</span>(<span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">3</span>, <span class="dv">999</span>, <span class="dv">3</span>), <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">999</span>, <span class="dv">5</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another shortcut is writing <code>T</code>, <code>F</code>, or <code>1</code>, <code>0</code> instead of the whole words <code>TRUE</code>, <code>FALSE</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="fu">c</span>(T, F) <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">==</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="questions-3" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="questions-3">
<span class="header-section-number">4.1</span> Questions</h2>
<div class="question">
<ol type="1">
<li>Can you spot the <em>three</em> problems with this code:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>nums <span class="ot">&lt;-</span> <span class="fu">v</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="st">"3"</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="fu">sum</span>(nums)</span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="fu">mean</span>(nums)</span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="co"># return a vector of all numbers greater than 2</span></span>
<span id="cb68-5"><a href="#cb68-5"></a><span class="fu">nums</span>(nums <span class="sc">&gt;=</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>nums <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">2</span>,<span class="dv">2</span>) </span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="co">#1 a vector is declared using c(), not v()</span></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="co">#2 3 should be numeric, so no need for speech marks</span></span>
<span id="cb69-4"><a href="#cb69-4"></a><span class="co"># (though technically R would do this conversion for you!)</span></span>
<span id="cb69-5"><a href="#cb69-5"></a></span>
<span id="cb69-6"><a href="#cb69-6"></a><span class="fu">sum</span>(nums)</span>
<span id="cb69-7"><a href="#cb69-7"></a><span class="fu">mean</span>(nums)</span>
<span id="cb69-8"><a href="#cb69-8"></a><span class="co"># return a vector of all numbers greater than 2</span></span>
<span id="cb69-9"><a href="#cb69-9"></a>nums[nums <span class="sc">&gt;=</span> <span class="dv">2</span>] <span class="co">#3 to pick items from another vector, use square brackets</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Create a vector to store the number of glasses of water you have drunk for each day in the last 7 days. Work out:
<ul>
<li>the mean average number of glasses for the week,</li>
<li>the total number of glasses,</li>
<li>the number of days where you drank less than 2 glasses (feel free to replace water with your own tipple: wine, coffee, tea, coke, etc.)</li>
</ul>
</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a>glasses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">3</span>)</span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="fu">mean</span>(glasses)</span>
<span id="cb70-3"><a href="#cb70-3"></a><span class="fu">sum</span>(glasses)</span>
<span id="cb70-4"><a href="#cb70-4"></a><span class="fu">sum</span>(glasses <span class="sc">&lt;</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Using the vectors below, create a program that will find out the average grade for females taking English:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>english_grade <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>)</span>
<span id="cb71-2"><a href="#cb71-2"></a>genders <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>english_grade <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>)</span>
<span id="cb72-2"><a href="#cb72-2"></a>genders <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>)</span>
<span id="cb72-3"><a href="#cb72-3"></a><span class="fu">mean</span>(english_grade[genders <span class="sc">==</span> <span class="st">"F"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section></section><section id="summary-questions" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> Summary questions</h1>
<p>Now you have covered the basics of R, it’s time for some questions to check your understanding. These questions will cover all the material you have read so far and don’t be worried if you need to go back and check something. Exemplar answers are provided, but don’t worry if your solution looks a little different, there are often multiple ways to achieve the same outcome.</p>
<div class="question">
<ol type="1">
<li>Describe three datatypes that you can use in your program?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="fu">print</span>(<span class="st">"numeric for numbers"</span>)</span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="fu">print</span>(<span class="st">"character for words/strings"</span>)</span>
<span id="cb73-3"><a href="#cb73-3"></a><span class="fu">print</span>(<span class="st">"logical for boolean values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>What are two reasons that you might use comments?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># to make your code more understandable</span></span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="co"># to disable bits of code that you might want to reenable later</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>
<p>Which object names are valid?</p>
<ul>
<li><code>my_name</code></li>
<li><code>your name</code></li>
<li><code>our-name</code></li>
<li><code>THYname</code></li>
</ul>
</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="co"># my_name - VALID</span></span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="co"># your name - INVALID use of space</span></span>
<span id="cb75-3"><a href="#cb75-3"></a><span class="co"># our-name - INVALID use of hyphen</span></span>
<span id="cb75-4"><a href="#cb75-4"></a><span class="co"># THYname - VALID</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Can you spot the <em>four</em> errors in this code:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>stu1 <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="dv">2</span>stu <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb76-3"><a href="#cb76-3"></a>stu3 <span class="ot">&lt;-</span> <span class="st">"15"</span></span>
<span id="cb76-4"><a href="#cb76-4"></a></span>
<span id="cb76-5"><a href="#cb76-5"></a><span class="co"># now work out the average of the ages</span></span>
<span id="cb76-6"><a href="#cb76-6"></a>avg <span class="sc">&lt;</span> <span class="sc">-</span> (Stu1 <span class="sc">+</span> stu2 <span class="sc">+</span> stu3) <span class="sc">/</span> <span class="dv">3</span></span>
<span id="cb76-7"><a href="#cb76-7"></a><span class="fu">print</span>(avg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>stu1 <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb77-2"><a href="#cb77-2"></a>stu2 <span class="ot">&lt;-</span> <span class="dv">13</span> <span class="co">#1 2stu to stu2, cannot start name with a number</span></span>
<span id="cb77-3"><a href="#cb77-3"></a>stu3 <span class="ot">&lt;-</span> <span class="dv">15</span> <span class="co">#2 no need for speech marks on "15"</span></span>
<span id="cb77-4"><a href="#cb77-4"></a></span>
<span id="cb77-5"><a href="#cb77-5"></a><span class="co"># now work out the average of the ages</span></span>
<span id="cb77-6"><a href="#cb77-6"></a>avg <span class="ot">&lt;-</span> (stu1 <span class="sc">+</span> stu2 <span class="sc">+</span> stu3) <span class="sc">/</span> <span class="dv">3</span> <span class="co">#3 broken arrow &lt; - #4 capital letter on Stu1</span></span>
<span id="cb77-7"><a href="#cb77-7"></a><span class="fu">print</span>(avg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="5" type="1">
<li>[Extension] Calculate the number of seconds since 1970.</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>this_year <span class="ot">&lt;-</span> <span class="dv">2022</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>focus_year <span class="ot">&lt;-</span> <span class="dv">1970</span></span>
<span id="cb78-3"><a href="#cb78-3"></a></span>
<span id="cb78-4"><a href="#cb78-4"></a>(this_year <span class="sc">-</span> focus_year) <span class="sc">*</span> <span class="dv">365</span> <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section><section id="packages-and-libraries" class="level1" data-number="6"><h1 data-number="6">
<span class="header-section-number">6</span> Packages and libraries</h1>
<p>R comes with some excellent statistical tools, but often you will need to supplement them with packages<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> . Packages contain functionality that isn’t built into R by default, but you can choose to load or install them to meet the needs of your tasks. For example you have code packages to deal with SPSS data, and other packages to run machine learning algorithms. Nearly all R packages are free to use!</p>
<section id="sec-load-run-pckges" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="sec-load-run-pckges">
<span class="header-section-number">6.1</span> Installing and loading packages</h2>
<p>To install a package you can use the package tab in the bottom right-hand panel of RStudio and follow the steps from <a href="#sec-packages" class="quarto-xref">Section&nbsp;1.3</a>. Alternatively you can install things by typing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the instruction is to install package<strong>s</strong>, you can pass a vector of package names to install multiple packages at the same time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"tidyverse"</span>,<span class="st">"readxl"</span>,<span class="st">"haven"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once a package is installed it doesn’t mean that you can use it, yet. You will need to <em>load</em> the package. To do this you need to use the <code>library(&lt;package_name&gt;)</code> command, for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some packages might use the same function names as other packages, for example <code>select</code> might do different things depending on which package you loaded last. As a rule of thumb, when you start RStudio afresh, make sure that you load the <code>tidyverse</code> package after you have loaded all your other packages. To read more about this problem see <strong>?@sec-QANDA</strong></p>
</div>
</div>
</section><section id="the-tidyverse" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="the-tidyverse">
<span class="header-section-number">6.2</span> The Tidyverse</h2>
<p>This course focuses on using the <em>tidyverse</em>; a free collection of programming <em>packages</em> that will allow you to write code that imports data, tidys it, transforms it into useful datasets, visualises findings, creates statistical models and communicates findings to others data using a standardised set of commands.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/data-science-workflow.png" class="img-fluid figure-img"></p>
<figcaption>Data science workflow - RStudio</figcaption></figure>
</div>
<p>For many people the tidyverse is the main reason that they use R. The tidyverse is used widely in government, academia, NGOs and industry, notable examples include the <a href="https://johnburnmurdoch.github.io/slides/r-ggplot/#/">Financial Times</a> and the <a href="https://bbc.github.io/rcookbook/">BBC</a>. Code in the tidyverse can be (relatively) easily understood by others and <em>you</em>, when you come back to a project after several months.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Try this out</strong></p>
<p>The code above transforms data and converts it into a graph. It doesn’t have any comments, but you should hopefully be able to understand what a lot of the code does by just reading it. Can you guess what each line does? Try running the code by selecting parts of it and pressing <code>control</code> | <code>command ⌘</code> and <code>Enter</code></p>
</div>
</div>
</section></section><section id="sec-loading" class="level1" data-number="7"><h1 data-number="7">
<span class="header-section-number">7</span> Loading data</h1>
<p>We can’t do much with R without loading data from elsewhere. Data will come in many formats and R should be able to deal with all of them. Some of the datasets you access will be a few rows and columns; others, like the ones we are going to use on this course, might run into hundreds of thousands or even millions of rows and hundreds or thousands of columns. Depending on the format you are using, you might need to use specific packages. A few of the data file types you might meet are described below:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 69%">
</colgroup>
<thead><tr class="header">
<th>File type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Comma separated values [.csv]</td>
<td>As it says in the name, <code>.csv</code> files store data by separating data items with commas. They are a common way of transferring data and can be easily created and read by Excel, Google spreadsheets and text editors (in addition to R). CSVs aren’t compressed so will generally be larger than other file types. They don’t store information on the types of data stored in the file so you might find yourself having to specify that a date column is a date, rather than a string of text. You can read and write csv files without the need to load any packages, but if you do use <code>readr</code> you might find things go much faster.</td>
</tr>
<tr class="even">
<td>Excel [.xls | .xlsx | .xlsxm]</td>
<td>Excel files store data in a compressed custom format. This means files will generally be smaller than CSVs and will also contain information on the types of data stored in different columns. R can read and write these files using the <code>openxlsx</code> package, but you can also use the tidyverse’s <code>readxl</code> for reading, and <code>writexl</code> for writing for excel formats.</td>
</tr>
<tr class="odd">
<td>R Data [.rds]</td>
<td>R has it’s own data format, <code>.rds</code>. Saving to this format means that you will make perfect copies of your R data, including data types and factors. When you load <code>.rds</code> files they will look exactly the same as when you saved them. Data can be highly compressed and it’s one of the fastest formats for getting data into R. You can read and write <code>.rds</code> files without the need to load any packages, but using the functions in <code>readr</code> might speed things up a bit. You won’t be able to look at <code>.rds</code> files in other programs such as Excel</td>
</tr>
<tr class="even">
<td>Arrow [.parquet]</td>
<td>Apache Arrow <code>.parquet</code> is a relatively new format that allows for the transfer of files between different systems. Files are small and incredibly fast to load, whilst looking exactly the same as when you save them. The PISA data set used here, that takes ~20 seconds to load in <code>.rds</code> format, will load in less than 2 seconds in <code>.parquet</code> format. Because of the way that data is stored you won’t be able to open these files in programs such as Excel. You will need the <a href="https://github.com/apache/arrow/">arrow</a> package to read and write <code>.parquet</code> files.</td>
</tr>
<tr class="odd">
<td>SPSS [.sav]</td>
<td>SPSS is a common analysis tool in the world of social science. The native format for SPSS data is <code>.sav</code>. These files are compressed and include information on column labels and column datatypes. You will need either the <code>haven</code> or <code>foreign</code> packages to read data into R. Once you have loaded the <code>.sav</code> you will probably want to convert the data into a format that is more suitable for R, normally this will involve converting columns into factors. We cover <em>factors</em> in more detail below.</td>
</tr>
<tr class="even">
<td>Stata [.dta]</td>
<td>
<code>haven</code> or <code>foreign</code> packages to read data into R</td>
</tr>
<tr class="odd">
<td>SAS [.sas]</td>
<td>
<code>haven</code> or <code>foreign</code> packages to read data into R</td>
</tr>
<tr class="even">
<td>Structured Query Language [.sql]</td>
<td>a common format for data stored in large databases. Normally SQL code would be used to query these, you can use the tidyverse to help construct SQL this through the package <a href="https://dbplyr.tidyverse.org/">dbplyr</a> which will convert your tidyverse pipe code into SQL. R can be set up to communicate directly with databases using the <code>DBI</code> package.</td>
</tr>
<tr class="odd">
<td>JavaScript Object Notation [.json]</td>
<td>
<code>.json</code> is a popular format for sharing data on the web. You can use <a href="https://jeroen.r-universe.dev/jsonlite">jsonlite</a> and <a href="https://github.com/alexcb/rjson">rjson</a> to access this type of data</td>
</tr>
</tbody>
</table>
<p>For this course we will be looking at <code>.csv</code>, <code>excel</code>, <code>.rds</code> and <code>parquet</code> files.</p>
</section><section id="dataframes" class="level1" data-number="8"><h1 data-number="8">
<span class="header-section-number">8</span> Dataframes</h1>
<p>Loading datasets into R will normally store them as <em>dataframes</em> (also known as <em>tibbles</em> when using the tidyverse). Dataframes are the equivalent of tables in a spreadsheet, with rows, columns and datatypes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a>PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2"></a>  <span class="fu">select</span>(CNT, PV1MATH, ESCS, IC172Q01JA) <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="#cb82-3"></a>  <span class="fu">mutate</span>(<span class="at">CNT =</span> CNT <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  CNT     PV1MATH   ESCS IC172Q01JA       
  &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;            
1 Albania    180.  1.11  Agree            
2 Albania    308. -3.05  Strongly disagree
3 Albania    268. -0.187 &lt;NA&gt;             
4 Albania    273. -3.22  Disagree         
5 Albania    435. -1.05  Agree            </code></pre>
</div>
</div>
<p>The table above has 4 columns, each column has a datatype, <code>CNT</code> is a character vector, PV1MATH is a double (numeric) vector, ESCS is a double (numeric) vector and <code>IC172Q01JA</code> is a factor. For more about datatypes, see <a href="#sec-datatypes" class="quarto-xref">Section&nbsp;3.4</a></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Core to the <em>tidyverse</em> is the idea of <em>tidy data</em>, a rule of thumb for creating data sets that can be easily manipulated, modeled and presented. <em>Tidy data</em> are data sets where each variable is a column and each observation a row.</p>
<p>This data isn’t tidy data as each row has contains multiple exam results (observations):</p>
<table class="caption-top table">
<thead><tr class="header">
<th>ID</th>
<th>Exam 1</th>
<th>Grade 1</th>
<th>Exam 2</th>
<th>Grade 2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>R2341</td>
<td>English</td>
<td>4</td>
<td>Maths</td>
<td>5</td>
</tr>
<tr class="even">
<td>R8842</td>
<td>English</td>
<td>5</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>This dataframe is tidy data as each student has one entry for each exam:</p>
<table class="caption-top table">
<thead><tr class="header">
<th>ID</th>
<th>Exam</th>
<th>Grade</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>R2341</td>
<td>English</td>
<td>4</td>
</tr>
<tr class="even">
<td>R2341</td>
<td>Maths</td>
<td>5</td>
</tr>
<tr class="odd">
<td>R8842</td>
<td>English</td>
<td>5</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>First we need to get some data into R so we can start analysing them. We can load large datatables into R by either providing the online web address, or by loading it from a local file directory on your hard drive. Both methods are covered below:</p>
</section><section id="loading-data-from-the-web" class="level1" data-number="9"><h1 data-number="9">
<span class="header-section-number">9</span> Loading data from the web</h1>
<p>To download files from the web you’ll need to find the exact location of the file you are using. For example below we will need another package, <code>openxlsx</code>, which you need to <em>install</em> before you load it (see: <a href="#sec-packages" class="quarto-xref">Section&nbsp;1.3</a>, or use line 1 below). The code shown will download the files from an online Google drive directly into objects in R using <code>read.xlsx(&lt;file_web_address&gt;, &lt;sheet_name&gt;)</code>:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To convert data on your google drive into a link that works in R, you can use the following website: <a href="https://sites.google.com/site/gdocs2direct/" class="uri">https://sites.google.com/site/gdocs2direct/</a>. Note that not all read/load commands in R will work with web addresses and some will require you have to copies of the data sets on your disk drive. Additionally, downloading large data sets from the web directly into R can be very slow, loading the data set from your hard drive will nearly always be <em>much</em> faster.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="fu">install.packages</span>(<span class="st">"openxlsx"</span>)</span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb84-3"><a href="#cb84-3"></a></span>
<span id="cb84-4"><a href="#cb84-4"></a>results <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">"https://drive.google.com/uc?export=download&amp;id=1tp9xe3dS__eg7RrXf0T_oMxcrz_TbMdM"</span>,</span>
<span id="cb84-5"><a href="#cb84-5"></a>                      <span class="at">sheet=</span><span class="st">"Results"</span>)</span>
<span id="cb84-6"><a href="#cb84-6"></a>schools <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">"https://drive.google.com/uc?export=download&amp;id=1tp9xe3dS__eg7RrXf0T_oMxcrz_TbMdM"</span>,</span>
<span id="cb84-7"><a href="#cb84-7"></a>                      <span class="at">sheet=</span><span class="st">"Schools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-loading-computer" class="level1" data-number="10"><h1 data-number="10">
<span class="header-section-number">10</span> Loading data from your computer</h1>
<p>Downloading files directly from web addresses can be slow and you might want to prefer to use files saved to your computer’s hard drive. You can do this by following the steps below:</p>
<p>Download the <code>PISA_student_2022_subset.parquet</code> file from <a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EUT13jrQxKJCp64WnH1MG3MBHoDqkzx1NJZIoVpUFHUYvg?e=pi2ZoD">here</a> and save it to your computer where your R code file is.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The PISA student dataset is huge, with over 1,200 pieces of information stored on 600,000+ students. This book uses a subset of this data, but if you do want the full dataset, you can download it from <a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EWdsEj9h3CJFmHqA-Qq5jQoBRSKGM_Qm_4Af_xomr2N5kw?e=JNnofI">here</a></p>
</div>
</div>
<p>Copy the location of the file (see next step for help)</p>
<ul>
<li>
<p>To find the location of a file in <strong><em>Windows</em></strong> do the following:</p>
<ol type="1">
<li>
<p>Navigate to the location of the file in <em>Windows Explorer</em>:</p>
<p><img src="images/navigate_file_location.png" class="img-fluid"></p>
</li>
<li>
<p>Click on the address bar</p>
<p><img src="images/select_file_location.png" class="img-fluid"></p>
</li>
<li><p>Copy the location</p></li>
</ol>
</li>
<li>
<p>To find the location of a file in <strong><em>Mac OSX</em></strong> do the following:</p>
<ol type="1">
<li><p>Open <em>Finder</em></p></li>
<li><p>Navigate to the folder where you saved the file</p></li>
<li>
<p>Right click on the name of the file, then press the <strong>option</strong> <code>⌥</code> (or <code>Alt</code>) button and select <code>Copy &lt;name of file&gt; as Pathname</code></p>
<p><img src="images/mac_pathnames.png" class="img-fluid"></p>
</li>
<li><p>Alternatively, follow <a href="https://support.apple.com/en-gb/guide/mac-help/mchlp1774/mac">this</a></p></li>
</ol>
</li>
</ul>
<p>To load this particular data into R we need to use the <code>read_parquet</code> command from the <code>arrow</code> package, specifying the location and name of the file we are loading. See the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="fu">install.packages</span>(<span class="st">"arrow"</span>)</span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="fu">library</span>(arrow)</span>
<span id="cb85-3"><a href="#cb85-3"></a></span>
<span id="cb85-4"><a href="#cb85-4"></a>PISA_2022 <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(r<span class="st">"[C:/Users/Peter/code/PISA_2022_student_subset.parquet]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="setting-working-directories" class="level1" data-number="11"><h1 data-number="11">
<span class="header-section-number">11</span> Setting working directories</h1>
<p>Using the <code>setwd(&lt;location&gt;)</code> you can specify where R will look by default for any datasets. In the example below, the <code>dfe_data.xlsx</code> will have been downloaded and stored in <code>C:/Users/Peter/code</code>. By running <code>setwd("C:/Users/Peter/code")</code> R will always look in that location when trying to load files, meaning that <code>read_parquet(r"[C:/Users/Peter/code/PISA_student_2022.parquet]")</code> will be treated the same as <code>read_parquet(r"[PISA_student_2022.parquet]")</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="co"># context: setup</span></span>
<span id="cb86-2"><a href="#cb86-2"></a><span class="fu">setwd</span>(r<span class="st">"[C:/Users/Peter/code/]"</span>)</span>
<span id="cb86-3"><a href="#cb86-3"></a>PISA_2022 <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(r<span class="st">"[PISA_student_2022.parquet]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To work out what your current working directory is, you can use <code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code>.</p>
<section id="proper-addresses" class="level2" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="proper-addresses">
<span class="header-section-number">11.1</span> Proper addresses</h2>
<p>You might have found that you get an error if you don’t convert your backslashes <code>\</code> into forwardslashes <code>/</code>. It’s common mistake and very annoying. In most programming languages a backslash signifies the start of a special command, for example <code>\n</code> signifies a <code>newline</code>.</p>
<p>With R there are three ways to get around the problem of backslashes in file locations, for the location:<code>"C:\myfolder\"</code> we could:</p>
<ul>
<li>replace them with forwardslashes (as shown above):<code>"C:/myfolder/"</code>
</li>
<li>replace them with double backslashes (the special character specified by two backslashes is one backslash!):<code>"C:\\myfolder\\"</code>
</li>
<li>use the inbuilt R command to deal with filenames: <code>r"[C:\myfolder\]"</code>
</li>
</ul></section></section><section id="sec-parquet" class="level1" data-number="12"><h1 data-number="12">
<span class="header-section-number">12</span> .parquet and .feather files</h1>
<p>For the majority of this workbook you will be using a cut down version of the <code>PISA_2022</code> student table. This data set is huge and we have loaded it into R, selected fields we think are useful, converted column types to work with R and saved in the <code>.parquet</code> format. <code>.parquet</code> files are quick to load and small in size. To load a <code>.parquet</code> file you can use the <code>read_parquet(&lt;location&gt;)</code> command from the <a href="https://github.com/apache/arrow/">arrow</a> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb87-2"><a href="#cb87-2"></a>PISA_2022 <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(<span class="st">"&lt;yourfolder&gt;/PISA_student_2022_subset.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to save out any of your findings, you can use <code>write_parquet(&lt;object&gt;, &lt;location&gt;)</code>, where <code>object</code> is the table you are working on and <code>location</code> is where you want to save it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="fu">write_parquet</span>(PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"France"</span>), <span class="st">"&lt;yourfolder&gt;/pisa_france_2022.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>.parquet</code> files use a column based storage system, which means that they are very quick to load as they can use multiple processors when loading data, you can also specify which columns you want to load when loading the data using the <code>col_select =</code> attribute, meaning you don’t have to waste time loading all columns then de-selecting those you don’t want:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb89-2"><a href="#cb89-2"></a>PISA_2022 <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(<span class="st">"&lt;yourfolder&gt;/PISA_student_2022_subset.parquet"</span>,</span>
<span id="cb89-3"><a href="#cb89-3"></a>                          <span class="at">col_select =</span> <span class="fu">c</span>(<span class="st">"CNT"</span>, <span class="st">"PV1MATH"</span>, <span class="st">"PV1READ"</span>, <span class="st">"PV1SCIE"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>.parquet</code> files are compressed meaning the files will also be small as well as fast. If speed is your real focus, you might want to use <code>.feather</code> files instead. They have the same functionality as <code>.parquet</code> files, but are even faster to load. You can use the <code>read_feather</code> and <code>write_feather</code> commands from the <a href="https://github.com/apache/arrow/">arrow</a> package to load and save <code>.feather</code> files.</p>
</section><section id="csv-files" class="level1" data-number="13"><h1 data-number="13">
<span class="header-section-number">13</span> .csv files</h1>
<p>A very common way of distributing data is through <code>.csv</code> files. These files can be easily compressed and opened in common office spreadsheet tools such as Excel. To load a <code>.csv</code> we can use <code>read_csv("&lt;file_location&gt;")</code> from the <a href="https://tidyverse.tidyverse.org">tidyverse</a>. There is also the similarly named <code>read.csv("&lt;file_location&gt;")</code> but this is slower.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="co"># loading from a website</span></span>
<span id="cb90-3"><a href="#cb90-3"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://barrolee.github.io/BarroLeeDataSet/BLData/BL_v3_MF.csv"</span>)</span>
<span id="cb90-4"><a href="#cb90-4"></a></span>
<span id="cb90-5"><a href="#cb90-5"></a><span class="co"># loading from your hard drive</span></span>
<span id="cb90-6"><a href="#cb90-6"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"&lt;your_folder&gt;/BL_v3_MF.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You might want to save your own work as a <code>.csv</code> for use later or for manipulation in another tool e.g.&nbsp;Excel. To do this we can use <code>write_csv(&lt;your_data&gt;, "&lt;your_folder&gt;&lt;name&gt;.csv")</code>. <strong>NOTE</strong>: don’t forget to add <code>.csv</code> to the end of your “<your_folder><name><strong>.csv</strong>”, otherwise you might struggle to open the file in another program.</name></your_folder></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="co"># saving your results to a file called `summary_stats.csv`</span></span>
<span id="cb91-3"><a href="#cb91-3"></a><span class="fu">write_csv</span>(my_results, <span class="st">"C:/tmp/summary_stats.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="spss-.sav" class="level1" data-number="14"><h1 data-number="14">
<span class="header-section-number">14</span> SPSS / .sav</h1>
<p>SPSS is a common tool in social science and psychology. The data format used by SPSS is <code>.sav</code>. These files can be loaded directly into R using the <a href="https://haven.tidyverse.org">haven</a> package’s <code>read_sav</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb92-2"><a href="#cb92-2"></a>data <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"&lt;your_folder&gt;/data.sav"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>.sav</code> files can look very different to your standard R data frame. They will contain information on the types of data stored in each column, as well as the <em>labels</em> for each column. You can see this information by using the <code>attributes</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="fu">attributes</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="xml" class="level1" data-number="15"><h1 data-number="15">
<span class="header-section-number">15</span> .xml</h1>
</section><section id="json" class="level1" data-number="16"><h1 data-number="16">
<span class="header-section-number">16</span> .json</h1>
</section><section id="writing-excel-files" class="level1" data-number="17"><h1 data-number="17">
<span class="header-section-number">17</span> Writing excel files</h1>
<p>You might prefer to save your results in an Excel file, this can be done using the <code>write.xlsx</code> command from the <a href="https://ycphs.github.io/openxlsx/index.html">openxlsx</a> package. This command will save your data frame as an Excel file in the location you specify:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb94-2"><a href="#cb94-2"></a><span class="fu">write.xlsx</span>(my_results, <span class="st">"&lt;your_folder&gt;/data.xlsx"</span>)</span>
<span id="cb94-3"><a href="#cb94-3"></a></span>
<span id="cb94-4"><a href="#cb94-4"></a><span class="co"># https://assets.publishing.service.gov.uk/media/65c4903a3f634b001242c696/Confirmed_raac_with_removal_routes.xlsx</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, you might want to create a new excel file with multiple sheets. <a href="https://ycphs.github.io/openxlsx/index.html">openxlsx</a> allows you to do this by creating a workbook, adding named sheets to it and then saving it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb95-2"><a href="#cb95-2"></a></span>
<span id="cb95-3"><a href="#cb95-3"></a><span class="co"># get data</span></span>
<span id="cb95-4"><a href="#cb95-4"></a>df_UK     <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb95-5"><a href="#cb95-5"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"UK"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-6"><a href="#cb95-6"></a>  <span class="fu">select</span>(CNT, PV1MATH, PV1READ, PV1SCIE)</span>
<span id="cb95-7"><a href="#cb95-7"></a></span>
<span id="cb95-8"><a href="#cb95-8"></a>df_France <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb95-9"><a href="#cb95-9"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"France"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-10"><a href="#cb95-10"></a>  <span class="fu">select</span>(CNT, PV1MATH, PV1READ, PV1SCIE)</span>
<span id="cb95-11"><a href="#cb95-11"></a></span>
<span id="cb95-12"><a href="#cb95-12"></a><span class="co"># create an empty workbook</span></span>
<span id="cb95-13"><a href="#cb95-13"></a>wb <span class="ot">&lt;-</span> <span class="fu">createWorkbook</span>()</span>
<span id="cb95-14"><a href="#cb95-14"></a></span>
<span id="cb95-15"><a href="#cb95-15"></a><span class="co"># add two empty worksheets</span></span>
<span id="cb95-16"><a href="#cb95-16"></a><span class="fu">addWorksheet</span>(wb, <span class="st">"UK data"</span>)</span>
<span id="cb95-17"><a href="#cb95-17"></a><span class="fu">addWorksheet</span>(wb, <span class="st">"France data"</span>)</span>
<span id="cb95-18"><a href="#cb95-18"></a></span>
<span id="cb95-19"><a href="#cb95-19"></a><span class="co"># add data to sheet: UK data</span></span>
<span id="cb95-20"><a href="#cb95-20"></a><span class="fu">writeData</span>(wb, <span class="st">"UK data"</span>, df_UK)</span>
<span id="cb95-21"><a href="#cb95-21"></a></span>
<span id="cb95-22"><a href="#cb95-22"></a><span class="co"># add data to sheet: France data</span></span>
<span id="cb95-23"><a href="#cb95-23"></a><span class="fu">writeData</span>(wb, <span class="st">"France data"</span>, df_France)</span>
<span id="cb95-24"><a href="#cb95-24"></a></span>
<span id="cb95-25"><a href="#cb95-25"></a><span class="co"># save the workbook to your computer</span></span>
<span id="cb95-26"><a href="#cb95-26"></a><span class="fu">saveWorkbook</span>(wb, <span class="st">"&lt;your_folder&gt;/my_workbook.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://ycphs.github.io/openxlsx/index.html">openxlsx</a> does a lot more, including allowing you to format cells.</p>


</section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>As of December 2022, <a href="https://www.tiobe.com/tiobe-index/">Tiobe</a> has R as the 11th most popular programming language. Many other, contradictory, ranking systems exist.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><code>camelCase</code> has a capital letter in the front or front and middle forming the camel’s hump(s), there are multiple <a href="https://en.wikipedia.org/wiki/Naming_convention_(programming)">naming conventions</a>, it doesn’t matter which you pick, just stick to one of them.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>R was created to allow for <a href="https://en.wikipedia.org/wiki/Array_programming"><em>vector programming</em></a>, that is a programming language where you can apply operations to entire sets of values (vectors) at the same time, rather than having to cycle through them individually. Vector languages work in a way that is close to how mathematical notation works, making them well suited for performing mathematical functions.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>You’ll sometimes see the words package and library used interchangeably, technically the <em>library</em> is the place where the <em>packages</em> are stored.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>