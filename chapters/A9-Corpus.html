<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Corpus Analysis – ECSR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../css/mastemr.css">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="index.qmd" class="navbar-brand navbar-brand-logo">
    <img src="../images/KCL_logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="index.qmd">
    <span class="navbar-title">ECSR</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/A9-Corpus.html">Corpus analysis</a></li><li class="breadcrumb-item"><a href="../chapters/A9-Corpus.html">Corpus Analysis</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-1-Loading_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-2-Intro_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loading packages and exploring data</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction to Stats</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-1-Descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Descriptive Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-2-ChisqPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis testing and Chi-square tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-3-T-testsPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T-tests</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Intro_to_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making graphs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Corpus analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A9-Corpus.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Corpus Analysis</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Publications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-Rpublications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Publishing using R and quarto</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-PISA_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PISA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-DfE_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DfE England</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A3-TIMSS_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TIMSS, PIRLS and ICILS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A4-Other_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A5-Self_Study_Tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self Study Tasks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A6-selecting_statistical_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selecting statistical tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A7-QandA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Questions and Answers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A10-Leaflet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Leaflet</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#corpus-analysis" id="toc-corpus-analysis" class="nav-link active" data-scroll-target="#corpus-analysis"><span class="header-section-number">1</span> Corpus Analysis</a>
  <ul class="collapse">
<li><a href="#corpus-analysis-in-r---quanteda" id="toc-corpus-analysis-in-r---quanteda" class="nav-link" data-scroll-target="#corpus-analysis-in-r---quanteda"><span class="header-section-number">1.1</span> Corpus Analysis in R - quanteda</a></li>
  <li><a href="#creating-a-corpus" id="toc-creating-a-corpus" class="nav-link" data-scroll-target="#creating-a-corpus"><span class="header-section-number">1.2</span> Creating a corpus</a></li>
  <li><a href="#basic-analysis-in-quanteda" id="toc-basic-analysis-in-quanteda" class="nav-link" data-scroll-target="#basic-analysis-in-quanteda"><span class="header-section-number">1.3</span> Basic analysis in quanteda</a></li>
  <li><a href="#word-frequencies" id="toc-word-frequencies" class="nav-link" data-scroll-target="#word-frequencies"><span class="header-section-number">1.4</span> Word frequencies</a></li>
  <li>
<a href="#cleaning-transcripts" id="toc-cleaning-transcripts" class="nav-link" data-scroll-target="#cleaning-transcripts"><span class="header-section-number">1.5</span> Cleaning transcripts</a>
  <ul class="collapse">
<li><a href="#creating-a-custom-dictionary" id="toc-creating-a-custom-dictionary" class="nav-link" data-scroll-target="#creating-a-custom-dictionary"><span class="header-section-number">1.5.1</span> Creating a custom dictionary</a></li>
  </ul>
</li>
  <li><a href="#word-clouds" id="toc-word-clouds" class="nav-link" data-scroll-target="#word-clouds"><span class="header-section-number">1.6</span> Word clouds</a></li>
  <li><a href="#lexical-dispersion-plots" id="toc-lexical-dispersion-plots" class="nav-link" data-scroll-target="#lexical-dispersion-plots"><span class="header-section-number">1.7</span> Lexical dispersion plots</a></li>
  <li><a href="#network-analysis" id="toc-network-analysis" class="nav-link" data-scroll-target="#network-analysis"><span class="header-section-number">1.8</span> Network analysis</a></li>
  <li><a href="#sentiment-analysis" id="toc-sentiment-analysis" class="nav-link" data-scroll-target="#sentiment-analysis"><span class="header-section-number">1.9</span> Sentiment analysis</a></li>
  <li><a href="#comparison-of-sameness-of-documents" id="toc-comparison-of-sameness-of-documents" class="nav-link" data-scroll-target="#comparison-of-sameness-of-documents"><span class="header-section-number">1.10</span> Comparison of sameness of documents</a></li>
  <li><a href="#keyness" id="toc-keyness" class="nav-link" data-scroll-target="#keyness"><span class="header-section-number">1.11</span> Keyness</a></li>
  <li><a href="#topic-models" id="toc-topic-models" class="nav-link" data-scroll-target="#topic-models"><span class="header-section-number">1.12</span> Topic models</a></li>
  <li>
<a href="#seminar-activities" id="toc-seminar-activities" class="nav-link" data-scroll-target="#seminar-activities"><span class="header-section-number">1.13</span> Seminar activities</a>
  <ul class="collapse">
<li><a href="#task-1-word-clouds" id="toc-task-1-word-clouds" class="nav-link" data-scroll-target="#task-1-word-clouds"><span class="header-section-number">1.13.1</span> Task 1 Word clouds</a></li>
  <li><a href="#task-2-wordclouds-and-network-analysis" id="toc-task-2-wordclouds-and-network-analysis" class="nav-link" data-scroll-target="#task-2-wordclouds-and-network-analysis"><span class="header-section-number">1.13.2</span> Task 2 wordclouds and network analysis</a></li>
  <li><a href="#task-3-keyness-analysis" id="toc-task-3-keyness-analysis" class="nav-link" data-scroll-target="#task-3-keyness-analysis"><span class="header-section-number">1.13.3</span> Task 3 keyness analysis</a></li>
  <li><a href="#task-4-lexical-disperssion-plot" id="toc-task-4-lexical-disperssion-plot" class="nav-link" data-scroll-target="#task-4-lexical-disperssion-plot"><span class="header-section-number">1.13.4</span> Task 4 lexical disperssion plot</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#analysing-ofsted-reports" id="toc-analysing-ofsted-reports" class="nav-link" data-scroll-target="#analysing-ofsted-reports"><span class="header-section-number">2</span> Analysing ofsted reports</a>
  <ul class="collapse">
<li><a href="#task-1---tracking-policies-over-time" id="toc-task-1---tracking-policies-over-time" class="nav-link" data-scroll-target="#task-1---tracking-policies-over-time"><span class="header-section-number">2.1</span> Task 1 - Tracking policies over time</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/A9-Corpus.html">Corpus analysis</a></li><li class="breadcrumb-item"><a href="../chapters/A9-Corpus.html">Corpus Analysis</a></li></ol></nav><div class="quarto-title">
<h1 class="title">Corpus Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="corpus-analysis" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Corpus Analysis</h1>
<p>Corpus analysis is the empirical study of lingusitic patterns associated with language use in different contexts, often now carried out using computer-based approaches.</p>
<section id="corpus-analysis-in-r---quanteda" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="corpus-analysis-in-r---quanteda">
<span class="header-section-number">1.1</span> Corpus Analysis in R - quanteda</h2>
<p>One of the most widely used packages for corpus analysis in R is the <code>quanteda</code> package. <code>quanteda</code> is a comprehensive package that allows researchers to manage corpora and carry out a wide range of analyses on them. To install <code>quanteda</code>, use the following code, if this is the first time you are using the package you will need to include the <code>install.packages("quanteda")</code> function. We will also load the <code>tidyverse</code> package, which is a collection of packages that are commonly used in data analysis in R.</p>
</section><section id="creating-a-corpus" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="creating-a-corpus">
<span class="header-section-number">1.2</span> Creating a corpus</h2>
<p>Typically, the first step in a corpus analysis project is to create a corpus object. A corpus object is a collection of texts that can be analysed together. In <code>quanteda</code>, a corpus object can be created from a variety of sources, including text files, data frames, and character vectors. There are a number of different approaches to reading in textual data.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The data in this teaching page are drawn from <a href="https://talkbank.org/">talkbank.org</a>, a repository of spoken language data. The data are from the UK component of the <a href="https://childes.talkbank.org/">CHILDES database</a>, which is a collection of transcripts of child language development.</p>
<p>An acknowledgement of the data set is shown below:</p>
<p>CHILDES: MacWhinney, B. (2000). The CHILDES Project: Tools for analyzing talk. Third Edition. Mahwah, NJ: Lawrence Erlbaum Associates. Note: Please also acknowledge this grant support for CHILDES – NICHD HD082736.</p>
</div>
</div>
<p>First data may be read from a text file. You can download three example files here: <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/EfGOaTVNMwBBuiYc_octNUABd3Y4vi5qj2SBQoykEaOcEQ?e=bIWa8j">CHILDES project Gathburn 11</a>. <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/EUxpr433q-xFohi_z7-E5GEBn8j63CuN7QmkX0Z0bKRcHw?e=dPAGVq">CHILDES project Gathburn 12</a>. <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/EbN7Y-6BFq1Dh8JTq_cFuNwB55wmgjnStz9odTtpaZCu7Q?e=Rw5dyk">CHILDES project Gathburn 13</a>.</p>
<p>The files are records of conversations between some children and a teacher. The speakers in the transcript are given the following codes:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th>Transcript</th>
<th>Speaker 1</th>
<th>Speaker 2</th>
<th>Speaker 3</th>
<th>Speaker 4</th>
<th>Speaker 5</th>
<th>Speaker 6</th>
<th>Speaker 7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Transcript 11</td>
<td>STE Teacher</td>
<td>LOU Child</td>
<td>JER Child</td>
<td>CAT Child</td>
<td>CHR Child</td>
<td>ALL Child</td>
<td>UNK Child</td>
</tr>
<tr class="even">
<td>Transcript 12</td>
<td>STE Teacher</td>
<td>NAN Child</td>
<td>GEO Child</td>
<td>RIT Child</td>
<td>BAR Child</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Transcript 13</td>
<td>STE Teacher</td>
<td>GER Child</td>
<td>STE Teacher</td>
<td>KAT Child</td>
<td>VID Child</td>
<td>JAS Child</td>
<td>ALL Child</td>
</tr>
</tbody>
</table>
<p>You can load files singly or as a group. The code below shows how to load a single file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Please replace the file path with the path to the file on your computer</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>transcript_11 <span class="ot">&lt;-</span> <span class="fu">readlines</span>(<span class="st">"&lt;file path&gt;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>it is common to have a number of files that you want to load in together. The package <code>readtext</code> can be used to read in multiple files at once. The code below shows how to load in all the files in a folder. Using the <code>readtext</code> function, you can read in all the files in a folder by giving the path of the folder, rather than a fie.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># You will need to copy the address of the folder on your computer into the quotation marks below</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># For example on my laptop the path name is: /Users/k1765032/Library/CloudStorage/OneDrive-King'sCollegeLondon/QERKCL_PISA/data/corpus/Talk Bank/CHILDES/*.txt</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="fu">library</span>(readtext)</span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a>CHILDES_text <span class="ot">&lt;-</span> <span class="fu">readtext</span>(<span class="st">"data/folder/*.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To find the path to a file:</p>
<p>On a PC: hold Shift and right-click the file or folder, then select “Copy as Path” from the context menu.</p>
<p>On a Mac: hold down the Option key and right-click the file or folder, then select “Copy as Pathname” from the context menu.</p>
</div>
</div>
<p>Once the text files have been read in, they need to be converted to a format <code>quanteda</code> can work with. This is done using the <code>corpus</code> function. The code below shows how to convert the <code>CHILDES_text</code> object to a corpus object. You can think of a corpus like a library of the documents you are using in your project.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Converting a text file to a corpus object</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>CHILDES_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(CHILDES_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="basic-analysis-in-quanteda" class="level2" data-number="1.3"><h2 data-number="1.3" class="anchored" data-anchor-id="basic-analysis-in-quanteda">
<span class="header-section-number">1.3</span> Basic analysis in quanteda</h2>
<p>Once you have created a corpus object, you can carry out a range of analyses on it. The <code>quanteda</code> package provides a wide range of functions for analysing corpora. A first step is geting some summary descriptive statistics related to your corpus. The code below shows how to get a summary of the corpus object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># A simple descriptive summary of the corpus</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">summary</span>(CHILDES_corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 3 documents, showing 3 documents:

                    Text Types Tokens Sentences
 CHILDES_Gathburn_11.txt   595   9252      1012
 CHILDES_Gathburn_12.txt   605   6157       712
 CHILDES_Gathburn_13.txt   688   8629       983</code></pre>
</div>
</div>
<p>In quanteda, types and tokens refer to different ways of counting the unique and total words in a corpus:</p>
<p>Tokens: This refers to the total number of words (or word-like units) in the corpus, including repetitions. Each individual occurrence of a word, regardless of whether it appears elsewhere in the corpus, counts as a token. Types: This refers to the number of unique words in the corpus, disregarding any repetitions. A type is counted only once, no matter how many times it appears in the text.</p>
<p>You may want to add some metadata to your corpus object. This can be done using the <code>docvars</code> function. The code below shows how to add metadata to the <code>CHILDES_corpus</code> object. For example, each file has different number of speakers, and you may want to add this information to the corpus object.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th>Transcript</th>
<th>Speaker 1</th>
<th>Speaker 2</th>
<th>Speaker 3</th>
<th>Speaker 4</th>
<th>Speaker 5</th>
<th>Speaker 6</th>
<th>Speaker 7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Transcript 11</td>
<td>STE Teacher</td>
<td>LOU Child</td>
<td>JER Child</td>
<td>CAT Child</td>
<td>CHR Child</td>
<td>ALL Child</td>
<td>UNK Child</td>
</tr>
<tr class="even">
<td>Transcript 12</td>
<td>STE Teacher</td>
<td>NAN Child</td>
<td>GEO Child</td>
<td>RIT Child</td>
<td>BAR Child</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Transcript 13</td>
<td>STE Teacher</td>
<td>GER Child</td>
<td>STE Teacher</td>
<td>KAT Child</td>
<td>VID Child</td>
<td>JAS Child</td>
<td>ALL Child</td>
</tr>
</tbody>
</table>
<p>You can use the <code>docvars</code> function to add metadata to the corpus object. The code below shows how to add the number of speakers to the <code>CHILDES_corpus</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Adding metadata to the corpus</span></span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># Adding to row 1 (i.e. transcript 11) CHILDES_corpus[1]</span></span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="fu">docvars</span>(CHILDES_corpus, <span class="st">"no_of_speakers"</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">7</span>)</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="fu">summary</span>(CHILDES_corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 3 documents, showing 3 documents:

                    Text Types Tokens Sentences no_of_speakers
 CHILDES_Gathburn_11.txt   595   9252      1012              7
 CHILDES_Gathburn_12.txt   605   6157       712              5
 CHILDES_Gathburn_13.txt   688   8629       983              7</code></pre>
</div>
</div>
<p>To view your corpus you can <code>as.character</code> function. This will show you the text in the corpus object. Be careful, this can produce a long output! You can print out elements of the corpus object using the <code>as.character(CHILDES_corpus[3])</code> gives the third text: CHILDES_Gathburn_13.txt.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Printing</span></span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="fu">as.character</span>(CHILDES_corpus[<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to filter the corpus, you can use the <code>corpus_subset</code> function. This function allows you to filter the corpus object based on the metadata you have added. The code below shows how to filter the <code>CHILDES_corpus</code> object to only include the texts with 7 speakers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Creating a new corpus which contain transcripts with 7 speakers</span></span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>CHILDES_corpus_7 <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(CHILDES_corpus, no_of_speakers <span class="sc">==</span> <span class="dv">7</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="fu">summary</span>(CHILDES_corpus_7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 2 documents, showing 2 documents:

                    Text Types Tokens Sentences no_of_speakers
 CHILDES_Gathburn_11.txt   595   9252      1012              7
 CHILDES_Gathburn_13.txt   688   8629       983              7</code></pre>
</div>
</div>
<p>To start investigating the text in the corpus, you can use the <code>kwic</code> function. The <code>kwic</code>, key words in context, function allows you to search for a word or phrase in the corpus and see the context in which it appears. The code below shows how to use the <code>kwic</code> function to search for the word “teacher” in the <code>CHILDES_corpus</code> object. The first step in the process is to convert the corpus into a tokens object (i.e.&nbsp;to break it into individual words). This is done using the <code>tokens</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Doing a key word in context search</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co"># Tokenising the corpus</span></span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a>CHILDES_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(CHILDES_corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then the keywords in context search can be performed. The code below shows how to use the <code>kwic</code> function to search for the word “teacher” in the <code>CHILDES_tokens</code> object. The <code>pattern</code> argument is used to specify the word or phrase you want to search for, for example here the word “want”. You can use the `window argument to set how many tokens eithe side of the keyword you want to see. Here we have set the window to 10.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Doing a key word in context search</span></span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="fu">kwic</span>(CHILDES_tokens, <span class="at">pattern =</span> <span class="st">"want"</span>, <span class="at">window =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keyword-in-context with 28 matches.                                                                              
 [CHILDES_Gathburn_11.txt, 4986]                     put [/ ] this goes [/ ] I
 [CHILDES_Gathburn_11.txt, 5351]                 couple more. STE: mhm. CAT: I
 [CHILDES_Gathburn_11.txt, 5969]                   STE: here you are. JER: &lt; I
 [CHILDES_Gathburn_11.txt, 6005]                         : xxx [ &gt; ]. JER: &lt; I
 [CHILDES_Gathburn_11.txt, 6031]             ones, haven't you, Jeremy. JER: I
 [CHILDES_Gathburn_11.txt, 6047]                       : mhm. STE: xxx. JER: I
                                                    
 | want | [/ ] this &lt; goes like &gt; [ &gt;               
 | want | &lt; to go back to the nursery &gt; [*          
 | want | more &gt; [ &gt; ] white ones. LOU:             
 | want | more white ones &gt; [ &lt; ]. STE:             
 | want | more white ones. STE: mhm. STE:           
 | want | more white ones. STE: you want more white 
 [ reached 'max' / getOption("max.print") -- omitted 22 rows ]</code></pre>
</div>
</div>
<p>You can carry out a more flexible range of searches using regular expressions (regex). Regex is a sequence of characters that specifies a match pattern in text.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For more information on regular expressions, see the <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html">R documentation</a>.</p>
<p>The following symbols can be useful in</p>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead><tr class="header">
<th>Pattern</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>.</td>
<td>Any single character except a newline</td>
</tr>
<tr class="even">
<td>^</td>
<td>Beginning of String (or Line)</td>
</tr>
<tr class="odd">
<td>$</td>
<td>End of String (or Line)</td>
</tr>
<tr class="even">
<td>[]</td>
<td>A set of characters, e.g., [a-z] for lowercase letters</td>
</tr>
<tr class="odd">
<td>[^]</td>
<td>Negation inside square brackets, e.g., [^a-z] for non-lowercase letters</td>
</tr>
<tr class="even">
<td>()</td>
<td>Grouping (capturing group), used for subpatterns</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td>*</td>
<td>0 or more of the preceding element</td>
</tr>
<tr class="odd">
<td>+</td>
<td>1 or more of the preceding element</td>
</tr>
<tr class="even">
<td>?</td>
<td>0 or 1 of the preceding element (optional)</td>
</tr>
<tr class="odd">
<td>{n}</td>
<td>Exactly n occurrences of the preceding element</td>
</tr>
<tr class="even">
<td>{n,}</td>
<td>n or more occurrences of the preceding element</td>
</tr>
<tr class="odd">
<td>{n,m}</td>
<td>Between n and m occurrences of the preceding element</td>
</tr>
<tr class="even">
<td>b</td>
<td>Word boundary (matches between word and non-word characters)</td>
</tr>
<tr class="odd">
<td>B</td>
<td>Not a word boundary</td>
</tr>
<tr class="even">
<td>A</td>
<td>Beginning of the string (similar to <code>^</code> but anchors the start of the whole string)</td>
</tr>
<tr class="odd">
<td>Z</td>
<td>End of the string (similar to <code>$</code> but anchors the end of the whole string)</td>
</tr>
<tr class="even">
<td>\1, \2, …</td>
<td>Backreference to capturing groups, e.g., \1 refers to the first captured group</td>
</tr>
<tr class="odd">
<td>(?=…)</td>
<td>Positive lookahead (assertion, matches a position only if the pattern inside matches)</td>
</tr>
<tr class="even">
<td>(?!…)</td>
<td>Negative lookahead (assertion, matches a position only if the pattern inside does not match)</td>
</tr>
<tr class="odd">
<td>(?&lt;=…)</td>
<td>Positive lookbehind (matches if preceded by a pattern)</td>
</tr>
<tr class="even">
<td>(?&lt;!…)</td>
<td>Negative lookbehind (matches if not preceded by a pattern)</td>
</tr>
<tr class="odd">
<td>[:alpha:]</td>
<td>Any letter</td>
</tr>
<tr class="even">
<td>[:lower:]</td>
<td>Any lowercase letter</td>
</tr>
<tr class="odd">
<td>[:upper:]</td>
<td>Any uppercase letter</td>
</tr>
<tr class="even">
<td>[:digit:]</td>
<td>Any digit (equivalent to </td>
</tr>
<tr class="odd">
<td>[:alnum:]</td>
<td>Any letter or number</td>
</tr>
<tr class="even">
<td>[:xdigit:]</td>
<td>Any hexadecimal digit</td>
</tr>
<tr class="odd">
<td>[:punct:]</td>
<td>Any punctuation character</td>
</tr>
<tr class="even">
<td>[:graph:]</td>
<td>Any letter, number, or punctuation character</td>
</tr>
<tr class="odd">
<td>[:space:]</td>
<td>A space, a tab, a new line, etc. (equivalent to )</td>
</tr>
</tbody>
</table>
<p>For example: - the regex <code>^mini</code> will match any word that starts with “mini”. - the regex <code>able$</code> will match any word that ends with “able”. - the regex <code>colou?r</code> matches both “color” and “colour”. - the regex <code>[J|j]ane</code> matches both “Jane” and “jane”.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is a great blog post <a href="https://blog.djnavarro.net/posts/2024-12-16_regex-backreferences/#backslashes-part-i">Baby got backreferences</a> which gives a great introduction to regex (using song lyrics as examples!)</p>
</div>
</div>
<p>To perform a regex search, you can use the <code>kwic</code> function with the <code>pattern</code> argument set to the regex pattern you want to search for. The code below shows how to use the <code>kwic</code> function to search for words that start with “teach” in the <code>CHILDES_tokens</code> object. You also need to set the <code>valuetype</code> argument to “regex” to indicate that the pattern is a regex pattern. For example, to search for all cases of words that start with “dad” or “Dad” you can use the regex pattern <code>^[D/d]ad</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Doing a key word in context search wtih regex</span></span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="fu">kwic</span>(CHILDES_tokens, <span class="at">pattern =</span> <span class="st">"^[D/d]ad"</span>, <span class="at">window =</span> <span class="dv">10</span>, <span class="at">valuetype =</span> <span class="st">"regex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keyword-in-context with 11 matches.                                                                         
  [CHILDES_Gathburn_12.txt, 957]        wheel (. ) no brakes. STE: your |
  [CHILDES_Gathburn_12.txt, 976]                it? GEO: hm:? STE: your |
 [CHILDES_Gathburn_12.txt, 1062]          . GEO: one. STE: I heard your |
 [CHILDES_Gathburn_12.txt, 2003]             a [/ ] making a. STE: your |
 [CHILDES_Gathburn_12.txt, 3179] door? NAN: he lives with his mommy and |
 [CHILDES_Gathburn_13.txt, 1710]          GER: yes, except mine [/ ] my |
                                                            
 Daddy's | car won't steer with no brakes, does it?         
 Daddy's | car won't steer with no brakes [* ].             
 Daddy's | xxx jobs with vans. NAN: 0 [%                    
   dad   | have a car, Rita? RIT: 0 [                       
  daddy  | . STE: yes, but do they live very                
  daddy  | . GER: he hates [! ] dark.                       
 [ reached 'max' / getOption("max.print") -- omitted 5 rows ]</code></pre>
</div>
</div>
<p>Note that you can output the result of <code>kwic</code> search to a dataframe and then use ggplot to represent the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Doing a key word in context search wtih regex and plotting</span></span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>dad_search <span class="ot">&lt;-</span> <span class="fu">kwic</span>(CHILDES_tokens, <span class="at">pattern =</span> <span class="st">"^[D/d]ad"</span>, <span class="at">window =</span> <span class="dv">10</span>, <span class="at">valuetype =</span> <span class="st">"regex"</span>)</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="fu">ggplot</span>(dad_search, <span class="fu">aes</span>(<span class="at">x =</span> keyword, <span class="at">fill =</span> keyword)) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Occurrences of 'dad' in CHILDES corpus"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>If you want to look up longer phrases, you can give a <code>pattern</code> within <code>phrase()</code>. For example <code>pattern = phrase("I want more")</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># searching for a phrase</span></span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="fu">kwic</span>(CHILDES_tokens, <span class="at">pattern =</span> <span class="fu">phrase</span>(<span class="st">"I want more"</span>), <span class="at">window =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keyword-in-context with 12 matches.                                                                             
 [CHILDES_Gathburn_11.txt, 5968:5970]           . STE: here you are. JER: &lt; |
 [CHILDES_Gathburn_11.txt, 6004:6006]                STE: xxx [ &gt; ]. JER: &lt; |
 [CHILDES_Gathburn_11.txt, 6030:6032] white ones, haven't you, Jeremy. JER: |
 [CHILDES_Gathburn_11.txt, 6046:6048]              STE: mhm. STE: xxx. JER: |
 [CHILDES_Gathburn_11.txt, 6301:6303]              : 0 [ = aids CAT ]. JER: |
 [CHILDES_Gathburn_11.txt, 6328:6330]              &lt; ]. STE: whoops. JER: &lt; |
                                                        
 I want more | &gt; [ &gt; ] white ones. LOU: there           
 I want more | white ones &gt; [ &lt; ]. STE: oh              
 I want more | white ones. STE: mhm. STE: xxx           
 I want more | white ones. STE: you want more white ones
 I want more | wee bits (. ) to put like that.          
 I want more | bits &gt; [ &gt; ]. STE: xxx [                 
 [ reached 'max' / getOption("max.print") -- omitted 6 rows ]</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>An alternative way to represent where words occur in a text is to use the <code>str_view</code> function from the <code>stringr</code> package, which highlights matches:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="co"># Read in lyrics of Bohemain Rhapsody from Github</span></span>
<span id="cb19-4"><a href="#cb19-4"></a></span>
<span id="cb19-5"><a href="#cb19-5"></a>url <span class="ot">&lt;-</span> <span class="st">"https://gist.githubusercontent.com/matematikaadit/3a513cc5fe6ebb9565ee1584e2b4f00d/raw/"</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>file_content <span class="ot">&lt;-</span> <span class="fu">readLines</span>(url)</span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="fu">str_view</span>(file_content, <span class="st">"poor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[10] │ I'm just a &lt;poor&gt; boy, I need no sympathy,
[45] │ I'm just a &lt;poor&gt; boy, nobody loves me.
[46] │ He's just a &lt;poor&gt; boy from a &lt;poor&gt; family,</code></pre>
</div>
</div>
</div>
</div>
</section><section id="word-frequencies" class="level2" data-number="1.4"><h2 data-number="1.4" class="anchored" data-anchor-id="word-frequencies">
<span class="header-section-number">1.4</span> Word frequencies</h2>
<p>You can also examine the frequency of words in the corpus. The document-feature matrix (DFM) allows you to see the frequency of words in the corpus. The code below shows how to create a DFM object from the <code>CHILDES_tokens</code> object. The <code>dfm</code> function is used to create the DFM object. Then the <code>featfreq</code> function is used to get the word frequencies. Note you can concert the output to a dataframe using <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> which will allow further processing and use with other packages such as <code>ggplot</code> to make graphs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Create a document-feature matrix (DFM)</span></span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a>dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(CHILDES_tokens)</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="co"># Get word frequencies</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>word_frequencies <span class="ot">&lt;-</span> <span class="fu">featfreq</span>(dfm)</span>
<span id="cb21-8"><a href="#cb21-8"></a></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="fu">print</span>(word_frequencies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        @utf8          @pid             :         11312             / 
            3             3          2772             3           333 
 c-00019181-1        @begin    @languages           eng @participants 
            1             3             3            21             3 
          ste       teacher             ,           lou         child 
         1577             7           605           103            30 
          jer           cat           chr           all           unk 
          137            74           110            78             6 
     @options         multi           @id             |      gathburn 
            3             3            18           180            18 
        @date   16-may-1984         @tape      location           1.1 
            1             1             1             1             1 
 @transcriber         ginny    gathercole           and       rebecca 
            1             2             1           131             1 
        burns     @location     edinburgh      scotland        @types 
            1             1             2             1             3 
 [ reached getOption("max.print") -- omitted 1065 entries ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Convert to dataframe</span></span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a>word_frequencies_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(word_frequencies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A useful feature is to be able to add a grouping varibale when doing word counts. For example, we can group by file, using the <code>dfm_group()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Create a document-feature matrix (DFM) grouped by transcript </span></span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a>dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(CHILDES_tokens) <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">dfm_group</span>(<span class="at">groups =</span> <span class="fu">docnames</span>(CHILDES_tokens))</span>
<span id="cb24-5"><a href="#cb24-5"></a></span>
<span id="cb24-6"><a href="#cb24-6"></a></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="co"># Get word frequencies</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>word_frequencies <span class="ot">&lt;-</span> <span class="fu">featfreq</span>(dfm <span class="sc">%&gt;%</span><span class="fu">dfm_group</span>(<span class="at">groups =</span> <span class="fu">docnames</span>(CHILDES_tokens)))</span>
<span id="cb24-9"><a href="#cb24-9"></a></span>
<span id="cb24-10"><a href="#cb24-10"></a></span>
<span id="cb24-11"><a href="#cb24-11"></a><span class="co"># Convert to dataframe</span></span>
<span id="cb24-12"><a href="#cb24-12"></a></span>
<span id="cb24-13"><a href="#cb24-13"></a>word_frequencies_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(word_frequencies)</span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="fu">print</span>(word_frequencies_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              word_frequencies
@utf8                        3
@pid                         3
:                         2772
11312                        3
/                          333
c-00019181-1                 1
@begin                       3
@languages                   3
eng                         21
@participants                3
ste                       1577
teacher                      7
,                          605
lou                        103
child                       30
jer                        137
cat                         74
chr                        110
all                         78
unk                          6
@options                     3
multi                        3
@id                         18
|                          180
gathburn                    18
@date                        1
16-may-1984                  1
@tape                        1
location                     1
1.1                          1
@transcriber                 1
ginny                        2
gathercole                   1
and                        131
rebecca                      1
burns                        1
@location                    1
edinburgh                    2
scotland                     1
@types                       3
 [ reached 'max' / getOption("max.print") -- omitted 1065 rows ]</code></pre>
</div>
</div>
</section><section id="cleaning-transcripts" class="level2" data-number="1.5"><h2 data-number="1.5" class="anchored" data-anchor-id="cleaning-transcripts">
<span class="header-section-number">1.5</span> Cleaning transcripts</h2>
<p>In some contexts, before analysis, you may want to clean the text. This can involve removing punctuation, numbers, and other non-word characters. The <code>tokens</code> function has a <code>remove_punct</code> argument that can be set to <code>TRUE</code> to remove punctuation. The code below shows how to create a new tokens object with punctuation removed. You can also remove numbers and symbols using the <code>remove_numbers</code> and <code>remove_symbols</code> arguments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># removing punctuation</span></span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a>CHILDES_tokens_clean <span class="ot">&lt;-</span> <span class="fu">tokens</span>(CHILDES_corpus, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>, <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When examining word frequencies, you may want to remove stopwords. Stopwords are common words that are often removed from text before analysis. For example, stop words include: “i”, “me” , “my”, “myself”, “we”, “our”, “ours”, “ourselves”, “you”, and “your”. If left in, these common, high frequency words can swap out other terms in the data.</p>
<p><code>quanteda</code> has a built in dictionary of stopwords. You can see those included by running <code>head(stopwords("en"), 20)</code> the 20 limits the ouput to the first 20 words. Here <code>en</code> specifies you are interested in stopwords in English.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># quanteda's stop words</span></span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="fu">head</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>), <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "i"          "me"         "my"         "myself"     "we"        
 [6] "our"        "ours"       "ourselves"  "you"        "your"      
[11] "yours"      "yourself"   "yourselves" "he"         "him"       
[16] "his"        "himself"    "she"        "her"        "hers"      </code></pre>
</div>
</div>
<p>To remove stopwords, you can use the <code>remove</code> argument in the <code>tokens</code> function: <code>tokens_remove(tokens, stopwords("en"))</code>. The code below shows how to create a new tokens object with stopwords and punctuation removed. Let us compare outputs with and without the removal of stopwords and punctuation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># removing stopwords and punctuation</span></span>
<span id="cb29-2"><a href="#cb29-2"></a></span>
<span id="cb29-3"><a href="#cb29-3"></a>CHILDES_tokens_no_stop <span class="ot">&lt;-</span> CHILDES_tokens <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="fu">tokens</span>(<span class="at">remove_punct =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>))</span>
<span id="cb29-6"><a href="#cb29-6"></a></span>
<span id="cb29-7"><a href="#cb29-7"></a><span class="co"># Get word frequencies</span></span>
<span id="cb29-8"><a href="#cb29-8"></a></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="co"># Create a document-feature matrix (DFM)</span></span>
<span id="cb29-10"><a href="#cb29-10"></a></span>
<span id="cb29-11"><a href="#cb29-11"></a>dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(CHILDES_tokens_no_stop)</span>
<span id="cb29-12"><a href="#cb29-12"></a></span>
<span id="cb29-13"><a href="#cb29-13"></a></span>
<span id="cb29-14"><a href="#cb29-14"></a><span class="co"># Get word frequencies</span></span>
<span id="cb29-15"><a href="#cb29-15"></a>word_frequencies_no_stop <span class="ot">&lt;-</span> <span class="fu">featfreq</span>(dfm)</span>
<span id="cb29-16"><a href="#cb29-16"></a></span>
<span id="cb29-17"><a href="#cb29-17"></a><span class="fu">print</span>(word_frequencies_no_stop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        @utf8          @pid         11312  c-00019181-1        @begin 
            3             3             3             1             3 
   @languages           eng @participants           ste       teacher 
            3            21             3          1577             7 
          lou         child           jer           cat           chr 
          103            30           137            74           110 
          unk      @options         multi           @id             | 
            6             3             3            18           180 
     gathburn         @date   16-may-1984         @tape      location 
           18             1             1             1             1 
          1.1  @transcriber         ginny    gathercole       rebecca 
            1             1             2             1             1 
        burns     @location     edinburgh      scotland        @types 
            1             1             2             1             3 
        cross         group            td           sit           red 
            3             3             3             9            16 
 [ reached getOption("max.print") -- omitted 906 entries ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Convert to dataframe</span></span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a>word_frequencies_no_stop_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(word_frequencies_no_stop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can compare the results of the two word frequency lists to see the impact of removing stopwords.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># graphs of frequencies before and after removing stopwords</span></span>
<span id="cb32-2"><a href="#cb32-2"></a></span>
<span id="cb32-3"><a href="#cb32-3"></a>word_frequencies_df <span class="ot">&lt;-</span> word_frequencies_df <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="fu">mutate</span>(<span class="at">feat =</span> <span class="fu">rownames</span>(word_frequencies_df)) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(word_frequencies)) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb32-7"><a href="#cb32-7"></a></span>
<span id="cb32-8"><a href="#cb32-8"></a></span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="fu">ggplot</span>(word_frequencies_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feat, <span class="sc">-</span> word_frequencies), <span class="at">y =</span> word_frequencies, <span class="at">fill =</span> feat)) <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb32-12"><a href="#cb32-12"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 word frequencies before removing stopwords"</span>) <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Word"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)<span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>word_frequencies_no_stop_df <span class="ot">&lt;-</span> word_frequencies_no_stop_df <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">mutate</span>(<span class="at">feat =</span> <span class="fu">rownames</span>(word_frequencies_no_stop_df)) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(word_frequencies_no_stop)) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb33-5"><a href="#cb33-5"></a></span>
<span id="cb33-6"><a href="#cb33-6"></a></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="fu">ggplot</span>(word_frequencies_no_stop_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feat, <span class="sc">-</span> word_frequencies_no_stop), <span class="at">y =</span> word_frequencies_no_stop, <span class="at">fill =</span> feat)) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 word frequencies after removing stopwords and punctuation"</span>) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Word"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>As you can see, the build in functions for removing punctuation and stop words are not always ideal. You may want to create your own list of words to remove or use a different method to remove them. You can also use the <code>tokens</code> function with the <code>remove</code> argument to remove specific words. The code below shows how to remove the word “teacher” from the <code>CHILDES_tokens</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># custom removal of words</span></span>
<span id="cb34-2"><a href="#cb34-2"></a></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="co"># Create a custom list of stop words</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>custom_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ste"</span>, <span class="st">"&lt;"</span>, <span class="st">"&gt;"</span>, <span class="st">"xxx"</span>, <span class="st">"ger"</span>, <span class="st">"|"</span>, <span class="st">"kat"</span>, <span class="st">"jer"</span>, <span class="st">"0"</span>, <span class="st">"geo"</span>, <span class="st">"="</span>, <span class="st">"chr"</span>, <span class="st">"+"</span>)</span>
<span id="cb34-5"><a href="#cb34-5"></a></span>
<span id="cb34-6"><a href="#cb34-6"></a>CHILDES_tokens_no_stop <span class="ot">&lt;-</span> CHILDES_tokens <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7"></a>  <span class="fu">tokens</span>(<span class="at">remove_punct =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9"></a>  <span class="fu">tokens_remove</span>(custom_stopwords)</span>
<span id="cb34-10"><a href="#cb34-10"></a></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="co"># Get word frequencies</span></span>
<span id="cb34-12"><a href="#cb34-12"></a></span>
<span id="cb34-13"><a href="#cb34-13"></a><span class="co"># Create a document-feature matrix (DFM)</span></span>
<span id="cb34-14"><a href="#cb34-14"></a></span>
<span id="cb34-15"><a href="#cb34-15"></a>dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(CHILDES_tokens_no_stop)</span>
<span id="cb34-16"><a href="#cb34-16"></a></span>
<span id="cb34-17"><a href="#cb34-17"></a></span>
<span id="cb34-18"><a href="#cb34-18"></a><span class="co"># Get word frequencies</span></span>
<span id="cb34-19"><a href="#cb34-19"></a>word_frequencies_no_stop <span class="ot">&lt;-</span> <span class="fu">featfreq</span>(dfm)</span>
<span id="cb34-20"><a href="#cb34-20"></a></span>
<span id="cb34-21"><a href="#cb34-21"></a><span class="fu">print</span>(word_frequencies_no_stop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        @utf8          @pid         11312  c-00019181-1        @begin 
            3             3             3             1             3 
   @languages           eng @participants       teacher           lou 
            3            21             3             7           103 
        child           cat           unk      @options         multi 
           30            74             6             3             3 
          @id      gathburn         @date   16-may-1984         @tape 
           18            18             1             1             1 
     location           1.1  @transcriber         ginny    gathercole 
            1             1             1             2             1 
      rebecca         burns     @location     edinburgh      scotland 
            1             1             1             2             1 
       @types         cross         group            td           sit 
            3             3             3             3             9 
          red          seat           two          come        around 
           16             5            22            17             5 
 [ reached getOption("max.print") -- omitted 893 entries ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Convert to dataframe</span></span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a>word_frequencies_no_stop_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(word_frequencies_no_stop)</span>
<span id="cb36-4"><a href="#cb36-4"></a></span>
<span id="cb36-5"><a href="#cb36-5"></a></span>
<span id="cb36-6"><a href="#cb36-6"></a>CHILDES_tokens_no_stop<span class="ot">&lt;-</span> CHILDES_tokens_no_stop <span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="#cb36-7"></a>  <span class="fu">tokens_remove</span>(custom_stopwords)</span>
<span id="cb36-8"><a href="#cb36-8"></a></span>
<span id="cb36-9"><a href="#cb36-9"></a>word_frequencies_no_stop_df <span class="ot">&lt;-</span> word_frequencies_no_stop_df <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10"></a>  <span class="fu">mutate</span>(<span class="at">feat =</span> <span class="fu">rownames</span>(word_frequencies_no_stop_df)) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="#cb36-11"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(word_frequencies_no_stop)) <span class="sc">%&gt;%</span></span>
<span id="cb36-12"><a href="#cb36-12"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb36-13"><a href="#cb36-13"></a></span>
<span id="cb36-14"><a href="#cb36-14"></a></span>
<span id="cb36-15"><a href="#cb36-15"></a><span class="fu">ggplot</span>(word_frequencies_no_stop_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feat, <span class="sc">-</span> word_frequencies_no_stop), <span class="at">y =</span> word_frequencies_no_stop, <span class="at">fill =</span> feat)) <span class="sc">+</span></span>
<span id="cb36-16"><a href="#cb36-16"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb36-17"><a href="#cb36-17"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb36-18"><a href="#cb36-18"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 word frequencies after removing stopwords and punctuation"</span>) <span class="sc">+</span></span>
<span id="cb36-19"><a href="#cb36-19"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Word"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb36-20"><a href="#cb36-20"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<section id="creating-a-custom-dictionary" class="level3" data-number="1.5.1"><h3 data-number="1.5.1" class="anchored" data-anchor-id="creating-a-custom-dictionary">
<span class="header-section-number">1.5.1</span> Creating a custom dictionary</h3>
<p>We have seen how to search for a single word or phrase in the corpus. You may want to search for multiple words or phrases at once. This can be done using a dictionary. A dictionary is a list of words or phrases that you want to search for in the corpus. The code below shows how to create a dictionary object using the <code>dictionary</code> function. The <code>dictionary</code> function takes a list of words or phrases as input. You can use the dictionary when making a <code>dfm</code> to create word counts</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># Setting up a dictionary to search for</span></span>
<span id="cb37-2"><a href="#cb37-2"></a></span>
<span id="cb37-3"><a href="#cb37-3"></a>dict <span class="ot">&lt;-</span> <span class="fu">dictionary</span>(<span class="fu">list</span>(<span class="at">parent =</span> <span class="fu">c</span>(<span class="st">"dad"</span>, <span class="st">"daddy"</span>, <span class="st">"Daddy"</span>, <span class="st">"Dad"</span>, <span class="st">"mum"</span>, <span class="st">"mummy"</span>, <span class="st">"Mum"</span>, <span class="st">"Mummy"</span>),</span>
<span id="cb37-4"><a href="#cb37-4"></a>                        <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"orange"</span> , <span class="st">"yellow"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"violet"</span>)))</span>
<span id="cb37-5"><a href="#cb37-5"></a></span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="co"># searching for a phrase</span></span>
<span id="cb37-7"><a href="#cb37-7"></a></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="co"># Create a document-feature matrix (DFM) using the dictionary to search for words</span></span>
<span id="cb37-9"><a href="#cb37-9"></a></span>
<span id="cb37-10"><a href="#cb37-10"></a>dfm <span class="ot">&lt;-</span> CHILDES_tokens_no_stop <span class="sc">%&gt;%</span></span>
<span id="cb37-11"><a href="#cb37-11"></a>       <span class="fu">tokens_lookup</span>(<span class="at">dictionary =</span> dict) <span class="sc">%&gt;%</span></span>
<span id="cb37-12"><a href="#cb37-12"></a>      <span class="fu">dfm</span>()</span>
<span id="cb37-13"><a href="#cb37-13"></a></span>
<span id="cb37-14"><a href="#cb37-14"></a><span class="co"># display the dfm</span></span>
<span id="cb37-15"><a href="#cb37-15"></a>dfm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Document-feature matrix of: 3 documents, 2 features (16.67% sparse) and 1 docvar.
                         features
docs                      parent colour
  CHILDES_Gathburn_11.txt      0     29
  CHILDES_Gathburn_12.txt      2      4
  CHILDES_Gathburn_13.txt      4     20</code></pre>
</div>
</div>
</section></section><section id="word-clouds" class="level2" data-number="1.6"><h2 data-number="1.6" class="anchored" data-anchor-id="word-clouds">
<span class="header-section-number">1.6</span> Word clouds</h2>
<p>A common way to visualise word frequencies is to use a word cloud. A word cloud is a visual representation of text data, where the size of each word indicates its frequency in the text. The <code>quanteda.textplots</code> package can be used to create word clouds in R.</p>
<p>The code below shows how to create a word cloud from the <code>CHILDES_tokens_no_stop</code> object. The <code>text_plotwordcloud</code> function is used to create the word cloud from a ‘dfm’ object. The <code>dim.trim</code> function is used to set the minimum frequency of words to include in the word cloud. If low frequencies words are left in, the word cloud is hard to read. The <code>min_termfreq</code> argument is used to set the minimum frequency of words to include in the word cloud. The <code>textplot_wordcloud</code> function is used to create the word cloud.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb39-2"><a href="#cb39-2"></a></span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="co"># Create a word cloud</span></span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="co"># Start from the cleaned dfm object</span></span>
<span id="cb39-5"><a href="#cb39-5"></a></span>
<span id="cb39-6"><a href="#cb39-6"></a><span class="co"># Create a custom list of stop words</span></span>
<span id="cb39-7"><a href="#cb39-7"></a>custom_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ste"</span>, <span class="st">"&lt;"</span>, <span class="st">"&gt;"</span>, <span class="st">"xxx"</span>, <span class="st">"ger"</span>, <span class="st">"|"</span>, <span class="st">"kat"</span>, <span class="st">"jer"</span>, <span class="st">"0"</span>, <span class="st">"geo"</span>, <span class="st">"="</span>, <span class="st">"chr"</span>, <span class="st">"+"</span>)</span>
<span id="cb39-8"><a href="#cb39-8"></a></span>
<span id="cb39-9"><a href="#cb39-9"></a>CHILDES_tokens_no_stop <span class="ot">&lt;-</span> CHILDES_tokens <span class="sc">%&gt;%</span></span>
<span id="cb39-10"><a href="#cb39-10"></a>  <span class="fu">tokens</span>(<span class="at">remove_punct =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-11"><a href="#cb39-11"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-12"><a href="#cb39-12"></a>  <span class="fu">tokens_remove</span>(custom_stopwords)</span>
<span id="cb39-13"><a href="#cb39-13"></a></span>
<span id="cb39-14"><a href="#cb39-14"></a><span class="co"># Get word frequencies</span></span>
<span id="cb39-15"><a href="#cb39-15"></a></span>
<span id="cb39-16"><a href="#cb39-16"></a><span class="co"># Create a document-feature matrix (DFM)</span></span>
<span id="cb39-17"><a href="#cb39-17"></a><span class="co"># Trim to remove low frequency words</span></span>
<span id="cb39-18"><a href="#cb39-18"></a></span>
<span id="cb39-19"><a href="#cb39-19"></a>dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(CHILDES_tokens_no_stop) <span class="sc">%&gt;%</span></span>
<span id="cb39-20"><a href="#cb39-20"></a>    <span class="fu">dfm_trim</span>(<span class="at">min_termfreq =</span> <span class="dv">10</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-21"><a href="#cb39-21"></a></span>
<span id="cb39-22"><a href="#cb39-22"></a><span class="co"># Create a word cloud</span></span>
<span id="cb39-23"><a href="#cb39-23"></a></span>
<span id="cb39-24"><a href="#cb39-24"></a><span class="fu">textplot_wordcloud</span>(dfm) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>The argument <code>color</code>can be use to set a colour gradient by frequency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># Create a word cloud comparing texts</span></span>
<span id="cb40-2"><a href="#cb40-2"></a> </span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="fu">textplot_wordcloud</span>(dfm, <span class="at">color =</span><span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"skyblue"</span>, <span class="st">"blue"</span>, <span class="st">"darkblue"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>The <code>textplot_wordcloud()</code> function has an argument to produce comparative plots by text, by setting the <code>comparison</code> argument to true</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Create a word cloud comparing texts</span></span>
<span id="cb41-2"><a href="#cb41-2"></a> </span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="fu">textplot_wordcloud</span>(dfm, <span class="at">comparison =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="lexical-dispersion-plots" class="level2" data-number="1.7"><h2 data-number="1.7" class="anchored" data-anchor-id="lexical-dispersion-plots">
<span class="header-section-number">1.7</span> Lexical dispersion plots</h2>
<p>Lexical dispersion plots are a way to visualise the distribution of words in a text. The <code>textplot_xray</code> function from the <code>quanteda.textplots</code> package can be used to create lexical dispersion plots in R. The code below shows how to create a lexical dispersion plot from the <code>CHILDES_tokens_no_stop</code> object. The <code>textplot_xray</code> function is used to create the lexical dispersion plot. Notice <code>kwic</code> search is first used and the <code>regex</code> arguments introduced above can be applied. The plot shows the occuranve of words over time in the transcripts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb42-2"><a href="#cb42-2"></a></span>
<span id="cb42-3"><a href="#cb42-3"></a></span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="co"># Create a lexical dispersion plot</span></span>
<span id="cb42-5"><a href="#cb42-5"></a> </span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="fu">kwic</span>(CHILDES_tokens_no_stop, <span class="at">pattern =</span> <span class="st">"good"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-7"><a href="#cb42-7"></a>    <span class="fu">textplot_xray</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>You can create lexical dispersion plots for multiple words at once. The code below shows how to create a lexical dispersion plot for the words “good” and “like” in the <code>CHILDES_tokens_no_stop</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># Create a lexical dispersion plot</span></span>
<span id="cb43-2"><a href="#cb43-2"></a></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="fu">textplot_xray</span>(</span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="fu">kwic</span>(CHILDES_tokens_no_stop, <span class="at">pattern =</span> <span class="st">"good"</span>),</span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="fu">kwic</span>(CHILDES_tokens_no_stop, <span class="at">pattern =</span> <span class="st">"like"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="network-analysis" class="level2" data-number="1.8"><h2 data-number="1.8" class="anchored" data-anchor-id="network-analysis">
<span class="header-section-number">1.8</span> Network analysis</h2>
<p>Quanteda can plot a ‘dfm’ object to show the relationship between words. The <code>textplot_network</code> function can be used to create a network plot from a ‘dfm’ object. The code below shows how to create a network plot from the <code>CHILDES_tokens_no_stop</code> object. The <code>textplot_network</code> function is used to create the network plot. The <code>min_freq</code> argument is used to set the minimum frequency of words to include in the network plot. It is important to set a sensible threshold for <code>min_freq</code> to prevent the chart becoming cluttered.</p>
<p>Additional arguments are used to format the plot:</p>
<p>• <code>edge_size</code> sets the size of the edges in the network plot. • <code>edge_color</code> is used to set the colour of the edges in the network plot. • <code>vertex_size</code> determines the size of the vertices in the network plot. • <code>vertex_labelsize</code> sets the size of the vertex labels in the network plot. • <code>vertex_labelcolor</code> is used to set the colour of the vertex labels in the network plot. • <code>vertex_color</code> sets the colour of the vertices in the network plot. • <code>vertex_alpha</code> sets the transparency of the vertices in the network plot. • <code>repel</code> is used to set whether the vertices should be repelled from each other in the network plot. • <code>seed</code> is used to set the seed for the random number generator in the network plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu">textplot_network</span>(dfm, <span class="at">min_freq =</span> <span class="dv">3000</span>, <span class="at">edge_size =</span> <span class="fl">0.5</span>, <span class="at">edge_color =</span> <span class="st">"grey"</span>, <span class="at">vertex_size =</span> <span class="fl">0.5</span>, <span class="at">vertex_labelsize =</span> <span class="dv">5</span>, <span class="at">vertex_labelcolor =</span> <span class="st">"black"</span>, <span class="at">vertex_color =</span> <span class="st">"lightblue"</span>, <span class="at">vertex_alpha =</span> <span class="fl">0.5</span>, <span class="at">repel =</span> <span class="cn">TRUE</span>, <span class="at">seed =</span> <span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="sentiment-analysis" class="level2" data-number="1.9"><h2 data-number="1.9" class="anchored" data-anchor-id="sentiment-analysis">
<span class="header-section-number">1.9</span> Sentiment analysis</h2>
<p>Sentiment analysis is a way to determine the emotional tone behind a series of words. The <code>syuzhet</code> package can be used to perform sentiment analysis in R. The package uses a dictionary-based approach to sentiment analysis. Words are assigned a score based on their emotional valence, with positive words having a positive score and negative words having a negative score. The scores are then aggregated to give an overall measure of the emotional tone of the text.</p>
<p>The package uses the <a href="https://saifmohammad.com/WebPages/NRC-Emotion-Lexicon.htm">NRC lexicon</a> a list of words and their associations with eight emotions (emotions (anger, fear, anticipation, trust, surprise, sadness, joy, and disgust) and two sentiments (negative and positive). The categorisations were achieved through a crowd sourcing process. You can see some of the categorisations below:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>      lang           word sentiment value
1  english           abba  positive     1
2  english        ability  positive     1
3  english abovementioned  positive     1
4  english       absolute  positive     1
5  english     absolution  positive     1
6  english       absorbed  positive     1
7  english      abundance  positive     1
8  english       abundant  positive     1
9  english       academic  positive     1
10 english        academy  positive     1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      lang        word sentiment value
1  english     abandon  negative     1
2  english   abandoned  negative     1
3  english abandonment  negative     1
4  english   abduction  negative     1
5  english    aberrant  negative     1
6  english  aberration  negative     1
7  english       abhor  negative     1
8  english   abhorrent  negative     1
9  english      abject  negative     1
10 english    abnormal  negative     1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      lang        word sentiment value
1  english  aberration   disgust     1
2  english       abhor   disgust     1
3  english   abhorrent   disgust     1
4  english      abject   disgust     1
5  english    abnormal   disgust     1
6  english  abominable   disgust     1
7  english abomination   disgust     1
8  english    abortion   disgust     1
9  english   abundance   disgust     1
10 english       abuse   disgust     1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      lang          word sentiment value
1  english    absolution       joy     1
2  english     abundance       joy     1
3  english      abundant       joy     1
4  english      accolade       joy     1
5  english accompaniment       joy     1
6  english    accomplish       joy     1
7  english  accomplished       joy     1
8  english       achieve       joy     1
9  english   achievement       joy     1
10 english       acrobat       joy     1</code></pre>
</div>
</div>
<p>The code below shows how to perform sentiment analysis on the text of Romeo and Juliet <a href="https://www.gutenberg.org/cache/epub/1513/pg1513.txt">download here</a> - in your browser click, File -&gt; Save As… and save the play as a text file. The <code>get_sentiment</code> function is used to perform sentiment analysis. The <code>method</code> argument is used to set the method of sentiment analysis to use. The <code>plot</code> function is used to plot the sentiment analysis results. The <code>type</code> argument is used to set the type of plot to create. The <code>main</code>, <code>xlab</code>, and <code>ylab</code> arguments are used to set the title and labels of the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># Perform sentiment analysis</span></span>
<span id="cb49-2"><a href="#cb49-2"></a></span>
<span id="cb49-3"><a href="#cb49-3"></a>syuzhet_vector <span class="ot">&lt;-</span> <span class="fu">get_sentiment</span>(Romeo_and_Juliet_text, <span class="at">method=</span><span class="st">"syuzhet"</span>)</span>
<span id="cb49-4"><a href="#cb49-4"></a></span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="co"># convert the suzhet vector to a dataframe for more choies in plotting</span></span>
<span id="cb49-6"><a href="#cb49-6"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(syuzhet_vector)</span>
<span id="cb49-7"><a href="#cb49-7"></a></span>
<span id="cb49-8"><a href="#cb49-8"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(syuzhet_vector), <span class="at">y =</span> syuzhet_vector)) <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">span =</span><span class="fl">0.5</span>) <span class="sc">+</span> <span class="co"># Span here sets the amount of damping on the line</span></span>
<span id="cb49-10"><a href="#cb49-10"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Sentiment analysis of Romeo and Juliet"</span>, <span class="at">x =</span> <span class="st">"Line"</span>, <span class="at">y =</span> <span class="st">"Sentiment"</span>) <span class="sc">+</span></span>
<span id="cb49-11"><a href="#cb49-11"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="comparison-of-sameness-of-documents" class="level2" data-number="1.10"><h2 data-number="1.10" class="anchored" data-anchor-id="comparison-of-sameness-of-documents">
<span class="header-section-number">1.10</span> Comparison of sameness of documents</h2>
<p>Similarity analysis is a way to compare the similarity of two or more documents. The <code>textstat_simil</code> function from the <code>quanteda.textstats</code> package can be used to perform similarity analysis in R. The code below shows how to perform similarity analysis on two party manifestos. First a document feature matrix object, grouped by party, is created. Then <code>textstat_simil</code> function is used to perform similarity analysis. The <code>as.matrix</code> function is used to convert the similarity analysis results to a matrix. A score of 1.0 indicates texts are identical, and 0 indicates they are completely distinct. The <code>heatmap</code> function is used to plot the similarity analysis results.</p>
<p>As an example we will use manifesto text from a corpus of political party manifestos. The manifestos come from: <a href="https://visuals.manifesto-project.wzb.eu">The Manifesto Corpus version 2024-1</a>, :Lehmann, Pola / Franzmann, Simon / Al-Gaddooa, Denise / Burst, Tobias / Ivanusch, Christoph / Lewandowski, Jirka / Regel, Sven / Riethmüller, Felicia / Zehnter, Lisa (2024): Manifesto Corpus. Version: 2024-1. Berlin: WZB Berlin Social Science Center/Göttingen: Institute for Democracy Research (IfDem).</p>
<p>You can download the 2019 <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/ETJJtTMpTpVJugbeZZW-QLcBq2ohTlfBY12N53JiFJB77Q?e=rUVeW4">labour</a> and <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/ERFqltmtfbJEm1zFjSPbym0BALUbAsZELyc8jXNETC3YCw?e=BctGQc">conservative</a> <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/ERm6iEG-_eJLt21KhlFyeFMBrhEOP2OELeSMbs-94ORKgg?e=y3nHCj">Liberal Democrat</a> <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/EetvkGADcAdNlrnpVpoylPMB5rryzH4gk3ZgwxXLizJ48g?e=J31XhN">Scottish National</a>, <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/ETHtdiwCrX9Pqf6IcCng8usBm4Kp9JIpZYOihN6XBDet1A?e=awz7W9">Plaid Cymru</a>, <a href="https://emckclac-my.sharepoint.com/:x:/g/personal/k1926273_kcl_ac_uk/EZYIyHnug4ZIowPZO1a5_OcBQNZGbJK0l-RfdxwWmOCsUw?e=yRelvq">Green Party</a>, <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/EcQMMH1unTVImkjpr-P_JiMBUASaId-_GeGP1jdUYEwBpw?e=65GckY">Democatic Unionist Party</a> manifestos here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># Read in the text of the manifestos</span></span>
<span id="cb50-2"><a href="#cb50-2"></a></span>
<span id="cb50-3"><a href="#cb50-3"></a>manifesto_text <span class="ot">&lt;-</span> <span class="fu">readtext</span>(<span class="fu">glue</span>(<span class="st">"&lt;folder where the manifestos are&gt;"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="fu">library</span>(quanteda.textstats)</span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb51-3"><a href="#cb51-3"></a></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="co"># Read in the text of the manifestos</span></span>
<span id="cb51-5"><a href="#cb51-5"></a></span>
<span id="cb51-6"><a href="#cb51-6"></a>manifesto_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(manifesto_text)</span>
<span id="cb51-7"><a href="#cb51-7"></a></span>
<span id="cb51-8"><a href="#cb51-8"></a><span class="co"># Label the manifestos</span></span>
<span id="cb51-9"><a href="#cb51-9"></a></span>
<span id="cb51-10"><a href="#cb51-10"></a><span class="fu">docvars</span>(manifesto_corpus, <span class="st">"party"</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"conserative"</span>, <span class="st">"DUP"</span>, <span class="st">"Green,"</span>, <span class="st">"Labour"</span>, <span class="st">"Liberal_democrat"</span>, <span class="st">"Plaid_cymru"</span>, <span class="st">"SNP"</span>)</span>
<span id="cb51-11"><a href="#cb51-11"></a></span>
<span id="cb51-12"><a href="#cb51-12"></a><span class="co"># Create a dfm grouped by president</span></span>
<span id="cb51-13"><a href="#cb51-13"></a><span class="co"># Remove punctuation and stopwords</span></span>
<span id="cb51-14"><a href="#cb51-14"></a><span class="co"># group by party</span></span>
<span id="cb51-15"><a href="#cb51-15"></a></span>
<span id="cb51-16"><a href="#cb51-16"></a>dfmat_manifesto <span class="ot">&lt;-</span> <span class="fu">tokens</span>(manifesto_corpus, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-17"><a href="#cb51-17"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"english"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-18"><a href="#cb51-18"></a>  <span class="fu">tokens_group</span>(<span class="at">groups =</span> party) <span class="sc">%&gt;%</span></span>
<span id="cb51-19"><a href="#cb51-19"></a>  <span class="fu">dfm</span>()</span>
<span id="cb51-20"><a href="#cb51-20"></a></span>
<span id="cb51-21"><a href="#cb51-21"></a><span class="co"># Perform the similarity analysis</span></span>
<span id="cb51-22"><a href="#cb51-22"></a>tstat_sim <span class="ot">&lt;-</span> <span class="fu">textstat_simil</span>(dfmat_manifesto)</span>
<span id="cb51-23"><a href="#cb51-23"></a></span>
<span id="cb51-24"><a href="#cb51-24"></a>mat_sim <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tstat_sim)</span>
<span id="cb51-25"><a href="#cb51-25"></a>mat_sim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 conserative       DUP    Green,    Labour Liberal_democrat
conserative        1.0000000 0.9834780 0.9871499 0.9898764        0.9899208
DUP                0.9834780 1.0000000 0.9750170 0.9775076        0.9789022
Green,             0.9871499 0.9750170 1.0000000 0.9863148        0.9882063
Labour             0.9898764 0.9775076 0.9863148 1.0000000        0.9921378
Liberal_democrat   0.9899208 0.9789022 0.9882063 0.9921378        1.0000000
                 Plaid_cymru       SNP
conserative        0.9818913 0.9770161
DUP                0.9721829 0.9699785
Green,             0.9783747 0.9726886
Labour             0.9819165 0.9756541
Liberal_democrat   0.9825760 0.9772731
 [ reached getOption("max.print") -- omitted 2 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># plot the data as a heatmap - setting the font size on the axes with cexRow and cexCol</span></span>
<span id="cb53-2"><a href="#cb53-2"></a></span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="fu">heatmap</span>(mat_sim, <span class="at">cexRow =</span> <span class="fl">0.7</span>, <span class="at">cexCol =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="keyness" class="level2" data-number="1.11"><h2 data-number="1.11" class="anchored" data-anchor-id="keyness">
<span class="header-section-number">1.11</span> Keyness</h2>
<p>Keyness analysis is a way to identify words that are significantly more frequent in one text compared to another. The <code>textstat_keyness</code> function from the <code>quanteda.textstats</code> package can be used to perform keyness analysis in R. The code below shows how to perform keyness analysis on two texts. The <code>textstat_keyness</code> function is used to perform keyness analysis. The <code>target</code> argument is used to specify the texts to compare against. The results are plotted using the <code>textplot_keyness</code> function, specifying the number of words to plot with the <code>n</code> argument and the colours to use with the <code>color</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb54-2"><a href="#cb54-2"></a></span>
<span id="cb54-3"><a href="#cb54-3"></a></span>
<span id="cb54-4"><a href="#cb54-4"></a><span class="co"># Create a corpus</span></span>
<span id="cb54-5"><a href="#cb54-5"></a></span>
<span id="cb54-6"><a href="#cb54-6"></a>manifesto_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(manifesto_text)</span>
<span id="cb54-7"><a href="#cb54-7"></a></span>
<span id="cb54-8"><a href="#cb54-8"></a><span class="co"># Label the manifestos</span></span>
<span id="cb54-9"><a href="#cb54-9"></a></span>
<span id="cb54-10"><a href="#cb54-10"></a><span class="fu">docvars</span>(manifesto_corpus, <span class="st">"party"</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"conservative"</span>, <span class="st">"DUP"</span>, <span class="st">"green"</span>, <span class="st">"labour"</span>, <span class="st">"liberal_democrat"</span>, <span class="st">"Plaid_cymru"</span>, <span class="st">"SNP"</span>)</span>
<span id="cb54-11"><a href="#cb54-11"></a></span>
<span id="cb54-12"><a href="#cb54-12"></a></span>
<span id="cb54-13"><a href="#cb54-13"></a><span class="co"># Subset to green and conservative</span></span>
<span id="cb54-14"><a href="#cb54-14"></a></span>
<span id="cb54-15"><a href="#cb54-15"></a>green_lab_manifesto <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(manifesto_corpus, party <span class="sc">==</span> <span class="st">"green"</span> <span class="sc">|</span> party <span class="sc">==</span> <span class="st">"labour"</span>)</span>
<span id="cb54-16"><a href="#cb54-16"></a></span>
<span id="cb54-17"><a href="#cb54-17"></a><span class="co"># Remove punctuation and stopwords</span></span>
<span id="cb54-18"><a href="#cb54-18"></a><span class="co"># group by party</span></span>
<span id="cb54-19"><a href="#cb54-19"></a></span>
<span id="cb54-20"><a href="#cb54-20"></a>dfmat_manifesto <span class="ot">&lt;-</span> <span class="fu">tokens</span>(green_lab_manifesto, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, </span>
<span id="cb54-21"><a href="#cb54-21"></a>                          <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>, <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-22"><a href="#cb54-22"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"english"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb54-23"><a href="#cb54-23"></a>  <span class="fu">dfm</span>() </span>
<span id="cb54-24"><a href="#cb54-24"></a></span>
<span id="cb54-25"><a href="#cb54-25"></a><span class="co"># Perform keyness analysis</span></span>
<span id="cb54-26"><a href="#cb54-26"></a>keyness_stat <span class="ot">&lt;-</span> <span class="fu">textstat_keyness</span>(dfmat_manifesto, <span class="at">target =</span> <span class="st">"green_manifesto.txt"</span>, <span class="at">measure =</span> <span class="st">"lr"</span>)</span>
<span id="cb54-27"><a href="#cb54-27"></a></span>
<span id="cb54-28"><a href="#cb54-28"></a><span class="co"># Plot the keyness analysis</span></span>
<span id="cb54-29"><a href="#cb54-29"></a><span class="fu">textplot_keyness</span>(keyness_stat, <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"red"</span>), <span class="at">n =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="topic-models" class="level2" data-number="1.12"><h2 data-number="1.12" class="anchored" data-anchor-id="topic-models">
<span class="header-section-number">1.12</span> Topic models</h2>
<p>Topics modelling is an approach that attempts to find clusters of words that occur - these clusters can be thought of as topics in the text. For example, in a manifesto, the words industry, workers, energy, manufacturing may co-occur and be thought to relate to industrial policy. Topic modelling can use a number of different algorithms to define clusters of words, one of the most common is Latent Dirichlet Allocation (LDA). To perform a LDA topic model, you can use the <code>seededlda</code> package. The topic modelling is performed using the function <code>textmodel_lda(&lt;dfmat_object&gt;, k = &lt;number of desired clusters&gt;)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="fu">library</span>(seededlda)</span>
<span id="cb55-2"><a href="#cb55-2"></a></span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="co"># Using the dfm_mat from above - set number of topics to 5</span></span>
<span id="cb55-4"><a href="#cb55-4"></a>tmod_con <span class="ot">&lt;-</span> <span class="fu">textmodel_lda</span>(dfmat_manifesto, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb55-5"><a href="#cb55-5"></a><span class="fu">terms</span>(tmod_con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      topic1          topic2      topic3       topic4           topic5   
 [1,] "labour"        "rates"     "na"         "develop"        "green"  
 [2,] "review"        "young"     "people"     "life"           "new"    
 [3,] "tories"        "place"     "public"     "least"          "tax"    
 [4,] "conservatives" "given"     "government" "changes"        "deal"   
 [5,] "standards"     "allow"     "ensure"     "discrimination" "billion"
 [6,] "care"          "healthy"   "new"        "share"          "local"  
 [7,] "employers"     "uk’s"      "uk"         "local"          "carbon" 
 [8,] "police"        "committed" "support"    "animal"         "income" 
 [ reached getOption("max.print") -- omitted 2 rows ]</code></pre>
</div>
</div>
</section><section id="seminar-activities" class="level2" data-number="1.13"><h2 data-number="1.13" class="anchored" data-anchor-id="seminar-activities">
<span class="header-section-number">1.13</span> Seminar activities</h2>
<p>The first tasks use the election manifesto corpus. The manifestos come from: <a href="https://visuals.manifesto-project.wzb.eu">The Manifesto Corpus version 2024-1</a>, :Lehmann, Pola / Franzmann, Simon / Al-Gaddooa, Denise / Burst, Tobias / Ivanusch, Christoph / Lewandowski, Jirka / Regel, Sven / Riethmüller, Felicia / Zehnter, Lisa (2024): Manifesto Corpus. Version: 2024-1. Berlin: WZB Berlin Social Science Center/Göttingen: Institute for Democracy Research (IfDem).</p>
<p>You can download the 2019 <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/ETJJtTMpTpVJugbeZZW-QLcBq2ohTlfBY12N53JiFJB77Q?e=rUVeW4">labour</a> and <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/ERFqltmtfbJEm1zFjSPbym0BALUbAsZELyc8jXNETC3YCw?e=BctGQc">conservative</a> <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/ERm6iEG-_eJLt21KhlFyeFMBrhEOP2OELeSMbs-94ORKgg?e=y3nHCj">Liberal Democrat</a> <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/EetvkGADcAdNlrnpVpoylPMB5rryzH4gk3ZgwxXLizJ48g?e=J31XhN">Scottish National</a>, <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/ETHtdiwCrX9Pqf6IcCng8usBm4Kp9JIpZYOihN6XBDet1A?e=awz7W9">Plaid Cymru</a>, <a href="https://emckclac-my.sharepoint.com/:x:/g/personal/k1926273_kcl_ac_uk/EZYIyHnug4ZIowPZO1a5_OcBQNZGbJK0l-RfdxwWmOCsUw?e=yRelvq">Green Party</a>, <a href="https://emckclac-my.sharepoint.com/:t:/g/personal/k1926273_kcl_ac_uk/EcQMMH1unTVImkjpr-P_JiMBUASaId-_GeGP1jdUYEwBpw?e=65GckY">Democatic Unionist Party</a> manifestos here.</p>
<section id="task-1-word-clouds" class="level3" data-number="1.13.1"><h3 data-number="1.13.1" class="anchored" data-anchor-id="task-1-word-clouds">
<span class="header-section-number">1.13.1</span> Task 1 Word clouds</h3>
<div class="question">
<p>Download the manifesto texts for the parties. Create a corpus object from the texts. Add metadata to the corpus object to indicate the party of each manifesto. Create a document-feature matrix (DFM) from the corpus object. Produce a table and a graph of the counts of words by frequency.</p>
<p>Hint - when you prepare the data frame for plotting you will want to convert the rownames in the dfm object dataframe to a new column - you can do that with: <code>word_frequencies_df &lt;- word_frequencies_df %&gt;% mutate(feat = rownames(word_frequencies_df))</code>. To make the graph look reasonable you will also need to filter the data frame to get only the top words by frequency.</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Answer</summary><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># Load the manifestos</span></span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="co"># manifesto_text &lt;- readtext(glue("&lt;your manifesto text file folder&gt;")) </span></span>
<span id="cb57-4"><a href="#cb57-4"></a></span>
<span id="cb57-5"><a href="#cb57-5"></a><span class="co"># Create a corpus object</span></span>
<span id="cb57-6"><a href="#cb57-6"></a></span>
<span id="cb57-7"><a href="#cb57-7"></a>manifesto_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(manifesto_text)</span>
<span id="cb57-8"><a href="#cb57-8"></a></span>
<span id="cb57-9"><a href="#cb57-9"></a><span class="co"># Add metadata to the corpus object</span></span>
<span id="cb57-10"><a href="#cb57-10"></a></span>
<span id="cb57-11"><a href="#cb57-11"></a><span class="fu">docvars</span>(manifesto_corpus, <span class="st">"party"</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"conserative"</span>, <span class="st">"DUP"</span>, <span class="st">"Green,"</span>, <span class="st">"Labour"</span>, <span class="st">"Liberal_democrat"</span>, <span class="st">"Plaid_cymru"</span>, <span class="st">"SNP"</span>)</span>
<span id="cb57-12"><a href="#cb57-12"></a></span>
<span id="cb57-13"><a href="#cb57-13"></a><span class="fu">summary</span>(manifesto_corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 7 documents, showing 7 documents:

                      Text Types Tokens Sentences            party
         con_manifesto.txt  3493  34445         1      conserative
         DUP_manifesto.txt  2543  16435        23              DUP
       green_manifesto.txt  4317  39279        55           Green,
         lab_manifesto.txt  4585  45071         1           Labour
     lib_dem_manifesto.txt  4631  44698         5 Liberal_democrat
 plaid_cymru_manifesto.txt  3870  30239        37      Plaid_cymru
         SNP_manifesto.txt  3596  35561        16              SNP</code></pre>
</div>
<details class="code-fold"><summary>Answer</summary><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># Create a dfm grouped by party</span></span>
<span id="cb59-2"><a href="#cb59-2"></a></span>
<span id="cb59-3"><a href="#cb59-3"></a>dfmat_manifesto <span class="ot">&lt;-</span> <span class="fu">tokens</span>(manifesto_corpus) <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4"></a>  <span class="fu">tokens_group</span>(<span class="at">groups =</span> party) <span class="sc">%&gt;%</span></span>
<span id="cb59-5"><a href="#cb59-5"></a>  <span class="fu">dfm</span>()</span>
<span id="cb59-6"><a href="#cb59-6"></a></span>
<span id="cb59-7"><a href="#cb59-7"></a><span class="co"># Get word frequencies</span></span>
<span id="cb59-8"><a href="#cb59-8"></a></span>
<span id="cb59-9"><a href="#cb59-9"></a>word_frequencies <span class="ot">&lt;-</span> <span class="fu">featfreq</span>(dfmat_manifesto)</span>
<span id="cb59-10"><a href="#cb59-10"></a></span>
<span id="cb59-11"><a href="#cb59-11"></a><span class="co"># Convert to dataframe</span></span>
<span id="cb59-12"><a href="#cb59-12"></a></span>
<span id="cb59-13"><a href="#cb59-13"></a>word_frequencies_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(word_frequencies)</span>
<span id="cb59-14"><a href="#cb59-14"></a></span>
<span id="cb59-15"><a href="#cb59-15"></a><span class="co"># Prepare the data for plotting by adding a column for features</span></span>
<span id="cb59-16"><a href="#cb59-16"></a><span class="co"># Arrange by frequency and select the top 20 words</span></span>
<span id="cb59-17"><a href="#cb59-17"></a></span>
<span id="cb59-18"><a href="#cb59-18"></a>word_frequencies_df <span class="ot">&lt;-</span> word_frequencies_df <span class="sc">%&gt;%</span></span>
<span id="cb59-19"><a href="#cb59-19"></a>  <span class="fu">mutate</span>(<span class="at">feat =</span> <span class="fu">rownames</span>(word_frequencies_df)) <span class="sc">%&gt;%</span></span>
<span id="cb59-20"><a href="#cb59-20"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(word_frequencies)) <span class="sc">%&gt;%</span></span>
<span id="cb59-21"><a href="#cb59-21"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb59-22"><a href="#cb59-22"></a></span>
<span id="cb59-23"><a href="#cb59-23"></a></span>
<span id="cb59-24"><a href="#cb59-24"></a><span class="co"># Plot the word frequencies</span></span>
<span id="cb59-25"><a href="#cb59-25"></a></span>
<span id="cb59-26"><a href="#cb59-26"></a><span class="fu">ggplot</span>(word_frequencies_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feat, <span class="sc">-</span> word_frequencies), <span class="at">y =</span> word_frequencies, <span class="at">fill =</span> feat)) <span class="sc">+</span></span>
<span id="cb59-27"><a href="#cb59-27"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb59-28"><a href="#cb59-28"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb59-29"><a href="#cb59-29"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Word frequencies in the manifestos"</span>) <span class="sc">+</span></span>
<span id="cb59-30"><a href="#cb59-30"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Word"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb59-31"><a href="#cb59-31"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="question">
<p>The manifesto corpus needs to be cleaned before analysis. Remove punctuation and stopwords from the corpus. Create a new DFM object from the cleaned corpus. Produce a new table and a graph of the counts of words by frequency in the cleaned corpus. You may want to add custom terms to clean the corpus.</p>
<p>This time use <code>tokens_group(groups = party)</code> to create graphs of word frequencies by party.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># Load the manifestos</span></span>
<span id="cb60-2"><a href="#cb60-2"></a></span>
<span id="cb60-3"><a href="#cb60-3"></a><span class="co"># manifesto_text &lt;- readtext(glue("&lt;your manifesto text file folder&gt;")) </span></span>
<span id="cb60-4"><a href="#cb60-4"></a></span>
<span id="cb60-5"><a href="#cb60-5"></a><span class="co"># Create a corpus object</span></span>
<span id="cb60-6"><a href="#cb60-6"></a></span>
<span id="cb60-7"><a href="#cb60-7"></a>manifesto_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(manifesto_text)</span>
<span id="cb60-8"><a href="#cb60-8"></a></span>
<span id="cb60-9"><a href="#cb60-9"></a><span class="co"># Add metadata to the corpus object</span></span>
<span id="cb60-10"><a href="#cb60-10"></a></span>
<span id="cb60-11"><a href="#cb60-11"></a><span class="fu">docvars</span>(manifesto_corpus, <span class="st">"party"</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"conserative"</span>, <span class="st">"DUP"</span>, <span class="st">"Green,"</span>, <span class="st">"Labour"</span>, <span class="st">"Liberal_democrat"</span>, <span class="st">"Plaid_cymru"</span>, <span class="st">"SNP"</span>)</span>
<span id="cb60-12"><a href="#cb60-12"></a></span>
<span id="cb60-13"><a href="#cb60-13"></a><span class="fu">summary</span>(manifesto_corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 7 documents, showing 7 documents:

                      Text Types Tokens Sentences            party
         con_manifesto.txt  3493  34445         1      conserative
         DUP_manifesto.txt  2543  16435        23              DUP
       green_manifesto.txt  4317  39279        55           Green,
         lab_manifesto.txt  4585  45071         1           Labour
     lib_dem_manifesto.txt  4631  44698         5 Liberal_democrat
 plaid_cymru_manifesto.txt  3870  30239        37      Plaid_cymru
         SNP_manifesto.txt  3596  35561        16              SNP</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># Create a dfm grouped by party</span></span>
<span id="cb62-2"><a href="#cb62-2"></a></span>
<span id="cb62-3"><a href="#cb62-3"></a>custom_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"na"</span>, <span class="st">"£"</span>)</span>
<span id="cb62-4"><a href="#cb62-4"></a></span>
<span id="cb62-5"><a href="#cb62-5"></a>dfmat_manifesto <span class="ot">&lt;-</span> <span class="fu">tokens</span>(manifesto_corpus, </span>
<span id="cb62-6"><a href="#cb62-6"></a>                          <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>, <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-7"><a href="#cb62-7"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb62-8"><a href="#cb62-8"></a>  <span class="fu">tokens_remove</span>(custom_stopwords) <span class="sc">%&gt;%</span></span>
<span id="cb62-9"><a href="#cb62-9"></a>  <span class="fu">tokens_group</span>(<span class="at">groups =</span> party) <span class="sc">%&gt;%</span></span>
<span id="cb62-10"><a href="#cb62-10"></a>  <span class="fu">dfm</span>()</span>
<span id="cb62-11"><a href="#cb62-11"></a></span>
<span id="cb62-12"><a href="#cb62-12"></a><span class="co"># Get word frequencies</span></span>
<span id="cb62-13"><a href="#cb62-13"></a></span>
<span id="cb62-14"><a href="#cb62-14"></a>word_frequencies_by_party <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.matrix</span>(dfmat_manifesto))</span>
<span id="cb62-15"><a href="#cb62-15"></a></span>
<span id="cb62-16"><a href="#cb62-16"></a><span class="co"># Tidy the columns - delete meta-data</span></span>
<span id="cb62-17"><a href="#cb62-17"></a></span>
<span id="cb62-18"><a href="#cb62-18"></a>word_frequencies_by_party <span class="ot">&lt;-</span> word_frequencies_by_party <span class="sc">%&gt;%</span></span>
<span id="cb62-19"><a href="#cb62-19"></a>  <span class="fu">select</span>(<span class="sc">-</span>text, <span class="sc">-</span>text_en, <span class="sc">-</span>cmp_code, <span class="sc">-</span>eu_code)</span>
<span id="cb62-20"><a href="#cb62-20"></a></span>
<span id="cb62-21"><a href="#cb62-21"></a><span class="co"># Get a total count of words across party</span></span>
<span id="cb62-22"><a href="#cb62-22"></a><span class="co"># Prepare the data for plotting by adding a column for features</span></span>
<span id="cb62-23"><a href="#cb62-23"></a><span class="co"># Arrange by frequency and select the top 20 words</span></span>
<span id="cb62-24"><a href="#cb62-24"></a></span>
<span id="cb62-25"><a href="#cb62-25"></a>word_frequencies_total <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colSums</span>(word_frequencies_by_party)) </span>
<span id="cb62-26"><a href="#cb62-26"></a></span>
<span id="cb62-27"><a href="#cb62-27"></a><span class="co"># add column `feat` with rownames</span></span>
<span id="cb62-28"><a href="#cb62-28"></a>word_frequencies_total<span class="sc">$</span>feat <span class="ot">&lt;-</span> <span class="fu">rownames</span>(word_frequencies_total)</span>
<span id="cb62-29"><a href="#cb62-29"></a></span>
<span id="cb62-30"><a href="#cb62-30"></a>word_frequencies_total <span class="ot">&lt;-</span> word_frequencies_total <span class="sc">%&gt;%</span></span>
<span id="cb62-31"><a href="#cb62-31"></a>  <span class="fu">rename</span>(<span class="at">word_frequencies =</span> <span class="st">"colSums(word_frequencies_by_party)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-32"><a href="#cb62-32"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(word_frequencies)) <span class="sc">%&gt;%</span></span>
<span id="cb62-33"><a href="#cb62-33"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb62-34"><a href="#cb62-34"></a></span>
<span id="cb62-35"><a href="#cb62-35"></a></span>
<span id="cb62-36"><a href="#cb62-36"></a><span class="co"># Plot the word frequencies</span></span>
<span id="cb62-37"><a href="#cb62-37"></a></span>
<span id="cb62-38"><a href="#cb62-38"></a><span class="fu">ggplot</span>(word_frequencies_total, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feat, <span class="sc">-</span> word_frequencies), <span class="at">y =</span> word_frequencies, <span class="at">fill =</span> feat)) <span class="sc">+</span></span>
<span id="cb62-39"><a href="#cb62-39"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb62-40"><a href="#cb62-40"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb62-41"><a href="#cb62-41"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Word frequencies in all the manifestos"</span>) <span class="sc">+</span></span>
<span id="cb62-42"><a href="#cb62-42"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Word"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb62-43"><a href="#cb62-43"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb62-44"><a href="#cb62-44"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># Prepare the data for parties for plotting by pivoting</span></span>
<span id="cb63-2"><a href="#cb63-2"></a></span>
<span id="cb63-3"><a href="#cb63-3"></a>word_frequencies_by_party<span class="sc">$</span>parties <span class="ot">&lt;-</span> <span class="fu">rownames</span>(word_frequencies_by_party) <span class="co"># turn the row names into a column</span></span>
<span id="cb63-4"><a href="#cb63-4"></a> </span>
<span id="cb63-5"><a href="#cb63-5"></a>party_frequencies <span class="ot">&lt;-</span> word_frequencies_by_party <span class="sc">%&gt;%</span></span>
<span id="cb63-6"><a href="#cb63-6"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb63-7"><a href="#cb63-7"></a>    <span class="at">cols =</span> <span class="sc">-</span>parties,          </span>
<span id="cb63-8"><a href="#cb63-8"></a>    <span class="at">names_to =</span> <span class="st">"word"</span>,      </span>
<span id="cb63-9"><a href="#cb63-9"></a>    <span class="at">values_to =</span> <span class="st">"count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-10"><a href="#cb63-10"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb63-11"><a href="#cb63-11"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb63-12"><a href="#cb63-12"></a></span>
<span id="cb63-13"><a href="#cb63-13"></a><span class="co"># Facet plot by party</span></span>
<span id="cb63-14"><a href="#cb63-14"></a></span>
<span id="cb63-15"><a href="#cb63-15"></a><span class="fu">ggplot</span>(party_frequencies, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(word, <span class="sc">-</span> count), <span class="at">y =</span> count, <span class="at">fill =</span> word)) <span class="sc">+</span></span>
<span id="cb63-16"><a href="#cb63-16"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb63-17"><a href="#cb63-17"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb63-18"><a href="#cb63-18"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Word frequencies in the manifestos by party"</span>) <span class="sc">+</span></span>
<span id="cb63-19"><a href="#cb63-19"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Word"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb63-20"><a href="#cb63-20"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb63-21"><a href="#cb63-21"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb63-22"><a href="#cb63-22"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>parties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-37-2.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="task-2-wordclouds-and-network-analysis" class="level3" data-number="1.13.2"><h3 data-number="1.13.2" class="anchored" data-anchor-id="task-2-wordclouds-and-network-analysis">
<span class="header-section-number">1.13.2</span> Task 2 wordclouds and network analysis</h3>
<div class="question">
<p>Create wordclouds for the conservative and labour party manifestos using the <code>textplot_network</code> function. Work with the formatting options to get the best possible output. What patterns can you determine about differences in word use?</p>
<p>Create a network plot of the words in the conservative and labour party manifestos using the <code>textplot_network</code> function. Work with the formatting options to get the best possible output. What patterns can you determine about differences in word use?</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Answer word clouds</summary><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb64-2"><a href="#cb64-2"></a></span>
<span id="cb64-3"><a href="#cb64-3"></a></span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="co"># Load the manifestos</span></span>
<span id="cb64-5"><a href="#cb64-5"></a></span>
<span id="cb64-6"><a href="#cb64-6"></a><span class="co"># manifesto_text &lt;- readtext(glue("&lt;your manifesto text file folder&gt;")) </span></span>
<span id="cb64-7"><a href="#cb64-7"></a></span>
<span id="cb64-8"><a href="#cb64-8"></a><span class="co"># Create a corpus object</span></span>
<span id="cb64-9"><a href="#cb64-9"></a></span>
<span id="cb64-10"><a href="#cb64-10"></a>manifesto_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(manifesto_text)</span>
<span id="cb64-11"><a href="#cb64-11"></a></span>
<span id="cb64-12"><a href="#cb64-12"></a><span class="co"># Add metadata to the corpus object</span></span>
<span id="cb64-13"><a href="#cb64-13"></a></span>
<span id="cb64-14"><a href="#cb64-14"></a><span class="fu">docvars</span>(manifesto_corpus, <span class="st">"party"</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"conservative"</span>, <span class="st">"dup"</span>, <span class="st">"green,"</span>, <span class="st">"labour"</span>, <span class="st">"liberal_democrat"</span>, <span class="st">"Plaid_cymru"</span>, <span class="st">"SNP"</span>)</span>
<span id="cb64-15"><a href="#cb64-15"></a></span>
<span id="cb64-16"><a href="#cb64-16"></a><span class="fu">summary</span>(manifesto_corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 7 documents, showing 7 documents:

                      Text Types Tokens Sentences            party
         con_manifesto.txt  3493  34445         1     conservative
         DUP_manifesto.txt  2543  16435        23              dup
       green_manifesto.txt  4317  39279        55           green,
         lab_manifesto.txt  4585  45071         1           labour
     lib_dem_manifesto.txt  4631  44698         5 liberal_democrat
 plaid_cymru_manifesto.txt  3870  30239        37      Plaid_cymru
         SNP_manifesto.txt  3596  35561        16              SNP</code></pre>
</div>
<details class="code-fold"><summary>Answer word clouds</summary><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># Subset for the conservative and labour party</span></span>
<span id="cb66-2"><a href="#cb66-2"></a></span>
<span id="cb66-3"><a href="#cb66-3"></a>con_manifesto <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(manifesto_corpus, party <span class="sc">==</span> <span class="st">"conservative"</span>)</span>
<span id="cb66-4"><a href="#cb66-4"></a>lab_manifesto <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(manifesto_corpus, party <span class="sc">==</span> <span class="st">"labour"</span>)</span>
<span id="cb66-5"><a href="#cb66-5"></a></span>
<span id="cb66-6"><a href="#cb66-6"></a></span>
<span id="cb66-7"><a href="#cb66-7"></a><span class="co"># Create a dfm grouped for the conservative and labour party, cleaning the corpus</span></span>
<span id="cb66-8"><a href="#cb66-8"></a></span>
<span id="cb66-9"><a href="#cb66-9"></a>custom_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"na"</span>, <span class="st">"£"</span>)</span>
<span id="cb66-10"><a href="#cb66-10"></a></span>
<span id="cb66-11"><a href="#cb66-11"></a>dfmat_con_manifesto <span class="ot">&lt;-</span> <span class="fu">tokens</span>(con_manifesto, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-12"><a href="#cb66-12"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-13"><a href="#cb66-13"></a>  <span class="fu">tokens_remove</span>(custom_stopwords) <span class="sc">%&gt;%</span></span>
<span id="cb66-14"><a href="#cb66-14"></a>  <span class="fu">dfm</span>()</span>
<span id="cb66-15"><a href="#cb66-15"></a></span>
<span id="cb66-16"><a href="#cb66-16"></a>dfmat_lab_manifesto <span class="ot">&lt;-</span> <span class="fu">tokens</span>(lab_manifesto, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-17"><a href="#cb66-17"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-18"><a href="#cb66-18"></a>  <span class="fu">tokens_remove</span>(custom_stopwords) <span class="sc">%&gt;%</span></span>
<span id="cb66-19"><a href="#cb66-19"></a>  <span class="fu">dfm</span>()</span>
<span id="cb66-20"><a href="#cb66-20"></a></span>
<span id="cb66-21"><a href="#cb66-21"></a><span class="co"># Create word clouds</span></span>
<span id="cb66-22"><a href="#cb66-22"></a></span>
<span id="cb66-23"><a href="#cb66-23"></a><span class="fu">textplot_wordcloud</span>(dfmat_con_manifesto, </span>
<span id="cb66-24"><a href="#cb66-24"></a>                   <span class="at">min_count =</span> <span class="dv">5</span>, </span>
<span id="cb66-25"><a href="#cb66-25"></a>                   <span class="at">max_words =</span> <span class="dv">100</span>, </span>
<span id="cb66-26"><a href="#cb66-26"></a>                   <span class="at">color =</span> <span class="st">"blue"</span>, </span>
<span id="cb66-27"><a href="#cb66-27"></a>                   <span class="at">max_size =</span> <span class="dv">5</span>, </span>
<span id="cb66-28"><a href="#cb66-28"></a>                   <span class="at">min_size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Answer word clouds</summary><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="fu">textplot_wordcloud</span>(dfmat_lab_manifesto,</span>
<span id="cb67-2"><a href="#cb67-2"></a>                   <span class="at">min_count =</span> <span class="dv">5</span>,</span>
<span id="cb67-3"><a href="#cb67-3"></a>                   <span class="at">max_words =</span> <span class="dv">100</span>, </span>
<span id="cb67-4"><a href="#cb67-4"></a>                   <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb67-5"><a href="#cb67-5"></a>                   <span class="at">max_size =</span> <span class="dv">5</span>,</span>
<span id="cb67-6"><a href="#cb67-6"></a>                   <span class="at">min_size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-38-2.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># Create network plots</span></span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="co"># create dfms </span></span>
<span id="cb68-3"><a href="#cb68-3"></a>custom_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"na"</span>, <span class="st">"£"</span>, <span class="st">"h"</span>)</span>
<span id="cb68-4"><a href="#cb68-4"></a></span>
<span id="cb68-5"><a href="#cb68-5"></a></span>
<span id="cb68-6"><a href="#cb68-6"></a>dfmat_con_manifesto <span class="ot">&lt;-</span> <span class="fu">tokens</span>(con_manifesto, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-7"><a href="#cb68-7"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-8"><a href="#cb68-8"></a>  <span class="fu">tokens_remove</span>(custom_stopwords) <span class="sc">%&gt;%</span></span>
<span id="cb68-9"><a href="#cb68-9"></a>  <span class="fu">dfm</span>()</span>
<span id="cb68-10"><a href="#cb68-10"></a></span>
<span id="cb68-11"><a href="#cb68-11"></a></span>
<span id="cb68-12"><a href="#cb68-12"></a>dfmat_lab_manifesto <span class="ot">&lt;-</span> <span class="fu">tokens</span>(lab_manifesto, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-13"><a href="#cb68-13"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-14"><a href="#cb68-14"></a>  <span class="fu">tokens_remove</span>(custom_stopwords) <span class="sc">%&gt;%</span></span>
<span id="cb68-15"><a href="#cb68-15"></a>  <span class="fu">dfm</span>()</span>
<span id="cb68-16"><a href="#cb68-16"></a></span>
<span id="cb68-17"><a href="#cb68-17"></a></span>
<span id="cb68-18"><a href="#cb68-18"></a><span class="co"># Include only top 20 terms</span></span>
<span id="cb68-19"><a href="#cb68-19"></a>top_terms <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">topfeatures</span>(dfmat_con_manifesto, <span class="dv">20</span>))</span>
<span id="cb68-20"><a href="#cb68-20"></a>dfmat_con_manifesto_filtered <span class="ot">&lt;-</span> <span class="fu">dfm_select</span>(dfmat_con_manifesto, <span class="at">pattern =</span> top_terms)</span>
<span id="cb68-21"><a href="#cb68-21"></a></span>
<span id="cb68-22"><a href="#cb68-22"></a></span>
<span id="cb68-23"><a href="#cb68-23"></a><span class="co"># Include only top 20 terms</span></span>
<span id="cb68-24"><a href="#cb68-24"></a>top_terms <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">topfeatures</span>(dfmat_lab_manifesto, <span class="dv">20</span>))</span>
<span id="cb68-25"><a href="#cb68-25"></a>dfmat_lab_manifesto_filtered <span class="ot">&lt;-</span> <span class="fu">dfm_select</span>(dfmat_lab_manifesto, <span class="at">pattern =</span> top_terms)</span>
<span id="cb68-26"><a href="#cb68-26"></a></span>
<span id="cb68-27"><a href="#cb68-27"></a></span>
<span id="cb68-28"><a href="#cb68-28"></a><span class="co"># Produce a network plot</span></span>
<span id="cb68-29"><a href="#cb68-29"></a></span>
<span id="cb68-30"><a href="#cb68-30"></a><span class="fu">textplot_network</span>(dfmat_con_manifesto_filtered, <span class="at">min_freq =</span> <span class="dv">50</span>, <span class="at">edge_size =</span> <span class="fl">0.5</span>, <span class="at">edge_color =</span> <span class="st">"lightblue"</span>, <span class="at">vertex_size =</span> <span class="fl">0.5</span>, <span class="at">vertex_labelsize =</span> <span class="dv">5</span>, <span class="at">vertex_labelcolor =</span> <span class="st">"darkblue"</span>, <span class="at">vertex_color =</span> <span class="st">"lightblue"</span>, <span class="at">vertex_alpha =</span> <span class="fl">0.5</span>, <span class="at">repel =</span> <span class="cn">TRUE</span>, <span class="at">seed =</span> <span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="fu">textplot_network</span>(dfmat_lab_manifesto_filtered, <span class="at">min_freq =</span> <span class="dv">50</span>, <span class="at">edge_size =</span> <span class="fl">0.5</span>, <span class="at">edge_color =</span> <span class="st">"red"</span>, <span class="at">vertex_size =</span> <span class="fl">0.5</span>, <span class="at">vertex_labelsize =</span> <span class="dv">5</span>, <span class="at">vertex_labelcolor =</span> <span class="st">"darkred"</span>, <span class="at">vertex_color =</span> <span class="st">"red"</span>, <span class="at">vertex_alpha =</span> <span class="fl">0.5</span>, <span class="at">repel =</span> <span class="cn">TRUE</span>, <span class="at">seed =</span> <span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-39-2.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="task-3-keyness-analysis" class="level3" data-number="1.13.3"><h3 data-number="1.13.3" class="anchored" data-anchor-id="task-3-keyness-analysis">
<span class="header-section-number">1.13.3</span> Task 3 keyness analysis</h3>
<div class="question">
<p>Create a keyness plot comparing the language in the labour and conservative manifestos. What words are most distinctive in each manifesto?</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Answer</summary><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb70-2"><a href="#cb70-2"></a></span>
<span id="cb70-3"><a href="#cb70-3"></a></span>
<span id="cb70-4"><a href="#cb70-4"></a><span class="co"># Create a corpus</span></span>
<span id="cb70-5"><a href="#cb70-5"></a></span>
<span id="cb70-6"><a href="#cb70-6"></a>manifesto_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(manifesto_text)</span>
<span id="cb70-7"><a href="#cb70-7"></a></span>
<span id="cb70-8"><a href="#cb70-8"></a><span class="co"># Label the manifestos</span></span>
<span id="cb70-9"><a href="#cb70-9"></a></span>
<span id="cb70-10"><a href="#cb70-10"></a><span class="fu">docvars</span>(manifesto_corpus, <span class="st">"party"</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"conservative"</span>, <span class="st">"DUP"</span>, <span class="st">"green"</span>, <span class="st">"labour"</span>, <span class="st">"liberal_democrat"</span>, <span class="st">"Plaid_cymru"</span>, <span class="st">"SNP"</span>)</span>
<span id="cb70-11"><a href="#cb70-11"></a></span>
<span id="cb70-12"><a href="#cb70-12"></a></span>
<span id="cb70-13"><a href="#cb70-13"></a><span class="co"># Subset to labour and conservative</span></span>
<span id="cb70-14"><a href="#cb70-14"></a></span>
<span id="cb70-15"><a href="#cb70-15"></a>con_lab_manifesto <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(manifesto_corpus, party <span class="sc">==</span> <span class="st">"conservative"</span> <span class="sc">|</span> party <span class="sc">==</span> <span class="st">"labour"</span>)</span>
<span id="cb70-16"><a href="#cb70-16"></a></span>
<span id="cb70-17"><a href="#cb70-17"></a><span class="co"># Remove punctuation and stopwords</span></span>
<span id="cb70-18"><a href="#cb70-18"></a><span class="co"># group by party</span></span>
<span id="cb70-19"><a href="#cb70-19"></a></span>
<span id="cb70-20"><a href="#cb70-20"></a>dfmat_manifesto <span class="ot">&lt;-</span> <span class="fu">tokens</span>(con_lab_manifesto, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, </span>
<span id="cb70-21"><a href="#cb70-21"></a>                          <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>, <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-22"><a href="#cb70-22"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"english"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-23"><a href="#cb70-23"></a>  <span class="fu">dfm</span>() </span>
<span id="cb70-24"><a href="#cb70-24"></a></span>
<span id="cb70-25"><a href="#cb70-25"></a><span class="co"># Perform keyness analysis</span></span>
<span id="cb70-26"><a href="#cb70-26"></a>keyness_stat <span class="ot">&lt;-</span> <span class="fu">textstat_keyness</span>(dfmat_manifesto, <span class="at">target =</span> <span class="st">"lab_manifesto.txt"</span>, <span class="at">measure =</span> <span class="st">"lr"</span>)</span>
<span id="cb70-27"><a href="#cb70-27"></a></span>
<span id="cb70-28"><a href="#cb70-28"></a><span class="co"># Plot the keyness analysis</span></span>
<span id="cb70-29"><a href="#cb70-29"></a><span class="fu">textplot_keyness</span>(keyness_stat, <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">n =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="task-4-lexical-disperssion-plot" class="level3" data-number="1.13.4"><h3 data-number="1.13.4" class="anchored" data-anchor-id="task-4-lexical-disperssion-plot">
<span class="header-section-number">1.13.4</span> Task 4 lexical disperssion plot</h3>
<div class="question">
<p>Create a lexical dispersion plot comparing where the word “Brexit” and “economy” appears in the labour, conservative and liberal democrat policy</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Answer</summary><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb71-2"><a href="#cb71-2"></a></span>
<span id="cb71-3"><a href="#cb71-3"></a></span>
<span id="cb71-4"><a href="#cb71-4"></a><span class="co"># Create a corpus</span></span>
<span id="cb71-5"><a href="#cb71-5"></a></span>
<span id="cb71-6"><a href="#cb71-6"></a>manifesto_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(manifesto_text)</span>
<span id="cb71-7"><a href="#cb71-7"></a></span>
<span id="cb71-8"><a href="#cb71-8"></a><span class="co"># Label the manifestos</span></span>
<span id="cb71-9"><a href="#cb71-9"></a></span>
<span id="cb71-10"><a href="#cb71-10"></a><span class="fu">docvars</span>(manifesto_corpus, <span class="st">"party"</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"conservative"</span>, <span class="st">"DUP"</span>, <span class="st">"green"</span>, <span class="st">"labour"</span>, <span class="st">"liberal_democrat"</span>, <span class="st">"Plaid_cymru"</span>, <span class="st">"SNP"</span>)</span>
<span id="cb71-11"><a href="#cb71-11"></a></span>
<span id="cb71-12"><a href="#cb71-12"></a></span>
<span id="cb71-13"><a href="#cb71-13"></a><span class="co"># Subset to labour and conservative</span></span>
<span id="cb71-14"><a href="#cb71-14"></a></span>
<span id="cb71-15"><a href="#cb71-15"></a>con_lab_lib_manifesto <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(manifesto_corpus, party <span class="sc">==</span> <span class="st">"conservative"</span> <span class="sc">|</span> party <span class="sc">==</span> <span class="st">"labour"</span> <span class="sc">|</span></span>
<span id="cb71-16"><a href="#cb71-16"></a>                                     party <span class="sc">==</span> <span class="st">"liberal_democrat"</span>)</span>
<span id="cb71-17"><a href="#cb71-17"></a></span>
<span id="cb71-18"><a href="#cb71-18"></a>con_lab_lib_manifesto_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(con_lab_lib_manifesto, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, </span>
<span id="cb71-19"><a href="#cb71-19"></a>                          <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>, <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-20"><a href="#cb71-20"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>))</span>
<span id="cb71-21"><a href="#cb71-21"></a>                </span>
<span id="cb71-22"><a href="#cb71-22"></a><span class="fu">textplot_xray</span>(</span>
<span id="cb71-23"><a href="#cb71-23"></a><span class="fu">kwic</span>(con_lab_lib_manifesto_tokens, <span class="at">pattern =</span> <span class="st">"brexit"</span>),</span>
<span id="cb71-24"><a href="#cb71-24"></a><span class="fu">kwic</span>(con_lab_lib_manifesto_tokens, <span class="at">pattern =</span> <span class="st">"economy"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section></section></section><section id="analysing-ofsted-reports" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Analysing ofsted reports</h1>
<p>We have created a large corpus of the text of Ofsted reports, by scrapping all Ofsted reports from the Ofsted website. You can download a subset of the corpus, for London schools, as a parquet file from <a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EZtdmlFzmOJEo2TnLiOjJrQBMBBqUpuVG1ZZmycum0dgpQ?e=VEV0mE">here</a>.</p>
<p>To load the corpus into R, you can use the <code>read_parquet</code> function from the <code>arrow</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb72-2"><a href="#cb72-2"></a><span class="co"># Read in the Ofsted reports corpus</span></span>
<span id="cb72-3"><a href="#cb72-3"></a>london_ofsted_reports <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(<span class="st">"&lt;path to ofsted_reports.parquet&gt;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The corpus contains the text of all Lonson Ofsted reports from 2010 to 2023. The variables in the data frame are:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 28%">
<col style="width: 71%">
</colgroup>
<thead><tr class="header">
<th>Variable Name</th>
<th>Explanation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>file</td>
<td>pdf report file name</td>
</tr>
<tr class="even">
<td>text</td>
<td>Text of the pdf report</td>
</tr>
<tr class="odd">
<td>year</td>
<td>Year of the report</td>
</tr>
<tr class="even">
<td>month</td>
<td>Month of the report</td>
</tr>
<tr class="odd">
<td>day</td>
<td>Day of the report</td>
</tr>
<tr class="even">
<td>fle_name</td>
<td>Filename</td>
</tr>
<tr class="odd">
<td>urn_orig</td>
<td>Original URN (Unique Reference Number) - school reference number</td>
</tr>
<tr class="even">
<td>date</td>
<td>Full date (combination of year, month, day)</td>
</tr>
<tr class="odd">
<td>name</td>
<td>Name of the inspection site (e.g., school)</td>
</tr>
<tr class="even">
<td>urn</td>
<td>Unique Reference Number</td>
</tr>
<tr class="odd">
<td>address</td>
<td>Address of the inspection site</td>
</tr>
<tr class="even">
<td>reports</td>
<td>Type of report.</td>
</tr>
<tr class="odd">
<td>urls</td>
<td>url of report</td>
</tr>
<tr class="even">
<td>closed_link</td>
<td></td>
</tr>
<tr class="odd">
<td>closed_name</td>
<td></td>
</tr>
<tr class="even">
<td>urn_2</td>
<td></td>
</tr>
<tr class="odd">
<td>type</td>
<td>type of inspection - e.g.&nbsp;full or short</td>
</tr>
<tr class="even">
<td>grade</td>
<td>ofsted grade</td>
</tr>
</tbody>
</table>
<p>The corpus provides a rich source of text data for analysis. Using the approaches introduced above, you can attempt the tasks below.</p>
<section id="task-1---tracking-policies-over-time" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="task-1---tracking-policies-over-time">
<span class="header-section-number">2.1</span> Task 1 - Tracking policies over time</h2>
<div class="question">
<p>Using the London ofsted corpus, produce graphs of how the frequency of reference to the following policies /pedagogies have changed over time:</p>
<p>• brain gym • learning styles • mastery</p>
<p>Choose your group of keywords to plot. To create the plot, we have broken the task down into a n number of steps. First, use the <code>tokens()</code> function to tokenise the <code>london_ofsted_corpus</code>.</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Answer</summary><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># create a corpus object from the ofsted reports</span></span>
<span id="cb73-2"><a href="#cb73-2"></a></span>
<span id="cb73-3"><a href="#cb73-3"></a>london_ofsted_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(london_ofsted_reports)</span>
<span id="cb73-4"><a href="#cb73-4"></a></span>
<span id="cb73-5"><a href="#cb73-5"></a><span class="co"># tokenise the corupus removing stop words, numbers, symbols and </span></span>
<span id="cb73-6"><a href="#cb73-6"></a><span class="co"># punctuation</span></span>
<span id="cb73-7"><a href="#cb73-7"></a><span class="co"># this will be slow as the corpus is large!</span></span>
<span id="cb73-8"><a href="#cb73-8"></a>tokens_clean <span class="ot">&lt;-</span> <span class="fu">tokens</span>(london_ofsted_corpus,</span>
<span id="cb73-9"><a href="#cb73-9"></a>                       <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-10"><a href="#cb73-10"></a>                       <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-11"><a href="#cb73-11"></a>                       <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-12"><a href="#cb73-12"></a>   <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span> <span class="co"># convert to lower case</span></span>
<span id="cb73-13"><a href="#cb73-13"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="question">
<p>Next, to be able to search for two word phrases use the <code>phrase</code> and <code>tokens_compound</code> functions to search the cleaned tokens data for the policy names of interest</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Answer</summary><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># Convert keywords to tokens for compound matching - this means the search is</span></span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="co"># for the whole phrase, not the individual words</span></span>
<span id="cb74-3"><a href="#cb74-3"></a><span class="co"># Create a pattern where multi-word terms use the phrase operator</span></span>
<span id="cb74-4"><a href="#cb74-4"></a>keywords_phrases <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">phrase</span>(<span class="st">"brain gym"</span>), <span class="fu">phrase</span>(<span class="st">"learning styles"</span>), <span class="st">"mastery"</span>)</span>
<span id="cb74-5"><a href="#cb74-5"></a></span>
<span id="cb74-6"><a href="#cb74-6"></a><span class="co"># Compound multi-word keywords into single tokens and search</span></span>
<span id="cb74-7"><a href="#cb74-7"></a>tokens_compounded <span class="ot">&lt;-</span> <span class="fu">tokens_compound</span>(tokens_clean, <span class="at">pattern =</span> keywords_phrases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="question">
<p>Create a <code>dfm</code> with the frequencies of the keywords and convert to a data frame ready for plotting. Hints: • You will want to use <code>dfm_group(groups = docvars(london_ofsted_corpus, "year"))</code> to group the <code>dfm</code> by year to enable you to plot change over time • When searching for the keywords, note the compounded tokens will now have an underscore in them - for example, “learning_styles” • When you convert the <code>dfm</code> to a <code>data.frame</code> the years will become row names. To convert rownames to a column you can use <code>freqs_df$year &lt;- rownames(freqs_df)</code> • On converting to a dataframe, you will have a column for each keyterm. For plotting, <code>ggplot</code> prefers long format in which there is a single column/vector for counts with two columns identifying the year and keyword. To change the data frame to this format you can use the <code>pivot_longer</code> function. See below</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>When plotting data, long form data frames are preferred over wide forms. The difference is illustrated below. In a wide form data frame, each invidiual or school is a row and may have multiple columns of data:</p>
<div class="cell">
<details class="code-fold"><summary>Answer</summary><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a>wide_form <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">student =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>),</span>
<span id="cb75-2"><a href="#cb75-2"></a>                        <span class="at">math =</span> <span class="fu">c</span>(<span class="dv">81</span>, <span class="dv">56</span>, <span class="dv">43</span>, <span class="dv">56</span>, <span class="dv">78</span>, <span class="dv">92</span>),</span>
<span id="cb75-3"><a href="#cb75-3"></a>                        <span class="at">english =</span> <span class="fu">c</span>(<span class="dv">54</span>, <span class="dv">32</span>, <span class="dv">78</span>, <span class="dv">91</span>, <span class="dv">33</span>, <span class="dv">67</span>))</span>
<span id="cb75-4"><a href="#cb75-4"></a></span>
<span id="cb75-5"><a href="#cb75-5"></a>wide_form</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  student math english
1       A   81      54
2       B   56      32
3       C   43      78
4       D   56      91
5       E   78      33
6       F   92      67</code></pre>
</div>
</div>
<p>In long form, there is a single column for numeric data and each individual or school has multiple entries:</p>
<div class="cell">
<details class="code-fold"><summary>Answer</summary><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>long_form <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(wide_form, <span class="at">cols =</span> <span class="fu">c</span>(math, english),</span>
<span id="cb77-2"><a href="#cb77-2"></a>                          <span class="at">names_to =</span> <span class="st">"subject"</span>, <span class="at">values_to =</span> <span class="st">"scores"</span>)</span>
<span id="cb77-3"><a href="#cb77-3"></a></span>
<span id="cb77-4"><a href="#cb77-4"></a>long_form</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   student subject scores
   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
 1 A       math        81
 2 A       english     54
 3 B       math        56
 4 B       english     32
 5 C       math        43
 6 C       english     78
 7 D       math        56
 8 D       english     91
 9 E       math        78
10 E       english     33
11 F       math        92
12 F       english     67</code></pre>
</div>
</div>
<p>To convert wide form to long form, you use the <code>pivot_longer</code> function. The function takes the arguments: a) <code>cols = c("col1","col2")</code> - the names of the columns to combine into a longer column; b) names_to = “” - the name of the new column labelling the values; and values_to = “” - the name of the new column containing the values. For example, in the case of converting the example dataframe above we use: <code>pivot_longer(wide_form, cols = c(math, english), names_to = "subject", values_to = "scores")</code>. We specify the two columns we want to stack (<code>c(math, english)</code>), the names of the column with the subject labels and the scores.</p>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Answer</summary><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># Create dfm grouped by year</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>ofsted_dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(tokens_compounded) <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3"></a>  <span class="fu">dfm_group</span>(<span class="at">groups =</span> <span class="fu">docvars</span>(london_ofsted_corpus, <span class="st">"year"</span>))</span>
<span id="cb79-4"><a href="#cb79-4"></a></span>
<span id="cb79-5"><a href="#cb79-5"></a><span class="co">#After compounding, we need to select the compounded tokens</span></span>
<span id="cb79-6"><a href="#cb79-6"></a><span class="co"># which now have underscores</span></span>
<span id="cb79-7"><a href="#cb79-7"></a>keywords_compounded <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brain_gym"</span>, <span class="st">"learning_styles"</span>, <span class="st">"mastery"</span>)</span>
<span id="cb79-8"><a href="#cb79-8"></a></span>
<span id="cb79-9"><a href="#cb79-9"></a><span class="co"># Select keyword phrases in dfm</span></span>
<span id="cb79-10"><a href="#cb79-10"></a>dfm_keywords <span class="ot">&lt;-</span> <span class="fu">dfm_select</span>(ofsted_dfm, <span class="at">pattern =</span> keywords_compounded)</span>
<span id="cb79-11"><a href="#cb79-11"></a></span>
<span id="cb79-12"><a href="#cb79-12"></a><span class="co"># Convert to data frame</span></span>
<span id="cb79-13"><a href="#cb79-13"></a>freqs_df <span class="ot">&lt;-</span> <span class="fu">convert</span>(dfm_keywords, <span class="at">to =</span> <span class="st">"data.frame"</span>)</span>
<span id="cb79-14"><a href="#cb79-14"></a><span class="co"># convert row names with years to columns</span></span>
<span id="cb79-15"><a href="#cb79-15"></a>freqs_df<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">rownames</span>(freqs_df)</span>
<span id="cb79-16"><a href="#cb79-16"></a></span>
<span id="cb79-17"><a href="#cb79-17"></a><span class="co"># Pivot for plotting</span></span>
<span id="cb79-18"><a href="#cb79-18"></a>freqs_long <span class="ot">&lt;-</span> freqs_df <span class="sc">%&gt;%</span></span>
<span id="cb79-19"><a href="#cb79-19"></a>  <span class="fu">select</span>(<span class="sc">-</span>year) <span class="sc">%&gt;%</span></span>
<span id="cb79-20"><a href="#cb79-20"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>doc_id, <span class="at">names_to =</span> <span class="st">"keyword"</span>, <span class="at">values_to =</span> <span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="question">
<p>Finally, plot your data as a line chart - you may want to facet the chart to give separate plots for each key word</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Answer</summary><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="co">#  Plot</span></span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="fu">ggplot</span>(freqs_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(doc_id), <span class="at">y =</span> frequency, <span class="at">color =</span> keyword)) <span class="sc">+</span></span>
<span id="cb80-3"><a href="#cb80-3"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb80-4"><a href="#cb80-4"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb80-5"><a href="#cb80-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Keyword Frequency Over Time in London Ofsted Reports"</span>,</span>
<span id="cb80-6"><a href="#cb80-6"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb80-7"><a href="#cb80-7"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-8"><a href="#cb80-8"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb80-9"><a href="#cb80-9"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>keyword, <span class="at">scales =</span> <span class="st">"free_y"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="A9-Corpus_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>